function isEmpty(e){for(var t in e)return!0;return!1}function isNumber(e){return"[object Number]"===Object.prototype.toString.call(e)}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}function getRandomIntInclusive(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function appendToConsole(e){var t=$("#fake-console").html();t.length>16384&&(t=""),t+="<br>"+e,$("#fake-console").html(t)}function logSuspicion(e){var t="",s=new Date;if(null!=trews.data&&null!=trews.data.severe_sepsis&&null!=trews.data.severe_sepsis.suspicion_of_infection){var i=new Date(1e3*trews.data.severe_sepsis.suspicion_of_infection.update_time);t=e+" "+trews.data.severe_sepsis.suspicion_of_infection.name+" "+i.toISOString()+" "+s.toISOString()}else t=e+" null null "+s.toISOString();appendToConsole(t)}function orderStatusCompleted(e){var t=null!=e.status&&e.status.startsWith("Clinically Inappropriate");return"Completed"==e.status||"Not Indicated"==e.status||t}function getHeaderHeight(){var e=parseInt($("#header").css("height"),10),t=parseInt($("#status-header").css("height"),10),s=parseInt($("#disclaimer-header").css("height"),10);return s=null==s?0:s,{status:e+"px",disclaimer:e+t+"px",total:e+t+s+"px"}}function refreshHeaderHeight(e){var t=getHeaderHeight();$("#status-header").css("top",t.status),$("#disclaimer-header").css("top",t.disclaimer),$("#left-column").css("top",t.total),$("#right-column").css("top",t.total),$("#notifications").css("top",t.total),$("#activity").css("top",t.total)}function Listener(e){for(var t in e.data){var s=e.data[t];switch(t){case"token":epicToken=s,appendToConsole("Epic handshake done: "+encodeURI(epicToken));break;case"error":var i=window.location.hostname.indexOf("localhost")>-1?"http://localhost:8000/api":window.location.protocol+"//"+window.location.hostname+"/api",r=new Date;timer.log(i,r,r,"Epic error: "+JSON.stringify(s)),appendToConsole("Epic error: "+JSON.stringify(s));break;case"features":appendToConsole("features:");for(var a in s)appendToConsole("  "+a);break;case"state":appendToConsole("state: "+JSON.stringify(s));break;case"actionExecuted":appendToConsole("actionExecuted: "+(null==lastAction?"<unknown>":lastAction)+" "+s.toString());break;default:appendToConsole("unhandled event: "+JSON.stringify(e))}}}function longPatientSummary(e,t,s,i,r,a,n,o){var l=null,d=null,u=null,c=null;if(null!=trews.data&&null!=trews.data.severe_sepsis){var p="trews_subalert"in trews.data.severe_sepsis&&trews.data.severe_sepsis.trews_subalert.is_met,h=trews.data.severe_sepsis.sirs.is_met&&trews.data.severe_sepsis.organ_dysfunction.is_met,m=trews.data.ui.ui_deactivate.is_met,_=null!=trews.data.severe_sepsis.suspicion_of_infection.update_time&&"No Infection"==trews.data.severe_sepsis.suspicion_of_infection.value,v=null!=trews.data.severe_sepsis.suspicion_of_infection.update_time&&null!=trews.data.severe_sepsis.suspicion_of_infection.value&&"No Infection"!=trews.data.severe_sepsis.suspicion_of_infection.value,f=0==trews.data.severe_sepsis.trews_organ_dysfunction.num_met&&trews.data.severe_sepsis.trews_organ_dysfunction.num_overridden>0,w=0==trews.data.severe_sepsis.organ_dysfunction.num_met&&trews.data.severe_sepsis.organ_dysfunction.num_overridden>0,g=f||trews.data.severe_sepsis.sirs.is_met&&w,b=(trews.data.severe_sepsis.is_met&&trews.data.severe_sepsis.is_trews&&(trews.data.severe_sepsis.onset_time,trews.data.severe_sepsis.trews_onset_time),trews.data.severe_sepsis.onset_time),y=trews.data.septic_shock.onset_time,S=p&&null==b&&null==y,C=h&&null==b&&null==y,T=null==trews.data.repeat_lactate_order.status||!orderStatusCompleted(trews.data.repeat_lactate_order),k=(trews.data.repeat_lactate_order.is_met,null!=trews.data.septic_shock.hypotension.is_met&&!trews.data.septic_shock.hypotension.is_met),x=trews.data.vasopressors_order.is_met&&k,O=0;O+=trews.orderIsDone("initial_lactate_order")?1:0,O+=trews.orderIsDone("blood_culture_order")?1:0,O+=trews.orderIsDone("antibiotics_order")?1:0;var D=O+=trews.orderIsDone("crystalloid_fluid_order")?1:0,N=D+=trews.data.repeat_lactate_order.is_met||orderStatusCompleted(trews.data.repeat_lactate_order)?1:0;N+=x||trews.orderIsDone("vasopressors_order")?1:0;var M=$("[data-trews='sev3'] .card-subtitle").html(),P=$("[data-trews='sev6'] .card-subtitle").html(),I=$("[data-trews='sep6'] .card-subtitle").html(),A=(M.indexOf("completed"),P.indexOf("completed")>=0),R=I.indexOf("completed")>=0,E=(M.indexOf("expired"),P.indexOf("expired"),I.indexOf("expired"),A||R),L=1e3*b+2592e5;if(_){var B=null;B=p?Math.max(trews.data.severe_sepsis.suspicion_of_infection.update_time,trews.data.severe_sepsis.trews_subalert.onset_time):Math.max(trews.data.severe_sepsis.suspicion_of_infection.update_time,trews.data.severe_sepsis.sirs.onset_time,trews.data.severe_sepsis.organ_dysfunction.onset_time),not_infected_date=new Date(1e3*B.toFixed(0)),u=new Date(not_infected_date.getTime()+2592e5),l=e?"No infection suspected for this patient at "+strToTime(not_infected_date,!0,!1)+". ":"Patient evaluted as not septic. ",1==t&&(l+="<br>No further sepsis evaluation steps required at this time. "),d="no-priority"}else if(g){var H=null,V=f?trews.data.severe_sepsis.trews_organ_dysfunction.criteria:trews.data.severe_sepsis.organ_dysfunction.criteria;for(var W in V)V[W].override_time&&(H=null==H?V[W].override_time:Math.min(V[W].override_time,H));not_acute_orgdf_date=new Date(1e3*H.toFixed(0)),u=new Date(not_acute_orgdf_date.getTime()+2592e5),l=e?"No acute organ dysfunction due to infection for this patient"+(not_acute_orgdf_date?" at "+strToTime(not_acute_orgdf_date,!0,!1):"")+". ":"Patient evaluated as not septic. ",1==t&&(v&&(l+="Evaluation steps 1 and 2 complete. "),o&&(l+=o),l+=v?"<br>Please continue to monitor for any organ dysfunction due to infection.":"<br>Please complete whether infection is suspected for this patient in evaluation step 1."),d="no-priority"}else if(null!=b||null!=y){null!=L&&(u=new Date(L));var U=null!=y?6-(x?1:0):5,j=null!=y?N:D;null!=y?(trews.data.ui.ui_septic_shock.is_met?l="Patient manually overridden at "+strToTime(new Date(1e3*y),!0,!1)+". ":e&&(l="",trews.data.severe_sepsis.is_trews&&(l+="TREWS Septic Shock met at "+strToTime(new Date(1e3*y),!0,!1)+". "),trews.data.severe_sepsis.is_cms&&(trews.data.severe_sepsis.is_trews?a&&(c="CMS Septic Shock criteria met at "+strToTime(new Date(1e3*y),!0,!1)+". "):l+="CMS Septic Shock criteria met at "+strToTime(new Date(1e3*y),!0,!1)+". ")),1==t&&o&&(l+=o),1==t&&j<U&&(l+="<br>Please order missing bundle items under Steps 3 and 5. ")):null!=b&&(trews.data.ui.ui_severe_sepsis.is_met?l="Patient manually overridden at "+strToTime(new Date(1e3*b),!0,!1)+". ":e&&(l="",trews.data.severe_sepsis.is_trews&&(l+="TREWS Severe Sepsis met at "+strToTime(new Date(1e3*trews.data.severe_sepsis.trews_onset_time),!0,!1)+". "),trews.data.severe_sepsis.is_cms&&(trews.data.severe_sepsis.is_trews?a&&(c="CMS Severe Sepsis criteria met at "+strToTime(new Date(1e3*trews.data.severe_sepsis.cms_onset_time),!0,!1)+". "):l+="CMS Severe Sepsis criteria met at "+strToTime(new Date(1e3*trews.data.severe_sepsis.cms_onset_time),!0,!1)+". ")),1==t&&o&&(l+=o),1==t&&j<U&&(l+="<br>Please order missing bundle items under Step 3. ")),null==l&&(l="Patient on "+(null!=y?"septic shock":"sepsis")+" pathway"+(s?", ":".")),s&&(l+=j+" of "+U+" treatment steps complete."),d=E?"low-priority":"high-priority"}else if(m||!S&&!C){if(m){if(null!=trews.data.ui.ui_deactivate.override_value&&trews.data.ui.ui_deactivate.override_value.length>0&&"uncertain"==trews.data.ui.ui_deactivate.override_value[0].type){l=e?"Patient's sepsis state indicated as uncertain, and further monitoring requested by "+(null==trews.data.ui.ui_deactivate.override_user?"user":trews.data.ui.ui_deactivate.override_user):"Notifications paused, please keep monitoring the patient";var F=Date.now(),z=new Date(trews.data.ui.ui_deactivate.override_value[0].until),G="at ";(z=new Date(3e5*Math.ceil((z.getTime()+6e5)/3e5)))<=F&&(z=new Date(3e5*Math.ceil(F/3e5)),G="by "),l+=". Notifications will resume "+G+strToTime(z,!0,!1)+".",d="low-priority"}}else if(r){var Q=!1,J="trews_subalert"in trews.data.severe_sepsis?trews.data.severe_sepsis.trews_subalert.value:null;null!=J&&"no_lab"in(J=JSON.parse(J))&&null!=J.no_lab&&"boolean"==typeof J.no_lab&&(Q=!J.no_lab),l=Q?"TREWS does not indicate high risk of severe sepsis as of "+strToTime(Date.now(),!0,!1):"TREWS does not yet have sufficient data to calculate if this patient is at risk of severe sepsis as of "+strToTime(Date.now(),!0,!1)+".<br>If you believe the patient is currently experiencing sepsis, please click Skip to bundle below to enable patient tracking.",d="no-priority"}}else{var K=new Date(1e3*trews.data.severe_sepsis.trews_subalert.onset_time),q=new Date(1e3*Math.max(trews.data.severe_sepsis.sirs.onset_time,trews.data.severe_sepsis.organ_dysfunction.onset_time)),Y=S?"TREWS triggered for "+(n?"<b>":"")+"high risk of severe sepsis"+(n?"</b>":"")+" at "+strToTime(K,!0,!1):"",Z=C?(n?"<b>":"")+"CMS SIRS and Organ Dysfunction"+(n?"</b>":"")+" criteria met at "+strToTime(q,!0,!1):"";if(l="",e?(l+=Y,!S&&C?l+=Z:a&&C&&(c=Z+"."),l+="."):l+=(S?"TREWS alert":"")+(C?(S?" and ":"")+"CMS alert":"")+" fired,",1==t)o&&(l+=o),l+=((X=","==l[l.length-1])?" please":"<br>Please")+" complete evaluation for severe sepsis in steps 1 and 2 below.";else if(2==t){var X=","==l[l.length-1];l+=(X?" please":" Please")+" complete the severe sepsis evaluation."}d="low-priority"}if(i&&null!=u){var F=Date.now(),ee=new Date(u.getTime()-F);if(u<=F)l+=" TREWS will reset in approximately 15 minutes.";else{var te=ee.getUTCMinutes()<10?"0"+ee.getUTCMinutes():ee.getUTCMinutes(),se=ee.getUTCHours(),ie=ee.getUTCDate()-1;0==ie&&0==se&&te<=15?l+=" TREWS will reset in approximately 15 minutes.":ie>=0&&se>=0&&te>=0&&(l+=" TREWS will reset in "+ie+" days "+se+" hours "+te+" minutes.")}}}return{care_status:l,care_status_priority:d,auto_reset_date:u,cms_status:c}}function patientSevereSepsisSummary(){if(null!=trews.data&&null!=trews.data.severe_sepsis){var e=null,t=!1,s="trews_subalert"in trews.data.severe_sepsis&&trews.data.severe_sepsis.trews_subalert.is_met,i=trews.data.severe_sepsis.sirs.is_met&&trews.data.severe_sepsis.organ_dysfunction.is_met,r=null!=trews.data.severe_sepsis.suspicion_of_infection.update_time&&"No Infection"==trews.data.severe_sepsis.suspicion_of_infection.value,a=trews.data.severe_sepsis.onset_time,n=s&&null==trews.data.severe_sepsis.suspicion_of_infection.value,o=i&&null==trews.data.severe_sepsis.suspicion_of_infection.value;if(r)e="Patient evaluated as not septic.";else if(null!=a){var l=$("[data-trews='sev6'] .card-subtitle").html().indexOf("completed")>=0;e=trews.data.ui.ui_severe_sepsis.is_met||trews.data.ui.ui_septic_shock.is_met?"Patient manually overridden for severe sepsis":"Patient evaluation indicates severe sepsis",l?e+=", and the required interventions are complete. Please monitor the patient.":(e+=". Please complete the required interventions.",t=!0)}else if(n||o){var d=n?"TREWS triggered for high risk of severe sepsis":"";e=d+(o?(d.length>0?" and ":"")+"CMS alert criteria met":"")+". If you suspect infection is the cause, treat patient for severe sepsis.",t=!0}return{subtitle:e,subtitle_expired:t}}return null}function patientSepticShockSummary(){if(null!=trews.data&&null!=trews.data.septic_shock){var e=null,t=!1;if(null!=trews.data.septic_shock.onset_time){var s=$("[data-trews='sep6'] .card-subtitle").html().indexOf("completed")>=0;e=trews.data.ui.ui_septic_shock.is_met?"Patient manually overridden for septic shock":"Patient evaluation indicates septic shock",s?e+=", and the required interventions are complete. Please monitor the patient.":(e+=". Please complete the required interventions.",t=!0)}else!trews.data.septic_shock.crystalloid_fluid.is_met||trews.data.septic_shock.hypotension.is_met||trews.data.septic_shock.hypoperfusion.is_met?trews.data.septic_shock.crystalloid_fluid.is_met||trews.data.septic_shock.hypotension.is_met||trews.data.septic_shock.hypoperfusion.is_met||(e="No septic shock criteria met. No action required."):e="Fluids administered but no persistent hypotension or hypoperfusion. No action required.";return{subtitle:e,subtitle_expired:t}}return null}function timeLapsed(e,t){var s=new Date(Date.now()-e);if(s<6e4){i=s.getUTCSeconds()>1?" secs ago":" sec ago";return s.getUTCSeconds()+i}if(s<36e5){i=s.getUTCMinutes()>1?" mins ago":" min ago";return s.getUTCMinutes()+i}if(s<864e5){var i=s.getUTCHours()>1?" hrs ago":" hr ago";return s.getUTCHours()+i}return t?"at "+e.toLocaleTimeString()+" on "+e.toLocaleDateString():"on "+e.toLocaleDateString()+" at "+e.toLocaleTimeString()}function timeRemaining(e){var t=new Date(e-Date.now()),s=t.getUTCMinutes()<10?"0"+t.getUTCMinutes():t.getUTCMinutes();return t.getUTCHours()+" hours and "+s+" minutes remaining"}function strToTime(e,t,s){var i=new Date(Number(e)),r=i.getFullYear(),a=i.getMonth()+1,n=i.getDate(),o=i.getHours()<10?"0"+i.getHours():i.getHours(),l=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes();return void 0!==s&&s?o+":"+l:t?o+":"+l+" "+a+"/"+n+"/"+r:a+"/"+n+"/"+r+" "+o+":"+l}function humanReadable(e){return FID_TO_HUMAN_READABLE[e]?FID_TO_HUMAN_READABLE[e]:e}function getQueryVariable(e){for(var t=window.location.search.substring(1).split("&"),s=0;s<t.length;s++){var i=t[s].split("=");if(i[0]==e)return i[1]}return!1}function UpperLowerToLogicalOperators(e,t){return"true"==e.range?"> "+e.lower+t+" and < "+e.upper+t:"min"==e.range?"> "+e.lower+t:"max"==e.range?"< "+e.upper+t:void 0}function cleanUserId(e){return e.replace(/^\++/,"")}!function(e,t,s){function i(e,t){return typeof e===t}function r(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):u?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}var a=[],n=[],o={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var s=this;setTimeout(function(){t(s[e])},0)},addTest:function(e,t,s){n.push({name:e,fn:t,options:s})},addAsyncTest:function(e){n.push({name:null,fn:e})}},l=function(){};l.prototype=o,l=new l;var d=t.documentElement,u="svg"===d.nodeName.toLowerCase();l.addTest("placeholder","placeholder"in r("input")&&"placeholder"in r("textarea")),function(){var e,t,s,r,o,d,u;for(var c in n)if(n.hasOwnProperty(c)){if(e=[],(t=n[c]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(s=0;s<t.options.aliases.length;s++)e.push(t.options.aliases[s].toLowerCase());for(r=i(t.fn,"function")?t.fn():t.fn,o=0;o<e.length;o++)d=e[o],1===(u=d.split(".")).length?l[u[0]]=r:(!l[u[0]]||l[u[0]]instanceof Boolean||(l[u[0]]=new Boolean(l[u[0]])),l[u[0]][u[1]]=r),a.push((r?"":"no-")+u.join("-"))}}(),function(e){var t=d.className,s=l._config.classPrefix||"";if(u&&(t=t.baseVal),l._config.enableJSClass){var i=new RegExp("(^|\\s)"+s+"no-js(\\s|$)");t=t.replace(i,"$1"+s+"js$2")}l._config.enableClasses&&(t+=" "+s+e.join(" "+s),u?d.className.baseVal=t:d.className=t)}(a),delete o.addTest,delete o.addAsyncTest;for(var c=0;c<l._q.length;c++)l._q[c]();e.Modernizr=l}(window,document),function(e,t,s){function i(e,t){return typeof e===t}function r(e,t){return!!~(""+e).indexOf(t)}function a(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,s){return t+s.toUpperCase()}).replace(/^-/,"")}function n(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):y?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function o(e,t){return function(){return e.apply(t,arguments)}}function l(e,t,s){var r;for(var a in e)if(e[a]in t)return!1===s?e[a]:(r=t[e[a]],i(r,"function")?o(r,s||t):r);return!1}function d(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function u(){var e=t.body;return e||(e=n(y?"svg":"body"),e.fake=!0),e}function c(e,s,i,r){var a,o,l,d,c="modernizr",p=n("div"),h=u();if(parseInt(i,10))for(;i--;)l=n("div"),l.id=r?r[i]:c+(i+1),p.appendChild(l);return a=n("style"),a.type="text/css",a.id="s"+c,(h.fake?h:p).appendChild(a),h.appendChild(p),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),p.id=c,h.fake&&(h.style.background="",h.style.overflow="hidden",d=b.style.overflow,b.style.overflow="hidden",b.appendChild(h)),o=s(p,e),h.fake?(h.parentNode.removeChild(h),b.style.overflow=d,b.offsetHeight):p.parentNode.removeChild(p),!!o}function p(t,i){var r=t.length;if("CSS"in e&&"supports"in e.CSS){for(;r--;)if(e.CSS.supports(d(t[r]),i))return!0;return!1}if("CSSSupportsRule"in e){for(var a=[];r--;)a.push("("+d(t[r])+":"+i+")");return a=a.join(" or "),c("@supports ("+a+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return s}function h(e,t,o,l){function d(){c&&(delete x.style,delete x.modElem)}if(l=!i(l,"undefined")&&l,!i(o,"undefined")){var u=p(e,o);if(!i(u,"undefined"))return u}for(var c,h,m,_,v,f=["modernizr","tspan","samp"];!x.style&&f.length;)c=!0,x.modElem=n(f.shift()),x.style=x.modElem.style;for(m=e.length,h=0;m>h;h++)if(_=e[h],v=x.style[_],r(_,"-")&&(_=a(_)),x.style[_]!==s){if(l||i(o,"undefined"))return d(),"pfx"!=t||_;try{x.style[_]=o}catch(e){}if(x.style[_]!=v)return d(),"pfx"!=t||_}return d(),!1}function m(e,t,s,r,a){var n=e.charAt(0).toUpperCase()+e.slice(1),o=(e+" "+C.join(n+" ")+n).split(" ");return i(t,"string")||i(t,"undefined")?h(o,t,r,a):(o=(e+" "+T.join(n+" ")+n).split(" "),l(o,t,s))}function _(e,t,i){return m(e,s,s,t,i)}var v=[],f=[],w={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var s=this;setTimeout(function(){t(s[e])},0)},addTest:function(e,t,s){f.push({name:e,fn:t,options:s})},addAsyncTest:function(e){f.push({name:null,fn:e})}},g=function(){};g.prototype=w,g=new g;var b=t.documentElement,y="svg"===b.nodeName.toLowerCase(),S="Moz O ms Webkit",C=w._config.usePrefixes?S.split(" "):[];w._cssomPrefixes=C;var T=w._config.usePrefixes?S.toLowerCase().split(" "):[];w._domPrefixes=T;var k={elem:n("modernizr")};g._q.push(function(){delete k.elem});var x={style:k.elem.style};g._q.unshift(function(){delete x.style}),w.testAllProps=m,w.testAllProps=_,g.addTest("csstransitions",_("transition","all",!0)),function(){var e,t,s,r,a,n,o;for(var l in f)if(f.hasOwnProperty(l)){if(e=[],(t=f[l]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(s=0;s<t.options.aliases.length;s++)e.push(t.options.aliases[s].toLowerCase());for(r=i(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)n=e[a],1===(o=n.split(".")).length?g[o[0]]=r:(!g[o[0]]||g[o[0]]instanceof Boolean||(g[o[0]]=new Boolean(g[o[0]])),g[o[0]][o[1]]=r),v.push((r?"":"no-")+o.join("-"))}}(),function(e){var t=b.className,s=g._config.classPrefix||"";if(y&&(t=t.baseVal),g._config.enableJSClass){var i=new RegExp("(^|\\s)"+s+"no-js(\\s|$)");t=t.replace(i,"$1"+s+"js$2")}g._config.enableClasses&&(t+=" "+s+e.join(" "+s),y?b.className.baseVal=t:b.className=t)}(v),delete w.addTest,delete w.addAsyncTest;for(var $=0;$<g._q.length;$++)g._q[$]();e.Modernizr=g}(window,document),function(e,t,s){function i(e,t){return typeof e===t}function r(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):u?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}var a=[],n=[],o={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var s=this;setTimeout(function(){t(s[e])},0)},addTest:function(e,t,s){n.push({name:e,fn:t,options:s})},addAsyncTest:function(e){n.push({name:null,fn:e})}},l=function(){};l.prototype=o,l=new l;var d=t.documentElement,u="svg"===d.nodeName.toLowerCase(),c=o._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];o._prefixes=c,l.addTest("opacity",function(){var e=r("a").style;return e.cssText=c.join("opacity:.55;"),/^0.55$/.test(e.opacity)}),function(){var e,t,s,r,o,d,u;for(var c in n)if(n.hasOwnProperty(c)){if(e=[],(t=n[c]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(s=0;s<t.options.aliases.length;s++)e.push(t.options.aliases[s].toLowerCase());for(r=i(t.fn,"function")?t.fn():t.fn,o=0;o<e.length;o++)d=e[o],1===(u=d.split(".")).length?l[u[0]]=r:(!l[u[0]]||l[u[0]]instanceof Boolean||(l[u[0]]=new Boolean(l[u[0]])),l[u[0]][u[1]]=r),a.push((r?"":"no-")+u.join("-"))}}(),function(e){var t=d.className,s=l._config.classPrefix||"";if(u&&(t=t.baseVal),l._config.enableJSClass){var i=new RegExp("(^|\\s)"+s+"no-js(\\s|$)");t=t.replace(i,"$1"+s+"js$2")}l._config.enableClasses&&(t+=" "+s+e.join(" "+s),u?d.className.baseVal=t:d.className=t)}(a),delete o.addTest,delete o.addAsyncTest;for(var p=0;p<l._q.length;p++)l._q[p]();e.Modernizr=l}(window,document),Date.now||(Date.now=function(){return+new Date}),Object.keys||(Object.keys=function(e){var t,s=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.push(t);return s});var INFECTIONS=["Unknown Source","Endocarditis","Meningitis","Bacteremia","Cellulitis","UTI","Pneumonia","Multiple Sources of Infection","Reset"],DETERIORATIONS=["AFib w/ RVR","Acute MI","Cardiac arrest","CHF","Cardiac Tamponade","Pulmonary Embolus","COPD exacerbation","Pulmonary Edema","Liver Disease","Hypovolemia","Hemorrhage","Cardiogenic Shock","Distributive Shock","Obstructive Shock"],ALERT_CODES={100:"TREWScore has passed the Septic Shock Risk Threshold",101:"TREWScore has been elevated for ",200:"All criteria for <b>CMS Severe Sepsis</b> have been met",201:"All criteria for <b>CMS Septic Shock</b> have been met",202:"<b>3hrs</b> have passed since <b>Severe Sepsis</b> onset",203:"<b>6hrs</b> have passed since <b>Severe Sepsis</b> onset",204:"<b>6hrs</b> have passed since <b>Septic Shock</b> onset",205:"<b>6hrs</b> have passed since Suspicion of Infection should have been entered, CMS Severe Sepsis criteria have been reset",206:"<span class='suppressed'><b>6hrs</b> have passed since Suspicion of Infection should have been entered, CMS Severe Sepsis Criteria have been reset</span>",300:"Enter Suspicion of Infection: 2/3 CMS Severe Sepsis Criteria (SIRS and Organ Dysfunction) met",301:"Severe Sepsis 3hr bundle intervention(s) need to be completed",302:"Severe Sepsis 6hr bundle intervention(s) need to be completed",303:"Septic Shock 6hr bundle intervention(s) need to be completed",304:"Severe Sepsis 3hr bundle intervention(s) need to be completed in the next hour",305:"Severe Sepsis 6hr bundle intervention(s) need to be completed in the next hour",306:"Septic Shock 6hr bundle intervention(s) need to be completed in the next hour",307:"<span class='suppressed'>Enter Suspicion of Infection: 2/3 CMS Severe Sepsis Criteria (SIRS and Organ Dysfunction) met</span>",400:"All criteria for <b>TREWS Severe Sepsis</b> have been met",401:"All criteria for <b>TREWS Septic Shock</b> have been met",402:"<b>3hrs</b> have passed since <b>Severe Sepsis</b> onset",403:"<b>6hrs</b> have passed since <b>Severe Sepsis</b> onset",404:"<b>6hrs</b> have passed since <b>Septic Shock</b> onset",405:"<b>6hrs</b> have passed since Suspicion of Infection should have been entered, TREWS Severe Sepsis Alert has been reset",406:"<span class='suppressed'><b>6hrs</b> have passed since Suspicion of Infection should have been entered, TREWS Severe Sepsis Alert has been reset</span>",500:"Enter Suspicion of Infection: TREWS Severe Sepsis Alert met",501:"Severe Sepsis 3hr bundle intervention(s) need to be completed",502:"Severe Sepsis 6hr bundle intervention(s) need to be completed",503:"Septic Shock 6hr bundle intervention(s) need to be completed",504:"Severe Sepsis 3hr bundle intervention(s) need to be completed in the next hour",505:"Severe Sepsis 6hr bundle intervention(s) need to be completed in the next hour",506:"Septic Shock 6hr bundle intervention(s) need to be completed in the next hour",507:"<span class='suppressed'>Enter Suspicion of Infection: TREWS Severe Sepsis Alert met</span>",600:"Patient has been manually overridden for Severe Sepsis",601:"Patient has been manually overridden for Septic Shock",602:"3hrs have passed since Severe Sepsis Manual Override",603:"6hrs have passed since Severe Sepsis Manual Override",604:"6hrs have passed since Septic Shock Manual Override",701:"Severe Sepsis 3hr bundle intervention(s) need to be completed",702:"Severe Sepsis 6hr bundle intervention(s) need to be completed",703:"Septic Shock 6hr bundle intervention(s) need to be completed",704:"Severe Sepsis 3hr bundle intervention(s) need to be completed in the next hour",705:"Severe Sepsis 6hr bundle intervention(s) need to be completed in the next hour",706:"Septic Shock 6hr bundle intervention(s) need to be completed in the next hour"},LOG_STRINGS={set_deterioration_feedback:" set <b>other conditions driving deterioration</b> to the following values: ",reset:" <b>reset</b> the patient",override:{clear:" cleared values for ",customized:[" set "," to "],ordered:[" <b>placed a</b> "," - status: "]},deactivate:" <b>deactivated</b> the patient",activate:" <b>activated</b> the patient",toggle_notifications:" toggled notifications",auto_deactivate:" automatically deactivated the patient",reset_bundle_expired_pats:" reset patients with expired treatment bundles after 72 hrs",reset_noinf_expired_pats:" reset patients with no infection after 72 hrs",reset_soi_pats:" reset patients with expired CMS alerts after 6 hrs"},EDIT={sirs:["temperature","heart rate","respiratory rate","wbc"],org:["blood pressure","mean arterial pressure","decrease in SBP","respiratory failure","creatinine","bilirubin","platelet count","INR","lactate"],tension:["SBP","mean arterial pressure","decrease in SBP"],fusion:["lactate"]},CONSTANTS={"sus-edit":"severe_sepsis",sirs:"severe_sepsis",org:"severe_sepsis",tension:"septic_shock",fusion:"septic_shock"},criteriaKeyToName={sirs_temp:[{name:"Body Temperature",units:"&#176;C"}],heart_rate:[{name:"Heart Rate",units:"/min"}],respiratory_rate:[{name:"Respiratory Rate",units:"/min"}],wbc:[{name:"White Blood Count",units:"K/uL"},{name:"Bands",units:"%"}],blood_pressure:[{name:"Systolic Blood Pressure",units:"mmHg"}],mean_arterial_pressure:[{name:"Mean Arterial Pressure",units:"mmHg"}],decrease_in_sbp:[{name:"Decrease in Systolic Blood Pressure",units:"mmHg"}],respiratory_failure:[{name:"Respiratory Failure: Mechanical Support",units:""}],creatinine:[{name:"Creatinine",units:"mg/dL"},{name:"Urine Output",units:"mL/kg/hour"}],bilirubin:[{name:"Bilirubin",units:"mg/dL"}],platelet:[{name:"Platelet Count",units:""}],inr:[{name:"INR",units:""},{name:"PTT",units:"sec"}],lactate:[{name:"Lactate",units:"mmol/L"}],crystalloid_fluid:[{name:"Fluids",units:"ml/kg"}],systolic_bp:[{name:"Systolic Blood Pressure"}],hypotension_dsbp:[{name:"Decrease in Systolic Blood Pressure (for Hypotension)",units:"mmHg"}],hypotension_map:[{name:"Mean Arterial Pressure (for Hypotension)",units:"mmHg"}],suspicion_of_infection:[{name:"Suspicion of Infection"}],antibiotics_order:[{name:"Antibiotics Order"}],blood_culture_order:[{name:"Blood Culture Order"}],crystalloid_fluid_order:[{name:"Fluids Order"}],initial_lactate_order:[{name:"Initial Lactate Order"}],repeat_lactate_order:[{name:"Repeat Lactate Order"}],vasopressors_order:[{name:"Vasopressors Order"}],trews:[{name:"TREWS Acuity Score",units:""}],trews_sbpm:[{name:"Systolic Blood Pressure",units:"mmHg"}],trews_map:[{name:"Mean Arterial Pressure",units:"mmHg"}],trews_dsbp:[{name:"Decrease in Systolic Blood Pressure",units:"mmHg"}],trews_vent:[{name:"Respiratory Failure: Mechanical Support",units:""}],trews_creatinine:[{name:"Creatinine",units:"mg/dL"},{name:"Urine Output",units:"mL/kg/hour"}],trews_bilirubin:[{name:"Bilirubin",units:"mg/dL"}],trews_platelet:[{name:"Platelet Count",units:""}],trews_inr:[{name:"INR",units:""},{name:"PTT",units:"sec"}],trews_lactate:[{name:"Lactate",units:"mmol/L"}],trews_gcs:[{name:"GCS",units:""}],trews_vasopressors:[{name:"Vasopressors",units:""}],ui_deactivate:[{name:"Notifications to Snooze",units:""}],ui_severe_sepsis:[{name:"Severe Sepsis Bundle",units:""}],ui_septic_shock:[{name:"Septic Shock Bundle",units:""}]},severe_sepsis={display_name:"Severe Sepsis Evaluation",suspicion_of_infection:{display_name:"Please indicate whether infection is suspected"},sirs:{key:"sirs",display_name:"SIRS Criteria",criteria:[{key:"sirs_temp",criteria_display_name:"Temperature is < 36.0 or > 38.3",dropdown:"Temperature is normal",overrideModal:[{id:"override_temp",header:"Override Temperature",name:"Body Temperature",units:"&#176;C",step:.1,range:"true",minAbsolute:20,maxAbsolute:50,values:[36,38.3],acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"heart_rate",criteria_display_name:"Heart Rate (Pulse) > 90/min",dropdown:"Heart Rate is normal",overrideModal:[{id:"override_heart_rate",header:"Override Heart Rate",name:"Heart Rate",units:"/min",step:1,range:"max",minAbsolute:20,maxAbsolute:240,value:90,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"respiratory_rate",criteria_display_name:"Respiratory Rate > 20/min",dropdown:"Respiratory rate is normal",overrideModal:[{id:"override_respiratory_rate",header:"Override Respiratory Rate",name:"Respiratory Rate",units:"/min",step:1,range:"max",minAbsolute:0,maxAbsolute:80,value:20,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"wbc",criteria_display_name:"WBC < 4K/uL or > 12K/uL or >10% bands",dropdown:"Wbc and/or Bands is normal",overrideModal:[{id:"override_wbc",header:"Override White Blood Count",name:"White Blood Count",units:"K/uL",step:.1,range:"true",minAbsolute:2,maxAbsolute:15,values:[4,12],acute_threshold:null,acute_cmp:null,acute_arrow:null},{id:"override_bands",header:"Override Bands",name:"Bands",units:"%",step:.1,range:"max",minAbsolute:0,maxAbsolute:15,value:10,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1}]},organ_dysfunction:{key:"org",display_name:"CMS Organ Dysfunction Criteria",criteria:[{key:"blood_pressure",criteria_display_name:"Systolic Blood Pressure < 90",dropdown:"Blood pressure is normal",overrideModal:[{id:"override_bp",header:"Override Blood Pressure",name:"Systolic Blood Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:180,value:90,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"mean_arterial_pressure",criteria_display_name:"Mean arterial pressure < 65",dropdown:"Mean arterial pressure is normal",overrideModal:[{id:"override_mean_arterial_pressure",header:"Override Mean Arterial Pressure",name:"Mean Arterial Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:180,value:65,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"decrease_in_sbp",criteria_display_name:"Decrease in SBP by > 40 mmHg from the last recorded SBP considered normal for given patient",dropdown:"Decrease in SBP is normal",overrideModal:[{id:"override_decrease_in_sbp",header:"Override Decrease in Systolic Blood Pressure",name:"Decrease in Systolic Blood Pressure",units:"mmHg",step:1,range:"max",minAbsolute:0,maxAbsolute:100,value:40,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"respiratory_failure",criteria_display_name:"Acute respiratory failure evidenced by invasive or non-invasive ventiliation",dropdown:"Respiratory failure is normal",overrideModal:[{id:"override_respiratory_failure",header:"Override Respiratory Failure",name:"Respiratory Failure (Mechanical Ventilation Initiated)",units:"",step:1,range:"max",minAbsolute:0,maxAbsolute:1,value:0,acute_threshold:null,acute_cmp:null,acute_arrow:null}],precision:1},{key:"creatinine",criteria_display_name:"Creatinine > 2.0 or Urine Output < 0.5 mL/kg/hour for 2 hours",dropdown:"Creatinine and/or Urine Output is normal",overrideModal:[{id:"override_creatinine",header:"Override Creatinine",name:"Creatinine",units:"mg/dL",step:.1,range:"max",minAbsolute:0,maxAbsolute:4,value:2,acute_threshold:.3,acute_cmp:"GT",acute_arrow:"up"},{id:"override_urine_output",header:"Override Urine Output",name:"Urine Output",units:"mL/kg/hour",step:.1,range:"min",minAbsolute:0,maxAbsolute:3,value:.5,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"bilirubin",criteria_display_name:"Bilirubin > 2 mg/dL (34.2 mmol/L)",dropdown:"Bilirubin is normal",overrideModal:[{id:"override_bilirubin",header:"Override Bilirubin",name:"Bilirubin",units:"mg/dL",step:.01,range:"max",minAbsolute:0,maxAbsolute:4,value:2,acute_threshold:.3,acute_cmp:"GT",acute_arrow:"up"}],fixed:1},{key:"platelet",criteria_display_name:"Platelet count < 100,000",dropdown:"Platelet Count is normal",overrideModal:[{id:"override_platelet_count",header:"Override Platelet Count",name:"Platelet Count",units:"",step:100,range:"min",minAbsolute:0,maxAbsolute:2e5,value:1e5,acute_threshold:-50,acute_cmp:"LT",acute_arrow:"down"}],fixed:0},{key:"inr",criteria_display_name:"INR > 1.5 or PTT > 60 sec",dropdown:"INR is normal",overrideModal:[{id:"override_inr",header:"Override INR",name:"INR",units:"",step:.1,range:"max",minAbsolute:0,maxAbsolute:15,value:1.5,acute_threshold:null,acute_cmp:null,acute_arrow:null},{id:"override_ptt",header:"Override PTT",name:"PTT",units:"sec",step:1,range:"max",minAbsolute:0,maxAbsolute:120,value:60,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"lactate",criteria_display_name:"Lactate > 2mmol/L: (18.0 mg/dL)",dropdown:"Lactate is normal",overrideModal:[{id:"override_lactate_measurement",header:"Override Lactate Measurement",name:"Lactate",units:"mmol/L",step:.01,range:"max",minAbsolute:0,maxAbsolute:4,value:2,acute_threshold:.1,acute_cmp:"GT",acute_arrow:"up"}],fixed:1}],criteria_mapping:[{src:"blood_pressure",dst:"trews_sbpm"},{src:"mean_arterial_pressure",dst:"trews_map"},{src:"decrease_in_sbp",dst:"trews_dsbp"},{src:"respiratory_failure",dst:"trews_vent"},{src:"creatinine",dst:"trews_creatinine"},{src:"bilirubin",dst:"trews_bilirubin"},{src:"platelet",dst:"trews_platelet"},{src:"inr",dst:"trews_inr"},{src:"lactate",dst:"trews_lactate"}]},trews:{key:"trews",display_name:"TREWS Acuity Score",criteria:[{key:"trews",criteria_display_name:"TREWS Acuity Score indicates high risk of deterioration",dropdown:"TREWS Acuity Score is normal",overrideModal:[{id:"override_trews",header:"Override TREWS Score assessment",name:"TREWS Acuity Score",units:"",step:.05,range:"max",minAbsolute:0,maxAbsolute:1,value:.75,acute_threshold:null,acute_cmp:null,acute_arrow:null}]}]},trews_organ_dysfunction:{key:"trews_org",display_name:"TREWS Organ Dysfunction Criteria",criteria:[{key:"trews_sbpm",criteria_display_name:"Systolic Blood Pressure < 90",dropdown:"Blood pressure is normal",overrideModal:[{id:"override_trews_sbpm",header:"Override Blood Pressure",name:"Systolic Blood Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:180,value:90,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"trews_map",criteria_display_name:"Mean arterial pressure < 65",dropdown:"Mean arterial pressure is normal",overrideModal:[{id:"override_trews_map",header:"Override Mean Arterial Pressure",name:"Mean Arterial Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:180,value:65,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"trews_dsbp",criteria_display_name:"Decrease in SBP by > 40 mmHg from the last recorded SBP considered normal for given patient",dropdown:"Decrease in SBP is normal",overrideModal:[{id:"override_trews_dsbp",header:"Override Decrease in Systolic Blood Pressure",name:"Decrease in Systolic Blood Pressure",units:"mmHg",step:1,range:"max",minAbsolute:0,maxAbsolute:100,value:40,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"trews_vent",criteria_display_name:"Acute respiratory failure evidenced by invasive or non-invasive ventiliation",dropdown:"Respiratory failure is normal",overrideModal:[{id:"override_trews_vent",header:"Override Respiratory Failure",name:"Respiratory Failure (Mechanical Ventilation Initiated)",units:"",step:1,range:"max",minAbsolute:0,maxAbsolute:1,value:0,acute_threshold:null,acute_cmp:null,acute_arrow:null}],precision:1},{key:"trews_creatinine",baseline_key:"baseline_creatinine",criteria_display_name:"Creatinine > 1.5 mg/dL",baseline_display_name:"0.5 mg/dL increase",baseline_trend:"increased",dropdown:"Creatinine is normal",overrideModal:[{id:"override_trews_creatinine",header:"Override Creatinine",name:"Creatinine",units:"mg/dL",step:.1,range:"max",minAbsolute:0,maxAbsolute:4,value:1.5,acute_threshold:.3,acute_cmp:"GT",acute_arrow:"up"}],fixed:1},{key:"trews_bilirubin",baseline_key:"baseline_bilirubin",criteria_display_name:"Bilirubin > 2 mg/dL (34.2 mmol/L)",baseline_display_name:"100%",baseline_trend:"increased",dropdown:"Bilirubin is normal",overrideModal:[{id:"override_trews_bilirubin",header:"Override Bilirubin",name:"Bilirubin",units:"mg/dL",step:.01,range:"max",minAbsolute:0,maxAbsolute:4,value:2,acute_threshold:.3,acute_cmp:"GT",acute_arrow:"up"}],fixed:1},{key:"trews_platelet",baseline_key:"baseline_platelets",criteria_display_name:"Platelet count < 100,000",baseline_display_name:"50% decrease",baseline_trend:"decreased",dropdown:"Platelet Count is normal",overrideModal:[{id:"override_trews_platelet",header:"Override Platelet Count",name:"Platelet Count",units:"",step:100,range:"min",minAbsolute:0,maxAbsolute:2e5,value:1e5,acute_threshold:-50,acute_cmp:"LT",acute_arrow:"down"}],fixed:0},{key:"trews_inr",baseline_key:"baseline_inr",criteria_display_name:"INR > 1.5 or PTT > 60 sec",baseline_display_name:"0.5 INR increase",baseline_trend:"increased",dropdown:"INR is normal",overrideModal:[{id:"override_trews_inr",header:"Override INR",name:"INR",units:"",step:.1,range:"max",minAbsolute:0,maxAbsolute:15,value:1.5,acute_threshold:null,acute_cmp:null,acute_arrow:null},{id:"override_trews_ptt",header:"Override PTT",name:"PTT",units:"sec",step:1,range:"max",minAbsolute:0,maxAbsolute:120,value:60,acute_threshold:null,acute_cmp:null,acute_arrow:null}],fixed:1},{key:"trews_lactate",criteria_display_name:"Lactate > 2mmol/L: (18.0 mg/dL)",dropdown:"Lactate is normal",overrideModal:[{id:"override_trews_lactate",header:"Override Lactate Measurement",name:"Lactate",units:"mmol/L",step:.01,range:"max",minAbsolute:0,maxAbsolute:4,value:2,acute_threshold:.1,acute_cmp:"GT",acute_arrow:"up"}],fixed:1},{key:"trews_gcs",criteria_display_name:"GCS < 13",dropdown:"GCS is normal",overrideModal:[{id:"override_trews_gcs",header:"Override GCS",name:"GCS",units:"",step:1,range:"min",minAbsolute:3,maxAbsolute:15,value:13,acute_threshold:2,acute_cmp:"GT",acute_arrow:"up"}],fixed:0},{key:"trews_vasopressors",criteria_display_name:"Vasopressors Initiated",dropdown:"Vasopressors is normal",overrideModal:[{id:"override_trews_vasopressors",header:"Override Vasopressors",name:"Vasopressors Initiated",units:"",step:1,range:"max",minAbsolute:0,maxAbsolute:1,value:0,acute_threshold:null,acute_cmp:null,acute_arrow:null}],precision:1}],criteria_mapping:[{src:"trews_sbpm",dst:"blood_pressure"},{src:"trews_map",dst:"mean_arterial_pressure"},{src:"trews_dsbp",dst:"decrease_in_sbp"},{src:"trews_vent",dst:"respiratory_failure"},{src:"trews_creatinine",dst:"creatinine"},{src:"trews_bilirubin",dst:"bilirubin"},{src:"trews_platelet",dst:"platelet"},{src:"trews_inr",dst:"inr"},{src:"trews_lactate",dst:"lactate"},{src:"trews_gcs",dst:null},{src:"trews_vasopressors",dst:null}]}},septic_shock={display_name:"Septic Shock Monitoring",tension:{key:"tension",display_name:"Persistent Hypotension",criteria:[{key:"hypotension_sbp",criteria_display_name:"Systolic blood pressure (SBP) < 90",dropdown:"Systolic Blood Pressure is normal",overrideModal:[{id:"override_sbp",header:"Override Systolic Blood Pressure",name:"Systolic Blood Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:180,value:90}],precision:4},{key:"hypotension_map",criteria_display_name:"Mean arterial pressure < 65",dropdown:"Mean Arterial Pressure is normal",overrideModal:[{id:"override_mean_arterial_pressure",header:"Override Mean Arterial Pressure",name:"Mean Arterial Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:130,value:65}],precision:3},{key:"hypotension_dsbp",criteria_display_name:"Decrease in SBP by > 40 mmHg from the last recorded SBP considered normal for given patient",dropdown:"Decrease in sbp is normal",overrideModal:[{id:"override_decrease_in_sbp",header:"Override Decrease in Systolic Blood Pressure",name:"Decrease in Systolic Blood Pressure",units:"mmHg",step:1,range:"max",minAbsolute:0,maxAbsolute:80,value:40}],precision:4}]},fusion:{key:"fusion",display_name:"Tissue Hypoperfusion",criteria:[{key:"initial_lactate",criteria_display_name:"Initial Lactate level is >= 4 mmol/L",dropdown:"Initial Lactate Measurement is normal",overrideModal:[{id:"override_initial_lactate_measurement",header:"Override Initial Lactate Measurement",name:"Initial Lactate Measurement",units:"mmol/L",step:.01,range:"max",minAbsolute:0,maxAbsolute:8,value:4}],precision:2}]}};workflows={sev3:{display_name:"Severe Sepsis 3hr Interventions",instruction:"Begins after onset of severe sepsis",not_yet:"No severe sepsis, no action required."},sev6:{display_name:"Severe Sepsis 6hr Interventions",instruction:"Begins after initial lactate measurement",not_yet:"No severe sepsis, no action required."},sep6:{display_name:"Septic Shock 6hr Interventions",instruction:"Begins after onset of septic shock",not_yet:"No septic shock, no action required."},init_lactate:{display_name:"Initial Lactate",as_dose:!1},blood_culture:{display_name:"Blood Culture",as_dose:!1},antibiotics:{display_name:"Antibiotics",as_dose:!0},fluid:{display_name:"Fluid",as_dose:!0},repeat_lactate:{display_name:"Repeat Lactate",as_dose:!1},vasopressors:{display_name:"Vasopressors",as_dose:!0}};var doseLimits={antibiotics:0,fluid:0,vasopressors:0},STATIC={severe_sepsis:severe_sepsis,septic_shock:septic_shock},FID_TO_HUMAN_READABLE={vent:"Mechanical Ventilation",pao2:"PaO2",paco2:"PaCO2",fio2:"FiO2",amylase:"Amylase",mapm:"MAP",temperature:"Temperature",sodium:"Sodium",penicillin_dose:"Penicillin",meropenem_dose:"Meropenem",rass:"RASS",resp_rate:"Respiratory Rate",amoxicillin_dose:"Amoxicillin",nbp:"Blood Pressure",erythromycin_dose:"Erythromycin",bands:"Bands",cefazolin_dose:"Cefazolin",clindamycin_dose:"Clindamycin",bun:"BUN",nbp_sys:"Non-invasive Systolic BP",tobramycin_dose:"Tobramycin",rapamycin_dose:"Rapamycin",ceftazidime_dose:"Ceftazidime",bun_to_cr:"BUN to Creatinine Ratio",epinephrine_dose:"Epinephrine",crystalloid_fluid:"Total Crystalloid Fluid",wbc:"WBC",weight:"Weight",admit_weight:"Admission Weight",hemoglobin:"Hemoglobin",spo2:"SpO2",platelets:"Platelets",arterial_ph:"Arterial pH",inr:"INR",rifampin_dose:"Rifampin",dopamine_dose:"Dopamine",nbp_dias:"Non-invasive Diastolic BP",ampicillin_dose:"Ampicillin",creatinine:"Creatinine",gentamicin_dose:"Gentamicin",vancomycin_dose:"Vancomycin",co2:"CO2",bilirubin:"Bilirubin",ast_liver_enzymes:"AST Liver Enzymes",dobutamine_dose:"Dobutamine",gcs:"GCS",levophed_infusion_dose:"Levophed",oxacillin_dose:"Oxacillin_dose",fluids_intake:"Total Fluid Intake",piperacillin_tazbac_dose:"Piperacillin/tazobactam",lactate:"Lactate",lipase:"Lipase",heart_rate:"Heart Rate",urine_output:"Urine Output"};String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),Date.prototype.toISOString||function(){function e(e){return e<10?"0"+e:e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}(),jQuery.fn.hasScrollBar=function(){var e=this.get(0);return{vertical:e.scrollHeight>e.clientHeight,horizontal:e.scrollWidth>e.clientWidth}};var release=$("body").attr("release"),epicToken=null,lastAction=null;window.onload=function(){lastAction="handshake",window.addEventListener("message",Listener,!1),window.parent.postMessage({action:"Epic.Clinical.Informatics.Web.InitiateHandshake"},"*"),timer.init(),dropdown.init(),overrideModal.init(),notifications.init(),activity.init(),toolbar.init(),dataRefresher.init(),notificationRefresher.init(),deterioration.init(),timeline.init(),treatmentOverrideComponent.init(),$("#fake-console").text(window.location),$("#fake-console").hide(),$("#show-console").click(function(){$("#fake-console").toggle()}),refreshHeaderHeight("onload")},window.onunload=function(){var e=window.location.hostname.indexOf("localhost")>-1?"http://localhost:8000/api":window.location.protocol+"//"+window.location.hostname+"/api",t={q:!1===getQueryVariable("PATID")?null:getQueryVariable("PATID"),u:!1===getQueryVariable("USERID")?null:cleanUserId(getQueryVariable("USERID")),s:!1===getQueryVariable("TSESSID")?null:getQueryVariable("TSESSID"),depid:!1===getQueryVariable("DEP")?null:getQueryVariable("DEP"),csn:!1===getQueryVariable("CSN")?null:getQueryVariable("CSN"),loc:!1===getQueryVariable("LOC")?null:getQueryVariable("LOC"),actionType:"close_session",action:{"session-close":"unload","session-id":!1===getQueryVariable("TSESSID")?null:getQueryVariable("TSESSID")}};$.ajax({type:"POST",async:!1,url:e,data:JSON.stringify(t),dataType:"json"})},window.onerror=function(e,t,s){controller.sendLog({acc:"error",data:"ERR:"+e+" URL:"+t+" L:"+s},!0)},window.onresize=function(){refreshHeaderHeight("onresize")};var trews=new function(){this.data={},this.isTest=!1,this.setData=function(e){null!=this.data&&(e.antibiotics_details=this.data.antibiotics_details),this.data=e},this.setNotifications=function(e){this.data?this.data.notifications=e:this.data={notifications:e}},this.setAntibiotics=function(e){this.data?this.data.antibiotics_details=e:this.data={antibiotics_details:e}},this.getCriteria=function(e){switch(e){case"sirs":return this.data.severe_sepsis.sirs.criteria;case"org":case"organ_dysfunction":return this.data.severe_sepsis.organ_dysfunction.criteria;case"trews_org":case"trews_organ_dysfunction":return this.data.severe_sepsis.trews_organ_dysfunction.criteria;case"tension":return this.data.septic_shock.hypotension.criteria;case"fusion":return this.data.septic_shock.hypoperfusion.criteria}},this.getSpecificCriteria=function(e,t){for(var s=this.getCriteria(e),i=0;i<s.length;i++)if(s[i].name==t)return s[i];return null},this.getMetCriteria=function(e){var t=[],s=isString(e)?this.getCriteria(e):e;for(var i in s)!0===s[i].is_met&&t.push(i);return t},this.getOverriddenCriteria=function(e){var t=[],s=e instanceof String?this.getCriteria(e):e;for(var i in s)null!=s[i].override_user&&t.push(i);return t},this.orderIsDone=function(e){return!!this.data[e]&&(this.data[e].is_met&&orderStatusCompleted(this.data[e]))},this.getIncompleteSevereSepsis3hr=function(){return(this.orderIsDone("antibiotics_order")?0:1)+(this.orderIsDone("initial_lactate_order")?0:1)+(this.orderIsDone("blood_culture_order")?0:1)+(this.orderIsDone("crystalloid_fluid_order")?0:1)},this.getIncompleteSevereSepsis6hr=function(){return this.orderIsDone("repeat_lactate_order")?0:1},this.getIncompleteSepticShock=function(){return this.orderIsDone("vasopressors_order")?0:1}},dataRefresher=new function(){this.refreshPeriod=3e4,this.refreshTimer=null,this.init=function(){this.poll(this)},this.poll=function(e){endpoints.getPatientData(),e.refreshTimer=window.setTimeout(function(){e.poll(e)},e.refreshPeriod)},this.terminate=function(){this.refreshTimer&&(window.clearTimeout(this.refreshTimer),this.refreshTimer=null)}},notificationRefresher=new function(){this.refreshPeriod=1e4,this.refreshTimer=null,this.init=function(){window.setTimeout(function(){notificationRefresher.poll(notificationRefresher)},2e3)},this.poll=function(e){endpoints.getPatientData("poll_notifications"),e.refreshTimer=window.setTimeout(function(){e.poll(e)},e.refreshPeriod)},this.terminate=function(){this.refreshTimer&&(window.clearTimeout(this.refreshTimer),this.refreshTimer=null)}},endpoints=new function(){this.url=window.location.hostname.indexOf("localhost")>-1?"http://localhost:8000/api":window.location.protocol+"//"+window.location.hostname+"/api",this.numTries=1,this.getPatientData=function(e,t,s){postBody={q:!1===getQueryVariable("PATID")?null:getQueryVariable("PATID"),u:!1===getQueryVariable("USERID")?null:cleanUserId(getQueryVariable("USERID")),s:!1===getQueryVariable("TSESSID")?null:getQueryVariable("TSESSID"),depid:!1===getQueryVariable("DEP")?null:getQueryVariable("DEP"),csn:!1===getQueryVariable("CSN")?null:getQueryVariable("CSN"),loc:!1===getQueryVariable("LOC")?null:getQueryVariable("LOC"),actionType:e||null,action:t||null},"true"==getQueryVariable("test")||trews.isTest?"true"==getQueryVariable("console")&&this.test():null!=postBody.q?$.ajax({type:"POST",url:this.url,data:JSON.stringify(postBody),dataType:"json",start_time:(new Date).getTime()}).done(function(e){if($("body").removeClass("waiting"),s&&s.removeClass("loading"),null!=trews.data.chart_data||e.hasOwnProperty("trewsData")){var t=!1;if(null!=trews.data&&null!=trews.data.profile?t=trews.data.profile.age<18||trews.data.profile.excluded_units:e.hasOwnProperty("trewsData")&&null!=e.trewsData.profile&&(t=e.trewsData.profile.age<18||e.trewsData.profile.excluded_units),t){$("#loading").removeClass("waiting").spin(!1);$("#loading p").html("<b>Disabling TREWS, this patient meets our exclusion criteria.</b><br/><b>Patient is less than 18 years old, or has been treated in an excluded hospital unit.</b><br/>Please contact trews-helpdesk@opsdx.io for more information.")}else{if(e.hasOwnProperty("trewsData")){if($("#loading").removeClass("waiting").spin(!1),trews.setData(e.trewsData),trews.data&&null!=trews.data.profile.refresh_time){var i="Last refreshed from Epic at "+strToTime(new Date(1e3*trews.data.profile.refresh_time),!0,!0)+".";$("h1 #header-refresh-time").text(i)}controller.refresh(),controller.refreshOrderDetails("antibiotics-details"),deterioration.dirty=!1}else e.hasOwnProperty("notifications")?(trews.setNotifications(e.notifications),controller.refreshNotifications()):e.hasOwnProperty("antibiotics_result")&&(trews.setAntibiotics(e.antibiotics_result),controller.refreshOrderDetails("antibiotics-details"));$("#loading").html(""),$("#loading").addClass("done")}timer.log(this.url,this.start_time,(new Date).getTime(),"success")}else appendToConsole("Dropping message "+JSON.stringify(e))}).fail(function(e){if($("body").removeClass("waiting"),$("#loading").removeClass("waiting").spin(!1),s&&s.removeClass("loading"),400==e.status){var t=e.responseJSON.message;return null!=e.responseJSON.standalone&&e.responseJSON.standalone||(t+=".<br/>  Connection Failed<span id='test-data'>.</span> Please rest<span id='see-blank'>a</span>rt application or contact trews-helpdesk@opsdx.io"),$("#loading p").html(t),void $("#test-data").click(function(){endpoints.test()})}endpoints.numTries+=1,endpoints.numTries>3?($("#loading p").html("Connection Failed<span id='test-data'>.</span> Please rest<span id='see-blank'>a</span>rt application or contact trews-helpdesk@opsdx.io"),$("#test-data").click(function(){endpoints.test()}),$("#see-blank").click(function(){$("#loading").html(""),$("#loading").addClass("done")})):($("#loading p").text("Connection Failed. Retrying...("+endpoints.numTries+")"),endpoints.getPatientData()),timer.log(this.url,this.start_time,(new Date).getTime(),"error: "+endpoints.numTries+" tries")}):$("#loading p").html("No Patient Identifier entered. Please restart application or contact trews-helpdesk@opsdx.io<br/>"+window.location)},this.test=function(){trews.isTest=!0,$.ajax({type:"GET",url:"js/data_example.json",contentType:"json",xhrFields:{withCredentials:!1},success:function(e){$("#loading").html(""),$("#loading").addClass("done"),trews.setData(e.trewsData),controller.refresh()}})}},controller=new function(){this.clean=function(){$(".criteria").html("")},this.refresh=function(){this.clean();var e=trews.data;workflowsComponent.render(e.antibiotics_order,e.blood_culture_order,e.crystalloid_fluid_order,e.initial_lactate_order,e.repeat_lactate_order,e.vasopressors_order,e.ui,e.severe_sepsis.onset_time,e.septic_shock.onset_time),notifications.render(e.notifications),activity.render(e.auditlist),toolbar.render(e.severe_sepsis),deterioration.render(e.deterioration_feedback),severeSepsisComponent.render(e.severe_sepsis),septicShockComponent.render(e.septic_shock,e.severe_sepsis.is_met),timeline.render(e),treatmentOverrideComponent.render(e.severe_sepsis,e.septic_shock,e.ui),careSummaryComponent.render(),getHeaderHeight().total!=parseInt($("#left-column").css("top"),10)&&refreshHeaderHeight("onrefresh")},this.refreshNotifications=function(){var e=trews.data;notifications.render(e.notifications)},this.refreshOrderDetails=function(e){var t="antibiotics-details"==e?"antibiotics_order":null;if(null==e||null==t)throw"Failed to refresh order details";var s=[],i="",r="Clinically Inappropriate";if(trews.data&&trews.data[t]&&null!=trews.data[t].status&&trews.data[t].status.startsWith(r)&&(i=r,trews.data[t].status.length>r.length+1&&(i+=": "+trews.data[t].status.substr(r.length+1)),s.push(i)),null!=trews.data.antibiotics_details)for(var a in trews.data.antibiotics_details){var n=trews.data.antibiotics_details[a].order_name;-1===s.indexOf(n)&&s.push(n)}var o=$("span[data-trews='"+e+"']").find(".inspect"),l=$(".order-details-content[data-trews='"+e+"']").find(".status");detailsComponent=new orderDetailsComponent(s),o.hasClass("unhidden")?l.removeClass("hidden").addClass("unhidden"):l.removeClass("unhidden").addClass("hidden"),l.html(detailsComponent.r())},this.displayJSError=function(){dataRefresher.terminate(),notificationRefresher.terminate(),$("#loading").removeClass("done"),$("#loading p").html("Javascript Error<span id='test-data'>.</span> Please rest<span id='see-blank'>a</span>rt application or contact trews-helpdesk@opsdx.io"),$("#test-data").click(function(){endpoints.test()}),$("#see-blank").click(function(){$("#loading").html(""),$("#loading").addClass("done")})},this.sendLog=function(e,t){$.ajax({type:"POST",url:"log",data:JSON.stringify(e),dataType:"json"}).done(function(e){t&&controller.displayJSError()}).fail(function(e){t&&controller.displayJSError()})},this.sendFeedback=function(e){$.ajax({type:"POST",url:"feedback",data:JSON.stringify(e),dataType:"json"}).done(function(e){toolbar.feedbackSuccess()}).fail(function(e){toolbar.feedbackError()})}},timer=new function(){this.refreshPeriod=6e4,this.refreshTimer=null,this.buffer=[],this.init=function(){this.sendBuffer(this),window.addEventListener?window.addEventListener("beforeunload",function(e){timer.buffer.length>0&&controller.sendLog({buffer:timer.buffer},!1)}):window.attachEvent("beforeunload",function(e){timer.buffer.length>0&&controller.sendLog({buffer:timer.buffer},!1)})},this.log=function(e,t,s,i){var r={currentUrl:window.location.href,destinationURL:e,start_time:t,end_time:s,status:i};this.buffer.push(r)},this.sendBuffer=function(e){timer.buffer.length>0&&(controller.sendLog({buffer:timer.buffer},!1),timer.buffer=[]),e.refreshTimer=window.setTimeout(function(){e.sendBuffer(e)},e.refreshPeriod)},this.terminate=function(){this.refreshTimer&&(window.clearTimeout(this.refreshTimer),this.refreshTimer=null)}},slotComponent=function(e,t,s,i,r,a,n,o){this.criteria={},this.elem=e,this.link=t,this.display_name=s,this.skip_summary=i,this.border_with_status=r,this.criteria_source=a,this.skip_threshold_and_value=n,this.skip_complete=o,this.hasOverridenCriteria=function(){var e=[];for(var t in this.criteria)null!=this.criteria[t].override_user&&e.push(t);return e},this.r=function(e,t,s){if(this.criteria=e.criteria,this.constants=t,this.display_name?(this.elem.find("h3").text(this.constants.display_name),this.elem.find("h3").show()):(this.elem.find("h3").text(""),this.elem.find("h3").hide()),this.skip_complete?e.is_met?this.elem.addClass("skip-complete"):this.elem.removeClass("skip-complete"):this.border_with_status?e.is_met?this.elem.removeClass("incomplete-with-status").addClass("complete-with-status"):this.elem.removeClass("complete-with-status").addClass("incomplete-with-status"):e.is_met?this.elem.addClass("complete"):this.elem.removeClass("complete"),null!=this.criteria){this.elem.find(".criteria").html(""),this.elem.find(".criteria-overridden").html("");for(var i in this.criteria){var r=new criteriaComponent(this.criteria[i],this.constants.criteria[i],this.constants.key,this.link.hasClass("hidden"),null==s?null:s[i],this.criteria_source,this.skip_threshold_and_value);if(r.isOverridden?this.elem.find(".criteria-overridden").append(r.r()):this.elem.find(".criteria").append(r.r()),null!=r.criteria_button){var a=this.elem.find('.status[data-trews="criteria_'+r.name+'"] .criteria-btn');a.unbind(),a.click(function(e){$("#loading").addClass("waiting").spin();var t=[],s="true"==$(this).attr("data-as-enable"),i=$(this).attr("data-criteria-src"),r=$(this).attr("data-criteria-dst");if(null!=i){a={actionName:i};s?a.clear=!0:a.value=[{text:"No Infection"}],t.push(a)}if(null!=r){var a={actionName:r};s?a.clear=!0:a.value=[{text:"No Infection"}],t.push(a)}endpoints.getPatientData("override_many",t)})}}null==this.skip_summary||this.skip_summary?this.elem.find(".num").hide():(this.elem.find(".num-text").text(e.num_met+" criteria met. "),0==this.hasOverridenCriteria().length?(this.elem.find(".num-overridden").addClass("hidden"),this.elem.find(".criteria-overridden").addClass("hidden")):(this.elem.find(".num-overridden").removeClass("hidden"),this.elem.find(".criteria-overridden").removeClass("hidden"),this.elem.find(".num-overridden").text(this.hasOverridenCriteria().length+" customized criteria")),this.link.unbind(),this.link.click({elem:this.elem},function(e){$(this).hasClass("hidden")?(e.data.elem.find(".status.hidden").removeClass("hidden").addClass("unhidden"),$(this).text("minimize").removeClass("hidden")):(e.data.elem.find(".status.unhidden").removeClass("unhidden").addClass("hidden"),$(this).text("see all").addClass("hidden"),this.criteriaHidden=!0)}))}}},careSummaryComponent=new function(){this.ctn=$("[data-trews='care-summary']"),this.detailVisible=!1,this.detailSlot=new slotComponent($("[data-trews='care-summary-detail']"),$("#expand-care-detail"),!1,!1,!1,null,!1,!0),this.renderDetail=function(e,t){var s=null,i=null,r=null,a=null,n=null,o=null,l=null,d=null;if(e)n=trews.data.severe_sepsis.sirs.criteria[1].value,o=trews.data.severe_sepsis.organ_dysfunction.criteria[0].value,l=trews.data.severe_sepsis.organ_dysfunction.criteria[8].value,d=trews.data.severe_sepsis.organ_dysfunction.criteria[8].measurement_time;else try{trews_subalert_json="trews_subalert"in trews.data.severe_sepsis?trews.data.severe_sepsis.trews_subalert.value:null,null!=trews_subalert_json&&(trews_subalert_json=JSON.parse(trews_subalert_json),r=Number(trews_subalert_json.pct_mortality).toFixed(0),a=Number(trews_subalert_json.pct_sevsep).toFixed(0),n=null!=trews_subalert_json.heart_rate&&"value"in trews_subalert_json.heart_rate?trews_subalert_json.heart_rate.value:null,"lactate"in trews_subalert_json&&null!=trews_subalert_json.lactate&&(l=trews_subalert_json.lactate.value,d=new Date(trews_subalert_json.lactate.tsp)),"sbpm"in trews_subalert_json&&null!=trews_subalert_json.sbpm&&(o=trews_subalert_json.sbpm.value)),null==o&&(trews_sbp_json=trews.data.severe_sepsis.trews_organ_dysfunction.criteria[8].value,null!=trews_sbp_json&&(trews_sbp_json=JSON.parse(trews_sbp_json),o=trews_sbp_json.value)),null==l&&(trews_lactate_json=trews.data.severe_sepsis.trews_organ_dysfunction.criteria[8].value,null!=trews_lactate_json&&(trews_lactate_json=JSON.parse(trews_lactate_json),l=trews_lactate_json.value,d=trews.data.severe_sepsis.trews_organ_dysfunction.criteria[8].measurement_time))}catch(e){}e?s="TREWS Acuity Score does not indicate high risk of severe sepsis":null!=r&&null!=a&&(s="At this TREWS Acuity Score, there is an <b>"+r+"%</b> in-hospital mortality rate.",i="<b>"+a+"%</b> of individuals experience severe sepsis."),null!=n&&null!=o&&Number(n/o).toFixed(3),null!=l&&null!=d&&strToTime(d,!0,!1);var u="<ul>"+(null==s?"":"<li>"+s+"</li>")+(null==i?"":"<br><li>"+i+"</li>")+(null!=t?"<br><li>"+t+"</li>":"")+"</ul>";this.detailSlot.elem.find(".criteria").html(u),this.detailSlot.elem.addClass("skip-complete"),this.detailSlot.elem.find(".num").hide()},this.render=function(){var e="trews_subalert"in trews.data.severe_sepsis&&trews.data.severe_sepsis.trews_subalert.is_met,t=trews.data.severe_sepsis.sirs.is_met&&trews.data.severe_sepsis.organ_dysfunction.is_met,s=trews.data.ui.ui_deactivate.is_met,i=!e&&t,r=!trews.data.severe_sepsis.is_trews&&trews.data.severe_sepsis.is_cms,a=!s&&(e||t),n=i||r,o=longPatientSummary(!0,1,!1,!1,!0,!0,!0,a?'&nbsp;&nbsp;<span class="summary-more-detail">More Detail</span>':null),l=o.care_status;this.ctn.find("h4").html(l),a&&this.renderDetail(n,o.cms_status),this.detailVisible?(this.detailSlot.elem.removeClass("hidden").addClass("unhidden"),a&&this.ctn.find("h4 span.summary-more-detail").text("Less Detail")):(this.detailSlot.elem.removeClass("unhidden").addClass("hidden"),a&&this.ctn.find("h4 span.summary-more-detail").text("More Detail")),a&&(this.ctn.find("h4 span.summary-more-detail").unbind(),this.ctn.find("h4 span.summary-more-detail").click(function(e){careSummaryComponent.detailSlot.elem.hasClass("hidden")?careSummaryComponent.detailSlot.elem.removeClass("hidden").addClass("unhidden"):careSummaryComponent.detailSlot.elem.removeClass("unhidden").addClass("hidden"),careSummaryComponent.detailVisible=!careSummaryComponent.detailVisible,careSummaryComponent.ctn.find("h4 span.summary-more-detail").text(careSummaryComponent.detailVisible?"Less Detail":"More Detail")}))}},treatmentOverrideComponent=new function(){this.uncertain_sevsep_ctn=$('[data-trews="uncertain-sepsis"]'),this.uncertain_sevsep_btn=null,this.sevsep_override_ctn=$('[data-trews="treat-sepsis"]'),this.sevsep_override_btn=null,this.sepshk_override_ctn=$('[data-trews="treat-shock"]'),this.sepshk_override_btn=null,this.init=function(){this.uncertain_sevsep_btn=$("#uncertain-sepsis-toggle"),this.sevsep_override_btn=$("#severe-sepsis-toggle"),this.sepshk_override_btn=$("#septic-shock-toggle"),this.uncertain_sevsep_btn.click(function(e){$("#loading").addClass("waiting").spin();var t={actionName:"ui_deactivate",is_met:e.target.checked};if(e.target.checked){var s=new Date(Date.now()+3e6);t.value=[{type:"uncertain",until:s.toISOString()}]}else t.clear=!0;endpoints.getPatientData("override",t)}),this.sevsep_override_btn.click(function(e){$("#loading").addClass("waiting").spin();var t={actionName:"ui_severe_sepsis",is_met:e.target.checked};e.target.checked?t.value=[{text:"dummy"}]:t.clear=!0,endpoints.getPatientData("override",t)}),this.sepshk_override_btn.click(function(e){$("#loading").addClass("waiting").spin();var t={actionName:"ui_septic_shock",is_met:e.target.checked};e.target.checked?t.value=[{text:"dummy"}]:t.clear=!0,endpoints.getPatientData("override",t)})},this.render=function(e,t,s){this.uncertain_sevsep_ctn.find("h4").removeClass("inactive"),this.uncertain_sevsep_ctn.find(".onoffswitch").removeClass("inactive"),this.sevsep_override_ctn.find("h4").removeClass("inactive"),this.sevsep_override_ctn.find(".onoffswitch").removeClass("inactive"),this.sepshk_override_ctn.find("h4").removeClass("inactive"),this.sepshk_override_ctn.find(".onoffswitch").removeClass("inactive");var i=s.ui_severe_sepsis.is_met||s.ui_septic_shock.is_met,r=i||e.is_met||t.is_met||null!=trews.data.severe_sepsis.suspicion_of_infection.value,a=!r&&s.ui_deactivate.is_met;if(r)this.uncertain_sevsep_ctn.find("h4").addClass("inactive"),this.uncertain_sevsep_ctn.find(".onoffswitch").addClass("inactive");else if(this.uncertain_sevsep_btn.attr("checked",s.ui_deactivate.is_met),s.ui_deactivate.is_met&&null!=s.ui_deactivate.override_value){if(null!=s.ui_deactivate.override_value){var n=Date.now(),n=Date.now(),o=new Date(s.ui_deactivate.override_value[0].until);(o=new Date(3e5*Math.ceil((o.getTime()+6e5)/3e5)))<=n&&(o=new Date(n+3e5));var l=new Date(o-n),d=60*l.getUTCHours()+l.getUTCMinutes(),u=1==d?" minute":" minutes",c=(d=Math.max(5*Math.ceil(d/5),5))<=15?"approximately ":"";this.uncertain_sevsep_ctn.find("h4").text("Re-evaluate in "+c+d+u)}}else this.uncertain_sevsep_ctn.find("h4").text("Re-evaluate in 1 hr");a||s.ui_septic_shock.is_met||!i&&(e.is_met||t.is_met)?(this.sevsep_override_ctn.find("h4").addClass("inactive"),this.sevsep_override_ctn.find(".onoffswitch").addClass("inactive")):this.sevsep_override_btn.attr("checked",s.ui_severe_sepsis.is_met),a||!i&&t.is_met?(this.sepshk_override_ctn.find("h4").addClass("inactive"),this.sepshk_override_ctn.find(".onoffswitch").addClass("inactive")):this.sepshk_override_btn.attr("checked",s.ui_septic_shock.is_met)}},severeSepsisComponent=new function(){this.sus={},this.ctn=$("[data-trews='severeSepsis']"),this.susCtn=$("[data-trews='sus']"),this.acuteOrgCtn=$("[data-trews='eval-acute-orgdf']"),this.noInfectionBtn=$(".no-infection-btn");for(var e in INFECTIONS){var t=$("<option></option>").text(INFECTIONS[e]);$(".selection select").append(t)}this.orgSlot=new slotComponent($("[data-trews='eval-orgdf']"),$("#expand-org"),!1,!0,!1,null,!1,!0),this.highlightSuspicionClass=function(){var e=trews.data.severe_sepsis.onset_time,t=trews.data.septic_shock.onset_time,s="trews_subalert"in trews.data.severe_sepsis&&trews.data.severe_sepsis.trews_subalert.is_met&&null==e&&null==t,i=trews.data.severe_sepsis.sirs.is_met&&trews.data.severe_sepsis.organ_dysfunction.is_met&&null==e&&null==t;return s||i?"highlight-expired":null},this.suspicion=function(e){this.susCtn.find("h3").text(e.display_name),this.susCtn.removeClass("inactive complete complete-with-status complete-no-infection highlight-expired highlight-unexpired");var t=trews.data.ui.ui_deactivate.is_met;if(null==this.sus.value&&t)this.susCtn.addClass("inactive");else if(null==this.sus.value){var s=this.highlightSuspicionClass();null!=s?(this.susCtn.addClass(s),this.susCtn.find(".status").show(),this.susCtn.find(".status h4").text("")):this.susCtn.find(".status").hide(),this.susCtn.find(".status h5").html("")}else{"No Infection"!=this.sus.value?this.susCtn.addClass("complete-with-status"):this.susCtn.addClass("complete-no-infection"),this.susCtn.find(".status").show(),this.susCtn.find(".selection").hide(),this.susCtn.find(".status h4").text(this.sus.value);var i=null;this.sus.update_user&&(i="by "+this.sus.update_user),this.sus.update_time&&(i=(i?i+" ":"")+'at <span title="'+strToTime(new Date(1e3*this.sus.update_time))+'">'+timeLapsed(new Date(1e3*this.sus.update_time))+"</span>"),i&&this.susCtn.find(".status h5").html(i)}},this.render=function(e){this.ctn.find("h2.card-header").text(severe_sepsis.display_name);var t="trews_subalert"in e&&e.trews_subalert.is_met,s=e.sirs.is_met&&e.organ_dysfunction.is_met,i=0==trews.data.severe_sepsis.trews_organ_dysfunction.num_met&&trews.data.severe_sepsis.trews_organ_dysfunction.num_overridden>0,r=0==trews.data.severe_sepsis.organ_dysfunction.num_met&&trews.data.severe_sepsis.organ_dysfunction.num_overridden>0;i||trews.data.severe_sepsis.sirs.is_met;this.ctn.removeClass("complete complete-no-infection"),e.is_met?this.ctn.addClass("complete"):"No Infection"==e.suspicion_of_infection.value&&this.ctn.addClass("complete-no-infection"),this.sus=e.suspicion_of_infection,this.suspicion(severe_sepsis.suspicion_of_infection);var a=$('[data-trews="eval-acute-orgdf"]');a.find("h3").text("Below, we list likely sources of organ dysfunction that triggered the alert. Remove any that you believe are not due to infection."),a.removeClass("inactive highlight-expired highlight-unexpired"),this.susCtn.hasClass("highlight-expired")?a.addClass("highlight-expired"):this.susCtn.hasClass("highlight-unexpired")&&a.addClass("highlight-unexpired");var n=!t&&s,o=!trews.data.severe_sepsis.is_trews&&trews.data.severe_sepsis.is_cms,l=n||o,d=!t&&trews.data.severe_sepsis.sirs.is_met&&r,u=!i&&(d||l);this.orgSlot.r(u?e.organ_dysfunction:e.trews_organ_dysfunction,u?severe_sepsis.organ_dysfunction:severe_sepsis.trews_organ_dysfunction,u?severe_sepsis.organ_dysfunction.criteria_mapping:severe_sepsis.trews_organ_dysfunction.criteria_mapping);var c=u?e.organ_dysfunction.num_met:e.trews_organ_dysfunction.num_met,p=u?e.organ_dysfunction.num_overridden:e.trews_organ_dysfunction.num_overridden,h=trews.data.ui.ui_severe_sepsis.is_met||trews.data.ui.ui_septic_shock.is_met,m=trews.data.ui.ui_deactivate.is_met;(0==c&&0==p&&!h||m)&&a.addClass("inactive"),this.noInfectionBtn.unbind(),this.noInfectionBtn.removeClass("pressed"),"No Infection"!=this.sus.value?this.noInfectionBtn.click(function(e){$("#loading").addClass("waiting").spin();var t={actionName:$(this).attr("data-trews"),value:"No Infection"};endpoints.getPatientData("suspicion_of_infection",t)}):this.noInfectionBtn.addClass("pressed"),trews.data.profile.deactivated||workflowsComponent.sev36Override||workflowsComponent.sep6Override?this.ctn.addClass("inactive"):this.ctn.removeClass("inactive")}},septicShockComponent=new function(){this.ctn=$("[data-trews='septicShock']"),this.fnote=$("#fluid-note"),this.fnoteBtn=$("#fluid-note-btn"),this.tenSlot=new slotComponent($("[data-trews='tension']"),$("#expand-ten"),!0,!1,!1),this.fusSlot=new slotComponent($("[data-trews='fusion']"),$("#expand-fus"),!0,!1,!1),this.render=function(e,t){this.ctn.find("h2.card-header").text(septic_shock.display_name),e.is_met?this.ctn.addClass("complete"):this.ctn.removeClass("complete"),this.tenSlot.r(e.hypotension,septic_shock.tension),this.fusSlot.r(e.hypoperfusion,septic_shock.fusion),this.fnoteBtn.unbind(),e.crystalloid_fluid.is_met?this.fnote.addClass("complete"):this.fnote.removeClass("complete");var s=null;if(s=e.crystalloid_fluid.is_met?"Reset":"Clinically Inappropriate"){this.fnoteBtn.text(s);var i={actionName:"crystalloid_fluid"};"Clinically Inappropriate"==s?i.value=[{text:"Not Indicated"}]:i.clear=!0,this.fnoteBtn.click(function(){endpoints.getPatientData("override",i)})}else this.fnoteBtn.hide();trews.data.profile.deactivated||!t||workflowsComponent.sep6Override?this.ctn.addClass("inactive"):this.ctn.removeClass("inactive")}},workflowsComponent=new function(){this.sev3Ctn=$("[data-trews='sev3']"),this.sev6Ctn=$("[data-trews='sev6']"),this.sep6Ctn=$("[data-trews='sep6']"),this.orderBtns=$(".place-order-btn"),this.orderNABtns=$(".orderNA"),this.tasks=[],this.sev36Override=!1,this.sep6Override=!1,this.clean=function(){$("[data-trews='init_lactate'],       [data-trews='blood_culture'],       [data-trews='antibiotics'],       [data-trews='fluid'],       [data-trews='re_lactate'],       [data-trews='vasopressors']").html("")},this.makeButtons=function(){this.orderBtns.unbind(),this.orderBtns.click(function(){var e=$(this).attr("data-trews"),t=$(this).attr("order-key");if(lastAction=e,"epic2017"==release)appendToConsole("EPIC 2017 ORDER: "+e+" KEY: "+t),null!=window.parent?(window.parent.postMessage({token:epicToken,action:"Epic.Clinical.Informatics.Web.PostOrder",args:{OrderKey:t}},"*"),endpoints.getPatientData("place_order",{actionName:e})):appendToConsole("Skipping order (null parent)");else{var s=$(this).get()[0].innerHTML,i=$(this).find("a").first().get()[0];null!=i&&(s+="\nANCHOR:"+i.innerHTML),appendToConsole(s),null!=i&&(i.click(),endpoints.getPatientData("place_order",{actionName:e}))}}),this.orderNABtns.unbind(),this.orderNABtns.click(function(e){e.stopPropagation();var t=$("#order-inappropriate-dropdown"),s=$(this).attr("data-trews");notifications.n.fadeOut(300),activity.a.fadeOut(300),dropdown.d.fadeOut(300),deterioration.sendOff(),$(".order-dropdown").fadeOut(300),t.find("span").attr("data-trews",s);var i="";trews.data&&trews.data[s]&&trews.data[s].status&&trews.data[s].status.startsWith("Clinically Inappropriate:")&&(i=trews.data[s].status.substr("Clinically Inappropriate:".length)),$("#order-inappropriate-dropdown input").val(i);var r=$(this).closest(".card");if(null==r)throw"Failed to place "+s.toUpperCase()+" order.";t.css({top:$(this).offset().top+$(this).height()+7,left:r.offset().left+parseInt(r.css("padding-left"),10)}).fadeIn(30)})},this.workflowStatus=function(e,t,s,i){if(null==t)return workflows[e].not_yet;workflows[e].instruction;if(i){var r=new Date(1e3*s);return"Workflow window completed <span title='"+strToTime(r)+"'>"+timeLapsed(r)+"</span>"}if("sev3"==e)a=108e5;else if(e="sev6")a=216e5;else var a=216e5;var n=1e3*t+a,o=new Date(n);return n<Date.now()?"<span class='workflow-expired'>Workflow window expired <span title='"+strToTime(o)+"'>"+timeLapsed(o)+"</span></span>":"<span title='"+strToTime(o)+"'>"+timeRemaining(o)+"</span>"},this.render=function(e,t,s,i,r,a,n,o,l){this.sev3Ctn.find('h2[data-trews="sev3-header"]').text(workflows.sev3.display_name),this.sev6Ctn.find("h2").text(workflows.sev6.display_name),this.sep6Ctn.find('h2[data-trews="sep6-header"]').text(workflows.sep6.display_name),this.sev36Override=n.ui_severe_sepsis.is_met,this.sep6Override=n.ui_septic_shock.is_met,!trews.data.profile.deactivated&&null!=o||this.sev36Override||this.sep6Override?(this.sev3Ctn.removeClass("inactive"),this.sev6Ctn.removeClass("inactive")):(this.sev3Ctn.addClass("inactive"),this.sev6Ctn.addClass("inactive")),!trews.data.profile.deactivated&&null!=l||this.sep6Override?this.sep6Ctn.removeClass("inactive"):this.sep6Ctn.addClass("inactive");var d=Math.max(i.time,t.time,e.time,s.time),u=i.is_met&&orderStatusCompleted(i)&&t.is_met&&orderStatusCompleted(t)&&e.is_met&&orderStatusCompleted(e)&&s.is_met&&orderStatusCompleted(s),c=Math.max(d,r.time),p=u&&(r.is_met||orderStatusCompleted(r)),h=Math.max(c,a.time),m=p&&a.is_met&&orderStatusCompleted(a);this.sev3Ctn.find(".card-subtitle").html(this.workflowStatus("sev3",o,d,u)),this.sev6Ctn.find(".card-subtitle").html(this.workflowStatus("sev6",o,c,p)),this.sep6Ctn.find(".card-subtitle").html(this.workflowStatus("sep6",l,h,m)),u&&p?($('.slot[data-trews="sus"] .numberCircle').addClass("complete"),$('.slot[data-trews="eval-acute-orgdf"] .numberCircle').addClass("complete"),$('.card[data-trews="sev3"] .numberCircle').addClass("complete")):($('.slot[data-trews="sus"] .numberCircle').removeClass("complete"),$('.slot[data-trews="eval-acute-orgdf"] .numberCircle').removeClass("complete"),$('.card[data-trews="sev3"] .numberCircle').removeClass("complete")),m?($('.card[data-trews="septicShock"] .numberCircle').addClass("complete"),$('.card[data-trews="sep6"] .numberCircle').addClass("complete")):($('.card[data-trews="septicShock"] .numberCircle').removeClass("complete"),$('.card[data-trews="sep6"] .numberCircle').removeClass("complete")),this.tasks=[new taskComponent(i,$("[data-trews='init_lactate']"),workflows.init_lactate,null),new taskComponent(t,$("[data-trews='blood_culture']"),workflows.blood_culture,null),new taskComponent(e,$("[data-trews='antibiotics']"),workflows.antibiotics,null),new taskComponent(s,$("[data-trews='fluid']"),workflows.fluid,null),new taskComponent(r,$("[data-trews='re_lactate']"),workflows.repeat_lactate,null),new taskComponent(a,$("[data-trews='vasopressors']"),workflows.vasopressors,null)],this.makeButtons()};var e=parseInt($('.card[data-trews="sev3"] .slot').css("width"),10);if(e<parseInt($("#order-inappropriate-dropdown").css("max-width"),10)){var t=e-($("#right-column").hasScrollBar().vertical?15:0),s={"max-width":t+"px"};t<300&&(s["font-size"]="10px",$("#order-inappropriate-dropdown input").css({"font-size":"10px"})),$("#order-inappropriate-dropdown").css(s)}$("#order-inappropriate-dropdown input").click(function(e){e.stopPropagation()}),$('#order-inappropriate-dropdown span[data-action="submit"]').click(function(e){e.stopPropagation();var t=$(this).attr("data-trews");null!=t&&($("#loading").addClass("waiting").spin(),endpoints.getPatientData("order_inappropriate",{actionName:t,reason:$("#order-inappropriate-dropdown input").val()})),$("#order-inappropriate-dropdown").fadeOut(300)}),$('#order-inappropriate-dropdown span[data-action="reset"]').click(function(e){e.stopPropagation();var t=$(this).attr("data-trews");trews.data&&trews.data[t]&&trews.data[t].status&&trews.data[t].status.startsWith("Clinically Inappropriate")&&($("#loading").addClass("waiting").spin(),endpoints.getPatientData("override",{actionName:t,clear:!0})),$("#order-inappropriate-dropdown").fadeOut(300)})},criteriaComponent=function(e,t,s,i,r,a,n){this.isOverridden=!1,this.status="",this.name=e.name,this.criteria_mapping=r,this.criteria_source=a,this.criteria_button=null,this.criteria_button_enable=!1;var o="",l="",d=e.value,u=null,c=void 0==t.fixed?null:t.fixed,p=void 0==t.precision?5:t.precision;if(null!=t.baseline_key&&null!=t.baseline_trend&&null!=trews.data.orgdf_baselines[t.baseline_key]&&(u=trews.data.orgdf_baselines[t.baseline_key]),e.name.startsWith("trews_")&&null!=d)try{var h=JSON.parse(d);d=isNumber(h)?h:"value"in h?h.value:"N/A","baseline"in h&&(u=null==h.baseline||h.baseline<0?null:h.baseline)}catch(e){d="N/A",u=null}if(!d||!isNumber(d)&&isNaN(Number(d))||(d=null==c?Number(d).toPrecision(p):Number(d).toFixed(c)),!u||!isNumber(u)&&isNaN(Number(u))||(u=null==c?Number(u).toPrecision(p):Number(u).toFixed(c)),"sirs_temp"!=e.name||null==d||!isNumber(d)&&isNaN(Number(d))||(d=((Number(d)-32)/1.8).toPrecision(3)),"platelet"!=e.name&&"trews_platelet"!=e.name||null==d||!isNumber(d)&&isNaN(Number(d))||(d=(1e3*Number(d)).toLocaleString(),null==u||!isNumber(u)&&isNaN(Number(u))||(u=(1e3*Number(u)).toLocaleString())),!e.is_met||"respiratory_failure"!=e.name&&"trews_vent"!=e.name||(d="Mechanical Support: On"),e.is_met&&"trews_vasopressors"==e.name&&(d="Vasopressors: Initiated"),null!=e.override_user&&(this.isOverridden=!0),e.is_met&&e.measurement_time){var m=timeLapsed(new Date(1e3*e.measurement_time)),_=strToTime(new Date(1e3*e.measurement_time));"trews_vasopressors"==e.name?this.status+="Vasopressors given <span title='"+_+"'>"+m+"</span>":"respiratory_failure"==e.name||"trews_vent"==e.name?this.status+=(this.criteria_source?this.criteria_source+" ":"")+"Criteria met <span title='"+_+"'>"+m+"</span>"+(n?"":" with <span class='value'>"+d+"</span>"):this.status+=(this.criteria_source?this.criteria_source+" ":"")+"Criteria met <span title='"+_+"'>"+m+"</span>"+(n?"":" with a value of <span class='value'>"+d+"</span>"),null!=t.baseline_key&&null!=t.baseline_trend&&null!=trews.data.orgdf_baselines[t.baseline_key]&&(this.status+=", "+t.baseline_trend+" from last recorded baseline of "+u+" "+t.overrideModal[0].units),this.status+=e.override_time?"<br />":""}if(null!=e.override_user&&e.override_time){var v=timeLapsed(new Date(1e3*e.override_time)),f=strToTime(new Date(1e3*e.override_time));this.status+="Customized by "+e.override_user+" <span title='"+f+"'>"+v+"</span>"}e.is_met&&(e.measurement_time||this.isOverridden)?this.classComplete=" met":(this.classComplete=" unmet",null==e.override_user&&(o=i?" hidden":" unhidden"));for(var w="",g="",b=this.isOverridden?trews.getSpecificCriteria(s,t.key):null,y=0;y<t.overrideModal.length;y++){var S=null;if(null!=b&&y<b.override_value.length){if(void 0!=b.override_value[y]){var C=b.override_value[y];S="text"in C?C.text:"min"==C.range||"max"==C.range?C.lower?C.lower:C.upper:[C.lower,C.upper]}}else S=null!=t.overrideModal[y].value?t.overrideModal[y].value:t.overrideModal[y].values;var T=t.overrideModal[y].name,k=t.overrideModal[y].units;if("sirs_temp"==e.name&&(S[0]=Number(S[0]).toPrecision(3),S[1]=Number(S[1]).toPrecision(3)),"No Infection"===S)l=" met-deactivated",w+=T,g=" measurements not due to infection",this.criteria_button_enable=!0;else if(n)w+=T;else if("respiratory_failure"==e.name||"trews_vent"==e.name)e.is_met?w+=T:w+=T+": Mechanical Support: "+(x=0==S?"Off":"On");else if("trews_vasopressors"==e.name)if(e.is_met)w+=T;else{var x=0==S?"Not administered":"Initiated";w+=T+": "+x}else"true"==t.overrideModal[y].range?w+=T+" < "+S[0]+" "+k+" or > "+S[1]+" "+k:w+=T+" "+("min"==t.overrideModal[y].range?"<":">")+" "+S+" "+k;w+=n?" / ":" or "}null!=t.baseline_key&&null!=t.baseline_display_name&&null!=trews.data.orgdf_baselines[t.baseline_key]&&(g=" and at least "+t.baseline_display_name+" from baseline"),w=n?w.slice(0,-3):w.slice(0,-4),w+=g;var $=this.criteria_button_enable?"<p>Re-enable</p>":'<i class="fa fa-close"></i>',O=this.criteria_button_enable?"This organ dysfunction has been marked as not caused by infection. Click to re-enable (it will reset in 72 hours).":"Click to indicate that this organ dysfunction is not caused by infection, and disable. It will reset in 72 hours.",D=null!=this.criteria_mapping&&null!=this.criteria_mapping.src?'data-criteria-src="'+this.criteria_mapping.src+'" ':"",N=null!=this.criteria_mapping&&null!=this.criteria_mapping.dst?'data-criteria-dst="'+this.criteria_mapping.dst+'" ':"";this.criteria_button=null==this.criteria_mapping||!e.is_met&&!this.criteria_button_enable?null:'<div style="float: right;"><span class="criteria-btn" data-toggle="tooltip" title="'+O+'" data-as-enable="'+this.criteria_button_enable.toString()+'"'+D+N+">"+$+"</span></div>",this.html="<div class='status"+this.classComplete+o+l+"' data-trews='criteria_"+this.name+"'>          "+(null==this.criteria_button?"":this.criteria_button)+"          <h4>"+w+"</h4>          <h5>"+this.status+"</h5>        </div>",this.r=function(){return this.html}},taskComponent=function(e,t,s,i){var r=t.find(".order-details-header");if(r.length){var a=r.find(".inspect"),n="hidden",o="(see all)";a.length&&(n=a.hasClass("unhidden")?"unhidden":"hidden",o=a.hasClass("unhidden")?"(minimize)":"(see all)"),r.html(s.display_name+'<a class="inspect '+n+'">'+o+"</a>")}else t.find("h3").html(s.display_name);t.removeClass("in-action in-progress discontinued expired complete not-needed");var l=null;try{"status"in(l=JSON.parse(e.status))||(l=e)}catch(t){l=e}if(null!=l){var d=e.is_met&&orderStatusCompleted(l);"Ordering"==l.status?t.addClass("in-action"):"Ordered"==l.status?t.addClass("in-progress"):d&&t.addClass("complete"),"repeat_lactate_order"==e.name&&e.is_met&&!t.is(".in-action,.in-progress,.complete")&&t.addClass("not-needed");var u="vasopressors_order"==e.name&&e.is_met,c=null!=trews.data.septic_shock.hypotension.is_met&&!trews.data.septic_shock.hypotension.is_met;u&&c&&!t.is(".in-action,.in-progress,.complete")&&t.addClass("not-needed");var p="",h="Clinically Inappropriate";null!=l.status&&l.status.startsWith(h)&&(p=h,l.status.length>h.length+1&&(p+=": "+l.status.substr(h.length+1)))}if("Antibiotics"==s.display_name){var m=t.find(".inspect");m.unbind(),m.click(function(e){e.stopPropagation(),$(this).hasClass("hidden")?($(this).text("(minimize)").removeClass("hidden").addClass("unhidden"),""!=p?controller.refreshOrderDetails("antibiotics-details"):endpoints.getPatientData("get_antibiotics")):($(".order-details-content[data-trews='antibiotics-details']").find(".status.unhidden").removeClass("unhidden").addClass("hidden"),$(this).text("(see all)").removeClass("unhidden").addClass("hidden"))})}else t.find(".status h4").text(p)},orderDetailsComponent=function(e){if(this.html="",0===e.length)this.html+="<h4>No interventions found.</h4>";else for(var t in e)this.html+="<h4>"+e[t]+"</h4>";this.r=function(){return this.html}},deterioration=new function(){this.d=$("#other-deter-dropdown"),this.ctn=$(".other-deter-dropdown-list"),this.launcher=$("#other-deter-launcher"),this.remoteInitialized=!1,this.dirty=!1,this.init=function(){for(var e in DETERIORATIONS)this.ctn.prepend("<li data-trews='"+DETERIORATIONS[e]+"'><img src='img/check.png'>"+DETERIORATIONS[e]+"</li>");$(".other-deter-dropdown-list li").click(function(){$(this).toggleClass("selected"),deterioration.dirty=!0}),$(".other-deter-dropdown-list input").keyup(function(){deterioration.dirty=!0,$(this).val().length>0?$(".other-deter-dropdown-list > div").addClass("selected"):$(".other-deter-dropdown-list > div").removeClass("selected")}),deterioration.launcher.click(function(e){e.stopPropagation(),deterioration.d.toggle()}),deterioration.d.click(function(e){e.stopPropagation()})},this.render=function(e){if(!this.remoteInitialized){if(this.remoteInitialized=!0,null==e)return;if($(".other-deter-dropdown-list li.selected").each(function(e){$(this).removeClass("selected")}),e.deterioration){if(e.deterioration.value)for(var t in e.deterioration.value)$("[data-trews='"+e.deterioration.value[t]+"']").addClass("selected");e.deterioration.other?($(".other-deter-dropdown-list input").val(e.deterioration.other),$(".other-deter-dropdown-list > div").addClass("selected")):($(".other-deter-dropdown-list input").val(""),$(".other-deter-dropdown-list > div").removeClass("selected"))}}},this.sendOff=function(){if(this.dirty&&"pending"!=this.dirty){var e=[];$(".other-deter-dropdown-list li.selected").each(function(t){e.push($(this).text())});var t={value:e,other:$(".other-deter-dropdown-list input").val()};this.remoteInitialized=!0,endpoints.getPatientData("set_deterioration_feedback",t),deterioration.d.fadeOut(300),this.dirty="pending"}}},dropdown=new function(){this.d=$("#dropdown"),this.ctn=$("<div id='dropdown-content'></div>"),this.susCtn=$("<div id='dropdown-sus-content'></div>"),this.init=function(){this.initSus(),this.d.append(this.ctn)},this.reset=function(){$(".edit-btn").removeClass("shown"),null==this.susCtn&&($("#infection-other").html(""),this.susCtn=$("#dropdown-sus-content").detach()),this.ctn.html("")},this.getCtnElem=function(e){return $("[data-trews='"+e+"']")},this.getAction=function(e){return{actionName:this.d.attr("data-trews"),value:e}},this.getLaunchAction=function(e){var t=this.d.attr("data-trews");return"org"==t&&(t="organ_dysfunction"),{card:CONSTANTS[this.d.attr("data-trews")],slot:t,criteria:e}},this.initSus=function(){for(var e in INFECTIONS){var t=$('<h5 class="dropdown-link"></h5>').text(INFECTIONS[e]);this.susCtn.append(t)}this.susCtn.append("<div id='infection-other'></div>"),this.susCtn.find("#infection-other").unbind(),this.susCtn.find("#infection-other").click(function(e){e.stopPropagation()}),this.susCtn.find(".dropdown-link").click(function(){$("#loading").addClass("waiting").spin();var e=dropdown.getAction($(this).text());endpoints.getPatientData("suspicion_of_infection",e)})},this.sus=function(){var e=$("#infection-other"),t="";trews.data&&trews.data.severe_sepsis&&(t=trews.data.severe_sepsis.suspicion_of_infection.other?trews.data.severe_sepsis.suspicion_of_infection.value:""),e.append("<input placeholder='Other' value='"+t+"'/><span>Submit</span>"),$("#infection-other span").unbind(),$("#infection-other span").click(function(){$("#loading").addClass("waiting").spin();var e={actionName:"sus-edit",other:$("#infection-other input").val()};endpoints.getPatientData("suspicion_of_infection",e),dropdown.d.fadeOut(300)})},this.editFields=function(e){var t=trews.getCriteria(e),s=[];for(var i in t){s.push(i);var r=$('<h5 class="dropdown-link" data-trews="'+i+'"></h5>'),a=t[i].override_user?EDIT[e][i]+" is customized":"customize "+EDIT[e][i],n=t[i].override_user?"overridden":"";r.text(a),r.addClass(n),this.ctn.append(r)}$(".dropdown-link").click(function(e){var t=dropdown.getLaunchAction($(this).attr("data-trews"));overrideModal.launch(t)})},this.fill=function(e){this.d.attr("data-trews",e),"sus-edit"===e?null!=this.susCtn&&(this.susCtn.appendTo(this.d),this.susCtn=null,this.sus()):this.editFields(e)},this.draw=function(e,t,s){e.css({top:s+7,left:t-e.width()/2}).fadeIn(30)},$("body").click(function(){$(".edit-btn").removeClass("shown"),$(".place-order-dropdown-btn").removeClass("shown"),notifications.n.fadeOut(300),activity.a.fadeOut(300),dropdown.d.fadeOut(300),deterioration.sendOff(),$(".order-dropdown").fadeOut(300),$("#order-inappropriate-dropdown").fadeOut(300)}),$(".edit-btn").click(function(e){e.stopPropagation(),notifications.n.fadeOut(300),activity.a.fadeOut(300),deterioration.sendOff(),$(".order-dropdown").fadeOut(300),$("#order-inappropriate-dropdown").fadeOut(300),dropdown.reset(),$(this).addClass("shown"),dropdown.fill($(this).attr("data-trews")),dropdown.draw(dropdown.d,$(this).offset().left+$(this).width()/2,$(this).offset().top+$(this).height())}),$(".place-order-dropdown-btn").click(function(e){e.stopPropagation(),notifications.n.fadeOut(300),activity.a.fadeOut(300),dropdown.d.fadeOut(300),deterioration.sendOff(),$(".order-dropdown").fadeOut(300),$("#order-inappropriate-dropdown").fadeOut(300),$(this).addClass("shown");var t=$(".order-dropdown[data-trews="+$(this).attr("data-trews")+"]"),s=$(".card[data-trews="+$(this).attr("parent-card")+"]");if(null==t||null==s)throw"Failed to place "+$(this).attr("data-trews").toUpperCase()+" order.";dropdown.draw(t,s.offset().left+s.width()+2-t.width()/2,$(this).offset().top+$(this).height())})},overrideModal=new function(){this.om=$("#override-modal"),this.ctn=$('<div id="om-content"></div>'),this.card="",this.slot="",this.criteria="",this.reset=!1,this.init=function(){this.om.append(this.ctn)},this.modalView=function(e,t){var s="<h3>"+e.header+"</h3>";return s+="<p>Define a new acceptable range.  The criteria will be met once the patient's "+e.name+" falls out of the new range.</p>",s+="<div><a class='override-reset' data-trews='"+t+"'>reset</a><span class='slider-numbers' data-trews='"+e.id+"'></span></div>",s+="<div class='slider-range' data-trews='"+e.id+"'></div>"},this.makeSliders=function(e,t){var s=trews.getCriteria(this.slot)[this.criteria].override_value;if("true"===e.range)$(".slider-range[data-trews='"+e.id+"']").slider({range:e.range,min:e.minAbsolute,max:e.maxAbsolute,step:e.step,values:[null==s?e.values[0]:s[t].lower?s[t].lower:e.values[0],null==s?e.values[1]:s[t].upper?s[t].upper:e.values[1]],slide:function(t,s){$(".slider-numbers[data-trews='"+e.id+"']").text(s.values[0]+" - "+s.values[1])}}),$(".slider-numbers[data-trews='"+e.id+"']").text($(".slider-range[data-trews='"+e.id+"']").slider("values",0)+" - "+$(".slider-range[data-trews='"+e.id+"']").slider("values",1));else{var i=e.value;"min"===e.range?(slideFunction=function(t,s){$(".slider-numbers[data-trews='"+e.id+"']").text(s.value+" - "+e.maxAbsolute)},i=null==s?i:s[t].lower?s[t].lower:i):(slideFunction=function(t,s){$(".slider-numbers[data-trews='"+e.id+"']").text(e.minAbsolute+" - "+s.value)},i=null==s?i:s[t].upper?s[t].upper:i),$(".slider-range[data-trews='"+e.id+"']").slider({range:e.range,min:e.minAbsolute,max:e.maxAbsolute,step:e.step,value:i,slide:slideFunction}),"min"===e.range?$(".slider-numbers[data-trews='"+e.id+"']").text($(".slider-range[data-trews='"+e.id+"']").slider("value")+" - "+e.maxAbsolute):$(".slider-numbers[data-trews='"+e.id+"']").text(e.minAbsolute+" - "+$(".slider-range[data-trews='"+e.id+"']").slider("value"))}},this.makeActions=function(){var e=$(".override-save"),t=$(".override-cancel"),s=$(".override-reset");e.unbind(),e.click(function(){for(var e=$(".slider-range"),t={actionName:STATIC[overrideModal.card][overrideModal.slot].criteria[overrideModal.criteria].key,value:[],clear:!1},s=0;s<e.length;s++){var i=e[s].getAttribute("data-trews"),r=STATIC[overrideModal.card][overrideModal.slot].criteria[overrideModal.criteria].overrideModal[s],a={range:r.range};0==$(".slider-range[data-trews='"+i+"']").slider("values").length?(a.lower="min"==r.range?$(".slider-range[data-trews='"+i+"']").slider("value"):null,a.upper="max"==r.range?$(".slider-range[data-trews='"+i+"']").slider("value"):null):(a.lower=$(".slider-range[data-trews='"+i+"']").slider("values",0),a.upper=$(".slider-range[data-trews='"+i+"']").slider("values",1)),t.clear=!!overrideModal.reset,t.value.push(a)}endpoints.getPatientData("override",t),overrideModal.om.fadeOut(30)}),t.unbind(),t.click(function(){overrideModal.om.fadeOut(30)}),s.unbind(),s.click(function(){overrideModal.reset=!0;var e=STATIC[overrideModal.card][overrideModal.slot].criteria[overrideModal.criteria].overrideModal[$(this).attr("data-trews")];"true"==e.range?($(".slider-range[data-trews='"+e.id+"']").slider("values",e.values),$(".slider-numbers[data-trews='"+e.id+"']").text(e.values[0]+" - "+e.values[1])):($(".slider-range[data-trews='"+e.id+"']").slider("value",e.value),"min"==e.range?$(".slider-numbers[data-trews='"+e.id+"']").text(e.value+" - "+e.maxAbsolute):$(".slider-numbers[data-trews='"+e.id+"']").text(e.minAbsolute+" - "+e.value))})},this.launch=function(e){this.card=e.card,this.slot=e.slot,this.criteria=e.criteria,this.reset=!1,this.ctn.html(""),Modernizr.opacity||this.om.addClass("no-opacity");for(var t=STATIC[e.card][e.slot].criteria[e.criteria].overrideModal,s=0;s<t.length;s++)this.ctn.append(this.modalView(t[s],s)),this.makeSliders(t[s],s);this.ctn.append("<div id='om-actions'><a class='override-cancel'>Cancel</a><a class='override-save'>Save</a>"),this.makeActions(),this.om.fadeIn(30)},this.om.unbind(),this.om.click(function(){overrideModal.om.fadeOut(30)}),this.ctn.unbind(),this.ctn.click(function(e){e.stopPropagation()})},notifications=new function(){this.n=$("#notifications"),this.nav=$("#header-notifications"),this.suppressions=null,this.suppressionExpanded=!1,this.init=function(){this.nav.unbind(),this.nav.click(function(e){e.stopPropagation(),activity.a.fadeOut(300),dropdown.d.fadeOut(300),deterioration.sendOff(),$(".order-dropdown").fadeOut(300),$("#order-inappropriate-dropdown").fadeOut(300),notifications.n.toggle()}),this.n.unbind(),this.n.click(function(e){e.stopPropagation()})},this.getAlertMsg=function(e){var t=ALERT_CODES[e.alert_code],s=!1;if("301"==e.alert_code||"304"==e.alert_code||"501"==e.alert_code||"504"==e.alert_code||"701"==e.alert_code||"704"==e.alert_code){if(!((i=trews.getIncompleteSevereSepsis3hr())>0))return null;t=String(i)+" "+t}else if("302"==e.alert_code||"305"==e.alert_code||"502"==e.alert_code||"505"==e.alert_code||"702"==e.alert_code||"705"==e.alert_code){if(!((i=trews.getIncompleteSevereSepsis6hr())>0))return null;t=String(i)+" "+t}else if("303"==e.alert_code||"306"==e.alert_code||"503"==e.alert_code||"506"==e.alert_code||"703"==e.alert_code||"706"==e.alert_code){var i=trews.getIncompleteSepticShock();if(!(i>0))return null;t=String(i)+" "+t}return"206"!=e.alert_code&&"307"!=e.alert_code&&"406"!=e.alert_code&&"507"!=e.alert_code||(s=!0),{msg:t,suppressed:s}},this.render=function(e){if(this.n.html(""),void 0==e)return this.n.append('<p class="none">Can\'t retrieve notifications at this time.  <br />Notifications may be under construction.</p>'),this.nav.find("b").hide(),void this.nav.find(".text").text("Notifications");if(0==e.length)return this.n.append('<p class="none">No Notifications</p>'),this.nav.find("b").hide(),void this.nav.find(".text").text("Notifications");for(var t=0,s=0,i=Date.now(),r=$('<div class="suppressions"></div>'),a=0;a<e.length;a++)if(!(new Date(1e3*e[a].timestamp)>i)){var n=this.getAlertMsg(e[a]);if(null!=n){var o=n.msg,l=n.suppressed;if(void 0!=o){var d=$('<div class="notification"></div>');d.append("<h3>"+o+"</h3>");var u=$('<div class="subtext cf"></div>');u.append("<p>"+timeLapsed(new Date(1e3*e[a].timestamp))+"</p>"),l?(s++,d.addClass("suppressed"),d.append(u),r.prepend(d)):(t++,d.append(u),this.n.prepend(d))}}}if(s>0){$(".suppressions").remove(),this.suppressions=r;var c=$('<div class="suppression-summary"></div>'),p=1==s?"suppressed message":"suppressed messages",h=this.suppressionExpanded?"(minimize)":"(see all)",m='<span class="expander '+(this.suppressionExpanded?"unhidden":"hidden")+'">'+h+"</span>";c.append("<h3>"+s+" "+p+" "+m+"</h3>");var _=c.find(".expander");_.unbind(),_.click(function(e){e.stopPropagation(),$(this).hasClass("hidden")?($(this).text("(minimize)").removeClass("hidden").addClass("unhidden"),$("#notifications").append(notifications.suppressions),notifications.suppressionExpanded=!0):(notifications.suppressionExpanded=!1,$("#notifications .suppressions").remove(),$(this).text("(see all)").removeClass("unhidden").addClass("hidden"))}),this.n.append(c),this.suppressionExpanded&&this.n.append(this.suppressions)}var v=$("[data-trews='sus']");if(v.hasClass("complete")&&v.hasClass("complete-with-status"))v.removeClass("highlight-expired highlight-unexpired");else{var f=severeSepsisComponent.highlightSuspicionClass();null!=f?(v.addClass(f),v.find(".status").show(),v.find(".status h4").text("")):v.removeClass("highlight-expired highlight-unexpired")}trews.data.profile.deactivated?this.nav.find("b").hide():0==t?this.nav.find("b").hide():(this.nav.find("b").show(),this.nav.find(".num").text(t)),e.length>1?this.nav.find(".text").text("Notifications"):this.nav.find(".text").text("Notification")}},activity=new function(){this.a=$("#activity"),this.nav=$("#header-activity"),this.init=function(){this.nav.unbind(),this.nav.click(function(e){e.stopPropagation(),notifications.n.fadeOut(300),dropdown.d.fadeOut(300),deterioration.sendOff(),$(".order-dropdown").fadeOut(300),$("#order-inappropriate-dropdown").fadeOut(300),activity.a.toggle()}),this.a.unbind(),this.a.click(function(e){e.stopPropagation()})},this.getLogMsg=function(e){var t=["antibiotics_order","blood_culture_order","crystalloid_fluid_order","initial_lactate_order","repeat_lactate_order","vasopressors_order"],s=["suspicion_of_infection"],i=["blood_pressure","mean_arterial_pressure","decrease_in_sbp","respiratory_failure","creatinine","bilirubin","platelet","inr","lactate"],r=["trews_sbpm","trews_map","trews_dsbp","trews_vent","trews_creatinine","trews_bilirubin","trews_platelet","trews_inr","trews_lactate","trews_gcs","trews_vasopressors"],a="",n=null==e.uid?"TREWS":"dba"==e.uid?"TREWS automatically":e.uid;"user"==n&&(n="Test user");var o=jQuery.inArray(e.name,t)>=0,l=jQuery.inArray(e.name,s)>=0,d=jQuery.inArray(e.name,i)>=0,u=jQuery.inArray(e.name,r)>=0;if(d)return null;if("set_deterioration_feedback"==e.event_type){if(""==e.value.other&&0==e.value.value.length)return n+" has cleared <b>other conditions driving deterioration</b>";if(a+=n+LOG_STRINGS[e.event_type],e.value.value.length>0){for(h=0;h<e.value.value.length;h++)a+=e.value.value[h]+", ";if(""==e.value.other)return a.substring(0,a.length-2)}""!=e.value.other&&(a+=e.value.other)}else if("override"==e.event_type)if(e.clear)if("ui_severe_sepsis"==e.name||"ui_septic_shock"==e.name)a+=n+" reset the <b>manual override</b> for the <b>"+criteriaKeyToName[e.name][0].name+"</b>";else if(criteriaKeyToName[e.name].length>0&&u){c=null;a+=n+" re-enabled the entry for acute organ dysfunction based on "+(c="respiratory_failure"==e.name||"trews_vent"==e.name?"<b>Respiratory Failure (Mechanical Ventilation)</b>":"trews_vasopressors"==e.name?"<b>Vasopressors</b>":"<b>"+criteriaKeyToName[e.name][0].name+"</b> measurements")}else{a+=n+(p="suspicion_of_infection"==e.name?" cleared ":LOG_STRINGS[e.event_type].clear);for(h=0;h<criteriaKeyToName[e.name].length;h++){m=criteriaKeyToName[e.name].length>1?", ":"";criteriaKeyToName[e.name].length>1&&h==criteriaKeyToName[e.name].length-1&&(2==criteriaKeyToName[e.name].length&&(a=a.substring(0,a.length-2)+" "),a+="and ",m=""),a+="<b>"+criteriaKeyToName[e.name][h].name+"</b>"+m}}else if("ui_severe_sepsis"==e.name||"ui_septic_shock"==e.name)a+=n+" <b>manually overrode</b> the <b>"+criteriaKeyToName[e.name][0].name+"</b>";else if(e.override_value.length>0&&criteriaKeyToName[e.name].length>0&&"No Infection"==e.override_value[0].text&&u){var c=null;a+=n+" entered "+(c="respiratory_failure"==e.name||"trews_vent"==e.name?"<b>Respiratory Failure (Mechanical Ventilation)</b> does":"trews_vasopressors"==e.name?"<b>Vasopressors</b>":"<b>"+criteriaKeyToName[e.name][0].name+"</b> measurements do")+" not indicate organ dysfunction due to infection"}else{var p=o?LOG_STRINGS[e.event_type].ordered[0]:LOG_STRINGS[e.event_type].customized[0];a+=n+p;for(var h=0;h<criteriaKeyToName[e.name].length;h++){if(h>=e.override_value.length){criteriaKeyToName[e.name].length>1&&(a=a.substring(0,a.length-2)+" ");break}var m=criteriaKeyToName[e.name].length>1?", ":"";criteriaKeyToName[e.name].length>1&&h==criteriaKeyToName[e.name].length-1&&(2==criteriaKeyToName[e.name].length&&(a=a.substring(0,a.length-2)+" "),a+="and ",m=""),a+="<b>"+criteriaKeyToName[e.name][h].name+"</b>",null!=e.override_value&&e.override_value.length>h&&(o?a+=LOG_STRINGS[e.event_type].ordered[1]+e.override_value[h].text:l||null!=e.override_value[h].text?a+=LOG_STRINGS[e.event_type].customized[1]+"<b>"+e.override_value[h].text+"</b>":null!=e.override_value[h].range&&(a+=LOG_STRINGS[e.event_type].customized[1]+UpperLowerToLogicalOperators(e.override_value[h],criteriaKeyToName[e.name][h].units)),a+=m)}}else"deactivate"==e.event_type||"auto_deactivate"==e.event_type?(c=e.deactivated?"deactivate":"activate",a+=n+LOG_STRINGS[c]):a+=n+LOG_STRINGS[e.event_type];return a},this.render=function(e){if(this.a.html(""),void 0!=e)if(0!=e.length){for(var t=e.concat().sort(function(e,t){return e.timestamp==t.timestamp?0:e.timestamp<t.timestamp?-1:1}),s=null,i=0;i<t.length;i++)"reset_soi_pats"==t[i].event_type&&(s=i);for(i=0;i<t.length;i++){new Date(1e3*t[i].timestamp);if("reset_soi_pats"!=t[i].event_type||i==s){var r=this.getLogMsg(t[i]);if(void 0!=r){var a=$('<div class="log-item"></div>');a.append("<h3>"+r+"</h3>");var n=$('<div class="subtext cf"></div>');n.append("<p>"+timeLapsed(new Date(1e3*t[i].timestamp))+"</p>"),a.append(n),this.a.prepend(a)}}}}else this.a.append('<p class="none">No Activity</p>');else this.a.append('<p class="none">Can\'t retrieve activity log at this time.  <br />Activity Log may be under construction.</p>')}},toolbar=new function(){this.resetNav=$("#header-reset-patient"),this.activateNav=$("#header-activate-button"),this.feedback=$("#feedback"),this.feedbackSuccessHideDelay=3500,this.statusBar=$("#status-header"),this.disclaimerBar=$("#disclaimer-header"),this.disclaimerTimeout=null,this.init=function(){this.resetNav.unbind(),this.resetNav.click(function(e){$("#loading").addClass("waiting").spin(),toolbar.resetNav.addClass("loading");var t=void 0==trews.data.event_id?null:{value:trews.data.event_id};endpoints.getPatientData("reset_patient",t,toolbar.resetNav)}),this.deactivateState=!0,this.activateNav.unbind(),this.activateNav.click(function(e){$("#loading").addClass("waiting").spin(),toolbar.activateNav.addClass("loading"),endpoints.getPatientData("deactivate",{value:!trews.data.profile.deactivated},toolbar.activateNav)}),$("#header-feedback").click(function(){toolbar.feedback.find("p").html(""),toolbar.feedback.show()}),$("#feedback").click(function(){toolbar.feedback.fadeOut(500)}),$("#feedback-cancel").click(function(){toolbar.feedback.find("b").remove(),toolbar.feedback.find("textarea").val(""),toolbar.feedback.fadeOut(500)}),$("#feedback .modal-content").click(function(e){e.stopPropagation()}),$("#feedback-submit").click(function(){postBody={q:!1===getQueryVariable("PATID")?null:getQueryVariable("PATID"),u:!1===getQueryVariable("USERID")?null:cleanUserId(getQueryVariable("USERID")),depid:!1===getQueryVariable("DEP")?null:getQueryVariable("DEP"),feedback:toolbar.feedback.find("textarea").val()},controller.sendFeedback(postBody)});!1===getQueryVariable("DEP")||getQueryVariable("DEP")},this.feedbackSuccess=function(){this.feedback.find("p").html('<b class="success">Feedback Submitted!</b>'),toolbar.feedback.find("textarea").val(""),window.setTimeout(function(){toolbar.feedback.fadeOut(500)},toolbar.feedbackSuccessHideDelay)},this.feedbackError=function(){this.feedback.find("p").html('<b class="error">There was an error, please try again or email trews-helpdesk@opsdx.io</b>')},this.render=function(e){this.resetNav.show(),trews.data.profile.deactivated?this.activateNav.find("span").text("Activate Patient"):this.activateNav.find("span").text("Deactivate Patient"),this.activateNav.show();var t=longPatientSummary(!1,2,!0,!0,!1);if(t.care_status?(this.statusBar.html("<h5>"+t.care_status+"</h5>"),this.statusBar.show()):(this.statusBar.html(""),this.statusBar.hide()),this.statusBar.removeClass("high-priority low-priority no-priority"),null!=t.care_status_priority&&this.statusBar.addClass(t.care_status_priority),null!=this.disclaimerTimeout){this.disclaimerBar.html("<h5><b><u>Do NOT rely on TREWS for inpatient alerts.</u></b> The current version scores and alerts for patients only in the Emergency Department. The next version will target inpatients as well.</h5>"),this.disclaimerBar.show()}}},timeline=new function(){this.chart=null,this.chartOptions=null,this.chartMin=null,this.chartMax=null,this.chartInitialized=!1,this.chartHasSepsisMarker=!1,this.groups={},this.groupDataSet=new vis.DataSet,this.clsSegments={},this.ctn=$("#timeline-wrapper"),this.chartHdr=$("#timeline-header"),this.chartCtn=$("#timeline-div"),this.zoomCtn=$("#timeline-zoom-div"),this.expandBtn=$("#expand-timeline"),this.timelineVisible=!1,this.startOfHour=function(e){return dStart=new Date(e),dStart.setUTCMinutes(0),dStart.setUTCSeconds(0),dStart.setUTCMilliseconds(0),dStart.getTime()},this.startOfDay=function(e){return dStart=new Date(e),dStart.setUTCHours(0),dStart.setUTCMinutes(0),dStart.setUTCSeconds(0),dStart.setUTCMilliseconds(0),dStart.getTime()},this.zoomToFit=function(){var e=timeline.chart.getCurrentTime(),t=timeline.chart.getItemRange(),s=null==t.min?e.getTime()-216e5:t.min.getTime(),i=e.getTime();timeline.chart.setWindow(new Date(s-72e5),new Date(i+72e5))},this.init=function(){var e=this.startOfDay(new Date),t=30,s=[],i=[],r=[],a=[],n=[];for(var o in severe_sepsis.trews_organ_dysfunction.criteria){d={id:t,content:(u=severe_sepsis.trews_organ_dysfunction.criteria[o]).overrideModal[0].name};this.groups[u.key]=d,r.push(t),t++}this.groups.trews_vasopressors={id:t,content:"Vasopressors"},r.push(t),t++;for(var o in severe_sepsis.sirs.criteria){d={id:t,content:(u=severe_sepsis.sirs.criteria[o]).overrideModal[0].name};this.groups[u.key]=d,s.push(t),t++}for(var o in severe_sepsis.organ_dysfunction.criteria){d={id:t,content:(u=severe_sepsis.organ_dysfunction.criteria[o]).overrideModal[0].name};this.groups[u.key]=d,i.push(t),t++}for(var o in septic_shock.tension.criteria){var l="hypotension_sbp"==(u=septic_shock.tension.criteria[o]).key?"systolic_bp":u.key,d={id:t,content:u.overrideModal[0].name};this.groups[l]=d,a.push(t),t++}for(var o in septic_shock.fusion.criteria){var u=septic_shock.fusion.criteria[o],l="initial_lactate"==u.key?"hpf_initial_lactate":u.key,d={id:t,content:u.overrideModal[0].name};this.groups[l]=d,n.push(t),t++}t=1;var c=t++,p=t++,h=t++,m=t++;this.groups.suspicion_of_infection={id:t++,className:"vis_g_soi",content:"Suspected Source Of Infection"},this.groups.trews_sevsep_soi={id:t++,content:"Suspected Source Of Infection"},this.groups.trews_sevsep_score={id:t++,content:"TREWS Acuity Score"},this.groups.trews_sevsep_org={id:t++,content:"TREWS Organ Dysfunction"},this.groups.trews_sepshk_hypotension={id:t++,content:"TREWS Hypotension"},this.groups.trews_sepshk_hypoperfusion={id:t++,content:"TREWS Hypoperfusion"},this.groups.cms_soi={id:t++,content:"Suspected Source Of Infection"},this.groups.cms_sirs={id:t++,content:"CMS SIRS"},this.groups.cms_org={id:t++,content:"CMS Organ Dysfunction"},this.groups.cms_hypotension={id:t++,content:"CMS Hypotension"},this.groups.cms_hypoperfusion={id:t++,content:"CMS Hypoperfusion"},this.groups.trewscore={id:t++,className:"vis_g_trewscore",content:"TREWS Acuity Score"},this.groups.trews_org={id:t++,content:"TREWS Organ Dysfunction",nestedGroups:r},this.groups.sirs={id:t++,content:"SIRS",nestedGroups:s},this.groups.org={id:t++,content:"CMS Organ Dysfunction",nestedGroups:i},this.groups.tension={id:t++,content:"Hypotension",nestedGroups:a},this.groups.fusion={id:t++,content:"Hypoperfusion",nestedGroups:n},this.groups.blood_culture={id:100,className:"vis_g_blood_culture",content:"Blood Culture"},this.groups.initial_lactate={id:101,className:"vis_g_initial_lactate",content:"Initial Lactate"},this.groups.crystalloid_fluid={id:102,className:"vis_g_crystalloid_fluid",content:"Fluid"},this.groups.antibiotics={id:103,className:"vis_g_antibiotics",content:"Antibiotics"},this.groups.repeat_lactate={id:104,className:"vis_g_repeat_lactate",content:"Repeat Lactate"},this.groups.vasopressors={id:105,className:"vis_g_vasopressors",content:"Vasopressors"};var _=[100,101,102,103,104,105];this.groups.orders={id:t++,content:"Orders",nestedGroups:_},this.groups.trews_severe_sepsis={id:c,content:"TREWS Severe Sepsis",nestedGroups:[this.groups.trews_sevsep_soi.id,this.groups.trews_sevsep_score.id,this.groups.trews_sevsep_org.id]},this.groups.trews_septic_shock={id:p,content:"TREWS Septic Shock",nestedGroups:[this.groups.trews_sepshk_hypotension.id,this.groups.trews_sepshk_hypoperfusion.id]},this.groups.cms_severe_sepsis={id:h,className:"vis_g_cms_severe_sepsis",content:"CMS Severe Sepsis",nestedGroups:[this.groups.cms_soi.id,this.groups.cms_sirs.id,this.groups.cms_org.id]},this.groups.cms_septic_shock={id:m,content:"CMS Septic Shock",nestedGroups:[this.groups.cms_hypotension.id,this.groups.cms_hypoperfusion.id]},this.chartMin=e-6048e5,this.chartMax=e+1296e5,this.chartOptions={align:"left",min:this.chartMin,max:this.chartMax,rollingMode:{follow:!1,offset:.75},selectable:!1,stack:!1,zoomable:!1,groupOrder:function(e,t){return e.id-t.id}},this.chart=new vis.Timeline(this.chartCtn[0],[],this.chartOptions),$(".timeline-zoom-btn").click(function(e){e.stopPropagation();if("fit"==$(this).attr("data-zoom-hours").toLowerCase())timeline.zoomToFit();else{var t=timeline.chart.getCurrentTime(),s=timeline.startOfHour(t),i=parseInt($(this).attr("data-zoom-hours"),10);timeline.chart.setWindow(new Date(s-36e5*i),new Date(s+18e6))}})},this.allOverlaps=function(e,t,s,i){for(var r=[],a=0;a<t[e].length;a++)if(s&&1==t[e].length)r.push(t[e][0]);else for(var n=a+1;n<t[e].length;n++)!(t[e][a].end<t[e][n].start||t[e][n].end<t[e][a].start)&&r.push(i(t[e][a],t[e][n]));return r},this.unionOverlap=function(e,t){return{start:new Date(Math.min(e.start,t.start)),end:new Date(Math.max(e.end,t.end))}},this.intersectOverlap=function(e,t){return{start:new Date(Math.max(e.start,t.start)),end:new Date(Math.min(e.end,t.end))}},this.pairwiseOverlapUnion=function(e,t,s,i){for(var r=[],a=this.allOverlaps(e,t,s,i);a.length>0;){for(var n=a.pop(),o=[],l=0;l<a.length;l++)!(n.end<a[l].start||a[l].end<n.start)&&(n={start:new Date(Math.min(n.start,a[l].start)),end:new Date(Math.max(n.end,a[l].end))},o.unshift(l));if(o.length>0){for(l=0;l<o.length;l++)a.splice(o[l],1);a.push(n)}else r.push(n)}return r},this.render=function(e){var t=this.chart.getCurrentTime(),s=e.severe_sepsis.is_trews,i=e.severe_sepsis.is_cms,r=null!=e.severe_sepsis.onset_time?new Date(1e3*e.severe_sepsis.onset_time):null,a=null!=e.septic_shock.onset_time?new Date(1e3*e.septic_shock.onset_time):null,n=null==r?null:new Date(r.getTime()+108e5),o=null==r?null:new Date(r.getTime()+216e5),l=null==a?null:new Date(a.getTime()+216e5),d=null==r?null:new Date(r.getTime()+2808e5),u=null==a?null:new Date(a.getTime()+2808e5),c={status:!0,t:null},p={status:!0,t:null},h=(this.groupDataSet.get(),this.groupDataSet.get({filter:function(e){return e.visible}})),m=$.map(h,function(e){return e.id}),_=$.map(h,function(e){return e.nestedInGroup});this.groupDataSet=new vis.DataSet,this.groupDataSet.add(this.groups.trewscore),this.groupDataSet.add(this.groups.suspicion_of_infection),this.groupDataSet.add($.extend({},this.groups.trews_sevsep_soi,{visible:m.indexOf(this.groups.trews_sevsep_soi.id)>=0})),this.groupDataSet.add($.extend({},this.groups.trews_sevsep_score,{visible:m.indexOf(this.groups.trews_sevsep_score.id)>=0})),this.groupDataSet.add($.extend({},this.groups.trews_sevsep_org,{visible:m.indexOf(this.groups.trews_sevsep_org.id)>=0}));var v={showNested:_.indexOf(this.groups.trews_severe_sepsis.id)>=0};null!=r&&s&&(v.className="vis_g_severe_sepsis_active"),this.groupDataSet.add($.extend({},this.groups.trews_severe_sepsis,v)),this.groupDataSet.add($.extend({},this.groups.trews_sepshk_hypotension,{visible:m.indexOf(this.groups.trews_sepshk_hypotension.id)>=0})),this.groupDataSet.add($.extend({},this.groups.trews_sepshk_hypoperfusion,{visible:m.indexOf(this.groups.trews_sepshk_hypoperfusion.id)>=0}));var f={showNested:_.indexOf(this.groups.trews_septic_shock.id)>=0};null!=a&&s&&(f.className="vis_g_septic_shock_active"),this.groupDataSet.add($.extend({},this.groups.trews_septic_shock,f)),this.groupDataSet.add($.extend({},this.groups.cms_org,{visible:m.indexOf(this.groups.cms_org.id)>=0})),this.groupDataSet.add($.extend({},this.groups.cms_soi,{visible:m.indexOf(this.groups.cms_soi.id)>=0})),this.groupDataSet.add($.extend({},this.groups.cms_sirs,{visible:m.indexOf(this.groups.cms_sirs.id)>=0}));var w={showNested:_.indexOf(this.groups.cms_severe_sepsis.id)>=0};null!=r&&i&&(w.className="vis_g_severe_sepsis_active"),this.groupDataSet.add($.extend({},this.groups.cms_severe_sepsis,w)),this.groupDataSet.add($.extend({},this.groups.cms_hypotension,{visible:m.indexOf(this.groups.cms_hypotension.id)>=0})),this.groupDataSet.add($.extend({},this.groups.cms_hypoperfusion,{visible:m.indexOf(this.groups.cms_hypoperfusion.id)>=0}));var g={showNested:_.indexOf(this.groups.cms_septic_shock.id)>=0};null!=a&&i&&(g.className="vis_g_septic_shock_active"),this.groupDataSet.add($.extend({},this.groups.cms_septic_shock,g));var b=new vis.DataSet,y=[{cls:"sirs",pcls:"severe_sepsis"},{cls:"organ_dysfunction",pcls:"severe_sepsis"},{cls:"hypotension",pcls:"septic_shock"},{cls:"hypoperfusion",pcls:"septic_shock"}],S="background-color: #BF0F00; color: #fff; border-color: #BF0F00;",C="background-color: #F48B8B; color: #1a1a1a; border-color: #F44444;",T="background-color: #d5ddf6; color: #1a1a1a; border-color: #97b0f8;",k={sirs:[],organ_dysfunction:[],trews_organ_dysfunction:[],hypotension:[],hypoperfusion:[],Ordered:[],Completed:[]},x={sirs:[],organ_dysfunction:[],trews_organ_dysfunction:[],hypotension:[],hypoperfusion:[]},O=[];if(null!=r)this.chartHasSepsisMarker?this.chart.setCustomTime(r,"v_cms_severe_sepsis"):(this.chart.addCustomTime(r,"v_cms_severe_sepsis"),this.chartHasSepsisMarker=!0);else if(this.chartHasSepsisMarker){try{this.chart.removeCustomTime("v_cms_severe_sepsis")}catch(e){appendToConsole("Failed to timeline marker for v_cms_severe_sepsis: "+e.message)}this.chartHasSepsisMarker=!1}for(var D in y){var N=y[D].pcls,M=y[D].cls;for(var P in e[N][M].criteria){var I=e[N][M].criteria[P];if(I.is_met){var A=new Date(1e3*I.measurement_time),R=null,E=null;"trews_organ_dysfunction"==M||"hypotension"==M||"hypoperfusion"==M?((R=t)-A<3e5&&(R=new Date(A.getTime()+3e5)),E="trews_organ_dysfunction"==M?"Window to trigger TREWS alert starting @ "+strToTime(A,!0,!0):"Window to trigger septic shock starting @ "+strToTime(A,!0,!0)):(R=new Date(A.getTime()+216e5),E="6hr window to trigger CMS severe sepsis starting @ "+strToTime(A,!0,!0));var L="initial_lactate"==I.name?"hpf_initial_lactate":I.name,B=this.groups[L];"respiratory_failure"==I.name?I.value:Number(I.value).toPrecision(3);b.add({id:I.name,group:B.id,content:E,title:E,start:A,end:R,type:"range"}),k[M].push({start:A,end:R}),null==this.groupDataSet.get(B.id)&&(x[M].push(B.id),this.groupDataSet.add($.extend({},B,{visible:m.indexOf(B.id)>=0})))}}}var H=this.groups.trews_sevsep_score.id;for(var P in e.trews_intervals){var V=e.trews_intervals[P];for(var W in V.intervals){var U=V.intervals[W];if(U.value){var A=new Date(U.ts_start),R=new Date(U.ts_end);if("trews_subalert"==V.name){var E="High Risk",j="High Risk of Severe Sepsis from "+strToTime(A,!0,!1)+" to "+strToTime(R,!0,!1),F={id:"crossing_"+W,group:this.groups.trewscore.id,content:E,start:A,end:R,title:j,type:"range",style:S},z=$.extend({},F,{id:"trews_sevsep_score_"+F.id,group:H});b.add(F),b.add(z)}else{var E="Window to trigger TREWS alert starting @ "+strToTime(A,!0,!0),B=this.groups[V.name];b.add({id:V.name+"_"+W,group:B.id,content:E,title:E,start:A,end:R,type:"range"}),k.trews_organ_dysfunction.push({start:A,end:R}),null==this.groupDataSet.get(B.id)&&(x.trews_organ_dysfunction.push(B.id),this.groupDataSet.add($.extend({},B,{visible:m.indexOf(B.id)>=0})))}}}}var G=["blood_culture","initial_lactate","crystalloid_fluid","antibiotics","repeat_lactate","vasopressors"];for(var W in G){var Q=G[W],J=Q+"_order",B=this.groups[Q],K=null,q=null,Y=!1,Z=null,X="vasopressors"==Q?a:r,ee="vasopressors"==Q?l:"repeat_lactate"==Q?o:n,te="repeat_lactate_order"==J&&e[J].is_met&&null==e[J].status;if(te)null!=ee&&(K="vis_g_"+Q+"_not_needed");else if(null!=e[J].status){Z=new Date(1e3*e[J].time);try{"status"in(q=JSON.parse(e[J].status))||(q=e[J])}catch(t){q=e[J]}var se=("repeat_lactate_order"==J?e[J].is_met||orderStatusCompleted(q):e[J].is_met&&orderStatusCompleted(q))&&null!=ee&&Z<=ee;"vasopressors"!=Q&&(c.status=c.status&&se,c.t=Math.max(c.t,Z)),p.status=p.status&&se,p.t=Math.max(p.t,Z);var ie=q.status+" at "+strToTime(Z,!0,!0),re="Need to complete by "+strToTime(ee,!0,!0),ae="Deadline passed at "+strToTime(ee,!0,!0),ne=ie;"Ordered"==q.status&&null!=ee&&Z<=ee?ne=ie+" but not completed. "+re:"Ordered"==q.status&&null!=ee&&Z>ee?ne="Order must be completed. "+ae:null!=ee&&Z>ee&&(ne=ie+". "+ae);Ie={id:e[J].name,group:B.id,content:"&nbsp;",title:ne,type:"range",style:"background-color: #30A00E; color: #fff; border-color: #30A00E;"};("repeat_lactate_order"==J?e[J].is_met||orderStatusCompleted(e[J]):e[J].is_met&&orderStatusCompleted(e[J]))||(Ie=$.extend({},Ie,{className:"vis_item_order_incomplete"})),null!=X?(K="Ordered"==q.status?"vis_g_"+Q+"_incomplete":null,Z<X?b.add($.extend({},Ie,{start:Z,end:new Date(Z.getTime()+6e5)})):b.add($.extend({},Ie,{start:X,end:Math.min(Math.max(X.getTime()+6e5,Z),ee)})),Z>ee&&(Y=!0,b.add({id:e[J].name+"_warning",group:B.id,content:"&nbsp;",title:ne,start:ee,end:Z,type:"range",style:S}))):b.add($.extend({},Ie,{start:Z,end:new Date(Z.getTime()+6e5)})),k["Ordered"==q.status?"Ordered":"Completed"].push({t_action:Z,t_condition:X,t_deadline:ee})}else null!=ee&&(K="vis_g_"+Q+"_incomplete"),"vasopressors"!=Q&&(c.status=!1),p.status=!1;if(!Y&&null!=ee){if(te)ne="Order not needed";else{var re="Need to complete by "+strToTime(ee,!0,!0),ae="Deadline passed at "+strToTime(ee,!0,!0),oe=Z;null==oe&&(oe=new Date);ne=oe<=ee?re:ae;null!=Z&&null!=q&&"Completed"==q.status&&Z<=ee&&(ne="Order completed before deadline passed at "+strToTime(ee,!0,!0))}b.add({id:e[J].name+"_deadline",group:B.id,content:"&nbsp;",title:ne,start:ee,end:new Date(ee.getTime()+6e5),type:"range",style:te?"background-color: #777; color: #fff; border-color: #777;":S})}if(null==this.groupDataSet.get(B.id)){O.push(B.id);var le={visible:!this.chartInitialized||m.indexOf(B.id)>=0};null!=K&&(le.className=K),this.groupDataSet.add($.extend({},B,le))}}c.t=c.status?c.t:null,p.t=p.status?p.t:null;var de=null==r?null:t;de=null==d?de:Math.min(de,d),de=null==c.t?de:Math.min(de,c.t);var ue=null==a?null:t;ue=null==u?ue:Math.min(ue,u),ue=null==p.t?ue:Math.min(ue,p.t);var ce=[],pe=[];i||s?(ce=(i?["cms_hypotension"]:[]).concat(s?["trews_sepshk_hypotension"]:[]),pe=(i?["cms_hypoperfusion"]:[]).concat(s?["trews_sepshk_hypoperfusion"]:[])):(ce=["cms_hypotension","trews_sepshk_hypotension"],pe=["cms_hypoperfusion","trews_sepshk_hypoperfusion"]);var he={sirs:{data:this.pairwiseOverlapUnion("sirs",k,!1,this.intersectOverlap),group_id:"sirs",group_ctn:"SIRS",parents:["cms_sirs"],sty:C},organ_dysfunction:{data:this.pairwiseOverlapUnion("organ_dysfunction",k,!0,this.unionOverlap),group_id:"org",group_ctn:"CMS Organ DF",parents:["cms_org"],sty:C},trews_organ_dysfunction:{data:this.pairwiseOverlapUnion("trews_organ_dysfunction",k,!0,this.unionOverlap),group_id:"trews_org",group_ctn:"TREWS Organ DF",parents:["trews_sevsep_org"],sty:C},hypotension:{data:this.pairwiseOverlapUnion("hypotension",k,!0,this.unionOverlap),group_id:"tension",group_ctn:"Hypotension",parents:ce,sty:C},hypoperfusion:{data:this.pairwiseOverlapUnion("hypoperfusion",k,!0,this.unionOverlap),group_id:"fusion",group_ctn:"Hypoperfusion",parents:pe,sty:C}},me=$.map(y,function(e){return e.cls});me.push("trews_organ_dysfunction"),this.clsSegments=he;var _e={};for(var D in me){var ve=he[M=me[D]].group_id,fe=he[M].group_ctn,we=he[M].parents;null==_e[ve]&&(_e[ve]=0);for(var ge=null!=he[M].skip_ctn_time&&he[M].skip_ctn_time,W=0;W<he[M].data.length;W++){Ie={content:fe+(ge?"":" @ "+strToTime(he[M].data[W].start,!0,!0)),title:fe+(ge?"":" @ "+strToTime(he[M].data[W].start,!0,!0)),start:he[M].data[W].start};if(Ie=null!=he[M].data[W].end?$.extend({},Ie,{end:he[M].data[W].end,type:"range"}):$.extend({},Ie,{type:"box"}),null!=he[M].group_title&&(Ie=$.extend({},Ie,{title:he[M].group_title})),null!=he[M].subgroup_id&&(Ie=$.extend({},Ie,{subgroup:he[M].subgroup_id})),b.add($.extend({},Ie,{id:ve+"_"+(_e[ve]+W).toString(),group:this.groups[ve].id,style:null!=he[M].sty?he[M].sty:T})),null!=we)for(Ae=0;Ae<we.length;Ae++){var be=we[Ae],ye=$.extend({},Ie,{id:be+"_"+ve+"_"+(_e[ve]+W).toString(),group:this.groups[be].id});null!=he[M].psty&&(ye=$.extend({},ye,{style:he[M].psty})),b.add(ye)}}_e[ve]+=he[M].data.length}var Se="Treatment "+(null==c.t?"incomplete":"completed at "+strToTime(c.t,!0,!1)),Ce="Treatment "+(null==p.t?"incomplete":"completed at "+strToTime(p.t,!0,!1)),Te=[{grp:"suspicion_of_infection",pgrp:["cms_soi","trews_sevsep_soi"],ob:e.severe_sepsis,ev:"suspicion_of_infection",t:"update_time",n:"Note",tip:"Suspected Source of Infection entered by "+(null!=e.severe_sepsis.suspicion_of_infection?e.severe_sepsis.suspicion_of_infection.update_user:"user"),end:de,sty:C,psty:T,min_duration:3e5},{grp:"cms_severe_sepsis",pgrp:null,ob:e,ev:"severe_sepsis",t:"cms_onset_time",n:"CMS Severe Sepsis onset",end:de,sty:S,extend_now:!0,extend_lbl:Se},{grp:"cms_septic_shock",pgrp:null,ob:e,ev:"septic_shock",t:"onset_time",n:"CMS Septic Shock onset",end:ue,sty:S,extend_now:!0,extend_lbl:Ce},{grp:"trews_severe_sepsis",pgrp:null,ob:e,ev:"severe_sepsis",t:"trews_onset_time",n:"TREWS Severe Sepsis onset",end:de,sty:S,extend_now:!0,extend_lbl:Se},{grp:"trews_septic_shock",pgrp:null,ob:e,ev:"septic_shock",t:"onset_time",n:"TREWS Septic Shock onset",end:ue,sty:S,extend_now:!0,extend_lbl:Ce}];for(var W in Te){var ke=Te[W].ob,xe=Te[W].ev,$e=Te[W].t,Oe=null,De=null,Ne=new Date(1e3*ke[xe][$e]),B=this.groups[Te[W].grp],Me=Te[W].grp,Pe=Te[W].min_duration;if("suspicion_of_infection"==xe&&null!=ke[xe][$e]&&null!=ke[xe].value?(Oe=Te[W].n+"("+ke[xe].value+")",De=Te[W].tip):ke[xe].is_met&&null!=ke[xe][$e]&&(Oe=Te[W].n,De=Te[W].n),null!=Oe){var Ie={content:Oe+" @ "+strToTime(Ne,!0,!0),title:De+" at "+strToTime(Ne,!0,!0),start:Ne};if(Ie=null!=Te[W].end?null!=Pe&&Te[W].end-Ne<Pe?$.extend({},Ie,{end:new Date(Ne.getTime()+Pe),type:"range"}):$.extend({},Ie,{end:Te[W].end,type:"range"}):$.extend({},Ie,{type:"box"}),null!=Te[W].sty&&(Ie=$.extend({},Ie,{style:Te[W].sty})),b.add($.extend({},Ie,{id:Me,group:B.id,style:Te[W].sty})),null!=Te[W].extend_now&&Te[W].extend_now&&null!=Te[W].extend_lbl&&null!=Te[W].end&&Te[W].end<t&&b.add({id:Me+"_to_now",group:B.id,content:"&nbsp;",title:Oe+" at "+strToTime(Ne,!0,!0)+". "+Te[W].extend_lbl,start:Te[W].end,end:t,style:"background-color: #555; color: #fff; border-color: #555;"}),null!=Te[W].pgrp)for(var Ae=0;Ae<Te[W].pgrp.length;Ae++){var Re=this.groups[Te[W].pgrp[Ae]],ye=$.extend({},Ie,{id:Te[W].pgrp[Ae]+"_"+Me,group:Re.id});null!=Te[W].psty&&(ye=$.extend({},ye,{style:Te[W].psty})),b.add(ye)}}}this.groupDataSet.add([{id:this.groups.trews_org.id,content:"TREWS Organ Dysfunction",nestedGroups:x.trews_organ_dysfunction,showNested:_.indexOf(this.groups.trews_org.id)>=0},{id:this.groups.sirs.id,className:"vis_g_cms_sirs",content:"CMS SIRS",nestedGroups:x.sirs,showNested:_.indexOf(this.groups.sirs.id)>=0},{id:this.groups.org.id,content:"CMS Organ Dysfunction",nestedGroups:x.organ_dysfunction,showNested:_.indexOf(this.groups.org.id)>=0},{id:this.groups.tension.id,className:"vis_g_hypotension",content:"Hypotension",nestedGroups:x.hypotension,showNested:_.indexOf(this.groups.tension.id)>=0},{id:this.groups.fusion.id,content:"Hypoperfusion",nestedGroups:x.hypoperfusion,showNested:_.indexOf(this.groups.fusion.id)>=0},{id:this.groups.orders.id,className:"vis_g_orders",content:"Orders",nestedGroups:O,showNested:!this.chartInitialized||_.indexOf(this.groups.orders.id)>=0}]),this.chart.setGroups(this.groupDataSet),this.chart.setItems(b),this.chartInitialized||(this.zoomToFit(),this.chartInitialized=!0),this.timelineVisible?(this.chartHdr.removeClass("hidden").addClass("unhidden"),this.chartCtn.removeClass("hidden").addClass("unhidden"),this.zoomCtn.removeClass("hidden").addClass("unhidden"),this.expandBtn.text("Hide Clinical Timeline")):(this.chartHdr.removeClass("unhidden").addClass("hidden"),this.chartCtn.removeClass("unhidden").addClass("hidden"),this.zoomCtn.removeClass("unhidden").addClass("hidden"),this.expandBtn.text("Show Clinical Timeline")),this.expandBtn.unbind(),this.expandBtn.click(function(e){timeline.chartCtn.hasClass("hidden")?(timeline.chartHdr.removeClass("hidden").addClass("unhidden"),timeline.chartCtn.removeClass("hidden").addClass("unhidden"),timeline.zoomCtn.removeClass("hidden").addClass("unhidden")):(timeline.chartHdr.removeClass("unhidden").addClass("hidden"),timeline.chartCtn.removeClass("unhidden").addClass("hidden"),timeline.zoomCtn.removeClass("unhidden").addClass("hidden")),timeline.timelineVisible=!timeline.timelineVisible,timeline.expandBtn.text(timeline.timelineVisible?"Hide Clinical Timeline":"Show Clinical Timeline")})}};