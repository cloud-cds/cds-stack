function isEmpty(e){for(var t in e)return!0;return!1}function isNumber(e){return"[object Number]"===Object.prototype.toString.call(e)}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}function graph(e,t,i,n,r,a,o){var s=Math.floor($("#graph-wrapper").width())-10;$("#graphdiv").width(s),$("#graphdiv").height(.3225*s);for(var l=$("#graphdiv"),d=[],c=e.chart_values.timestamp.length,u=0;u<c;u+=1)d.push([e.chart_values.timestamp[u],e.chart_values.trewscore[u]]);var h=e.chart_values.timestamp[c-1],p=e.chart_values.trewscore[c-1];$("h1 span").text(Number(p).toFixed(2));var f=[{color:"#555",lineWidth:1,xaxis:{from:h,to:h}},{color:"#e64535",lineWidth:1,yaxis:{from:e.trewscore_threshold,to:e.trewscore_threshold}}],m=void 0!=e.patient_arrival.timestamp?1e3*e.patient_arrival.timestamp:null,v=void 0!=t?1e3*t:null,g=void 0!=i?1e3*i:null,x=null,b=null;if(void 0!=e.patient_arrival.timestamp){var w={color:"#ccc",lineWidth:1,xaxis:{from:m,to:m}},y=jQuery.inArray(m,e.chart_values.trewscore);f.push(w)}if(void 0!=t){var k={color:"#ccc",lineWidth:1,xaxis:{from:v,to:v}};x=jQuery.inArray(v,e.chart_values.trewscore),f.push(k)}if(void 0!=i){var _={color:"#ccc",lineWidth:1,xaxis:{from:g,to:g}};b=jQuery.inArray(g,e.chart_values.trewscore),f.push(_)}var C=$.plot(l,[{data:d,label:"Trewscore",color:"#ca011a"}],{series:{lines:{show:!0},points:{show:!0},threshold:[{below:e.trewscore_threshold,color:"#000000"}]},legend:{show:!1},grid:{hoverable:!0,clickable:!0,markings:f,margin:{top:40,left:0,bottom:0,right:0},borderWidth:{top:0,left:1,bottom:1,right:0}},crosshair:{mode:"x"},yaxis:{min:a,max:o,ticks:[[0,"0"],[e.trewscore_threshold,e.trewscore_threshold],[1,"1"]],tickColor:"#e64535",tickLength:5,font:{size:11,lineHeight:13,family:"Helvetica, Arial, sans-serif",color:"#000"}},xaxis:{min:n,max:r,mode:"time",tickColor:"#EEEEEE",timeformat:"%b %e %H:%M",timezone:"browser",monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],font:{size:11,lineHeight:13,family:"Helvetica, Arial, sans-serif",color:"#000"}}});$("#graphdiv").bind("plothover",function(t,i,n){"("+i.x.toFixed(2)+", "+i.y.toFixed(2)+")";if(n){var r=n.dataIndex,a=n.datapoint[0].toFixed(2),o=n.datapoint[1].toFixed(2),s="<div class='tooltip-header'>\t\t\t\t\t\t\t\t<div class='row cf'>\t\t\t\t\t\t\t\t\t<h4 class='name'>TREWScore</h4>\t\t\t\t\t\t\t\t\t<h4 class='value'>"+o+"</h4>\t\t\t\t\t\t\t\t</div><div class='row cf time'>\t\t\t\t\t\t\t\t\t<h4 class='name'>Time</h4>\t\t\t\t\t\t\t\t\t<h4 class='value'>"+strToTime(a,!0)+"</h4>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>",l=r>=e.chart_values.tf_1_name.length?e.chart_values.tf_1_name.length-1:r;s+="<div class='row cf'>\t\t\t\t\t\t\t<h4 class='name'>"+humanReadable(e.chart_values.tf_1_name[l])+"</h4>\t\t\t\t\t\t\t<h4 class='value'>"+e.chart_values.tf_1_value[l]+"</h4>\t\t\t\t\t\t</div><div class='row cf'>\t\t\t\t\t\t\t<h4 class='name'>"+humanReadable(e.chart_values.tf_2_name[l])+"</h4>\t\t\t\t\t\t\t<h4 class='value'>"+e.chart_values.tf_2_value[l]+"</h4>\t\t\t\t\t\t</div><div class='row cf'>\t\t\t\t\t\t\t<h4 class='name'>"+humanReadable(e.chart_values.tf_3_name[l])+"</h4>\t\t\t\t\t\t\t<h4 class='value'>"+e.chart_values.tf_3_value[l]+"</h4>\t\t\t\t\t\t</div>",$("#tooltip").html(s).css({top:n.pageY+5,left:n.pageX+5}).fadeIn(300)}else $("#tooltip").hide()});var S=C.pointOffset({x:h,y:p});0==e.chart_values.timestamp.length?graphTag(C,r,p,"Now","now"):graphTag(C,h,p,"Most Recent","now"),m&&y&&graphTag(C,m,y,"Patient<br/>Arrival","patient-arrival-graph-tag"),v&&x&&graphTag(C,v,x,"Onset of<br/>Severe Sepsis","severe-sepsis-graph-tag"),g&&b&&graphTag(C,g,b,"Onset of<br/>Septic Shock","septic-shock-graph-tag"),l.append("<div id='threshold' style='left:"+S.left+"px;'>\t\t\t<h3>Septic Shock<br />Risk Threshold</h3>\t\t\t</div>")}function graphTag(e,t,i,n,r){var a=$("#graphdiv"),o=e.pointOffset({x:t,y:i}),s=new Date(t),l=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes();a.append("<div id='"+r+"' class='graph-tag' style='left:"+o.left+"px;'>\t\t\t<h3>"+n+"</h3>\t\t\t<h6>"+s.getHours()+":"+l+"</h6>\t\t</div>")}function timeLapsed(e){var t=6e4,i=36e5,n=864e5,r=new Date(Date.now()-e);if(r<t){var a=r.getUTCSeconds()>1?" secs ago":" sec ago";return r.getUTCSeconds()+a}if(r<i){var a=r.getUTCMinutes()>1?" mins ago":" min ago";return r.getUTCMinutes()+a}if(r<n){var a=r.getUTCHours()>1?" hrs ago":" hr ago";return r.getUTCHours()+a}return"on "+e.toLocaleDateString()+" at "+e.toLocaleTimeString()}function timeRemaining(e){var t=new Date(e-Date.now()),i=t.getUTCMinutes()<10?"0"+t.getUTCMinutes():t.getUTCMinutes();return t.getUTCHours()+" hours and "+i+" minutes remaining"}function strToTime(e,t){var i=new Date(Number(e)),n=i.getFullYear(),r=i.getMonth()+1,a=i.getDate(),o=i.getHours()<10?"0"+i.getHours():i.getHours(),s=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes();return t?o+":"+s+" "+r+"/"+a+"/"+n:r+"/"+a+"/"+n+" "+o+":"+s}function humanReadable(e){return FID_TO_HUMAN_READABLE[e]?FID_TO_HUMAN_READABLE[e]:e}function getQueryVariable(e){for(var t=window.location.search.substring(1),i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]==e)return r[1]}return!1}function cleanUserId(e){return e.replace(/^\++/,"")}!function(e){e.color={},e.color.make=function(t,i,n,r){var a={};return a.r=t||0,a.g=i||0,a.b=n||0,a.a=null!=r?r:1,a.add=function(e,t){for(var i=0;i<e.length;++i)a[e.charAt(i)]+=t;return a.normalize()},a.scale=function(e,t){for(var i=0;i<e.length;++i)a[e.charAt(i)]*=t;return a.normalize()},a.toString=function(){return a.a>=1?"rgb("+[a.r,a.g,a.b].join(",")+")":"rgba("+[a.r,a.g,a.b,a.a].join(",")+")"},a.normalize=function(){function e(e,t,i){return t<e?e:t>i?i:t}return a.r=e(0,parseInt(a.r),255),a.g=e(0,parseInt(a.g),255),a.b=e(0,parseInt(a.b),255),a.a=e(0,a.a,1),a},a.clone=function(){return e.color.make(a.r,a.b,a.g,a.a)},a.normalize()},e.color.extract=function(t,i){var n;do{if(n=t.css(i).toLowerCase(),""!=n&&"transparent"!=n)break;t=t.parent()}while(t.length&&!e.nodeName(t.get(0),"body"));return"rgba(0, 0, 0, 0)"==n&&(n="transparent"),e.color.parse(n)},e.color.parse=function(i){var n,r=e.color.make;if(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(i))return r(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10));if(n=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i))return r(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseFloat(n[4]));if(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(i))return r(2.55*parseFloat(n[1]),2.55*parseFloat(n[2]),2.55*parseFloat(n[3]));if(n=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i))return r(2.55*parseFloat(n[1]),2.55*parseFloat(n[2]),2.55*parseFloat(n[3]),parseFloat(n[4]));if(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(i))return r(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16));if(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(i))return r(parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16));var a=e.trim(i).toLowerCase();return"transparent"==a?r(255,255,255,0):(n=t[a]||[0,0,0],r(n[0],n[1],n[2]))};var t={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(e){function t(t,i){var n=i.children("."+t)[0];if(null==n&&(n=document.createElement("canvas"),n.className=t,e(n).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(i),!n.getContext)){if(!window.G_vmlCanvasManager)throw new Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");n=window.G_vmlCanvasManager.initElement(n)}this.element=n;var r=this.context=n.getContext("2d"),a=window.devicePixelRatio||1,o=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1;this.pixelRatio=a/o,this.resize(i.width(),i.height()),this.textContainer=null,this.text={},this._textCache={}}function i(i,r,a,o){function s(e,t){t=[ve].concat(t);for(var i=0;i<e.length;++i)e[i].apply(this,t)}function l(){for(var i={Canvas:t},n=0;n<o.length;++n){var r=o[n];r.init(ve,i),r.options&&e.extend(!0,re,r.options)}}function d(t){e.extend(!0,re,t),t&&t.colors&&(re.colors=t.colors),null==re.xaxis.color&&(re.xaxis.color=e.color.parse(re.grid.color).scale("a",.22).toString()),null==re.yaxis.color&&(re.yaxis.color=e.color.parse(re.grid.color).scale("a",.22).toString()),null==re.xaxis.tickColor&&(re.xaxis.tickColor=re.grid.tickColor||re.xaxis.color),null==re.yaxis.tickColor&&(re.yaxis.tickColor=re.grid.tickColor||re.yaxis.color),null==re.grid.borderColor&&(re.grid.borderColor=re.grid.color),null==re.grid.tickColor&&(re.grid.tickColor=e.color.parse(re.grid.color).scale("a",.22).toString());var n,r,a,o=i.css("font-size"),l=o?+o.replace("px",""):13,d={style:i.css("font-style"),size:Math.round(.8*l),variant:i.css("font-variant"),weight:i.css("font-weight"),family:i.css("font-family")};for(a=re.xaxes.length||1,n=0;n<a;++n)r=re.xaxes[n],r&&!r.tickColor&&(r.tickColor=r.color),r=e.extend(!0,{},re.xaxis,r),re.xaxes[n]=r,r.font&&(r.font=e.extend({},d,r.font),r.font.color||(r.font.color=r.color),r.font.lineHeight||(r.font.lineHeight=Math.round(1.15*r.font.size)));for(a=re.yaxes.length||1,n=0;n<a;++n)r=re.yaxes[n],r&&!r.tickColor&&(r.tickColor=r.color),r=e.extend(!0,{},re.yaxis,r),re.yaxes[n]=r,r.font&&(r.font=e.extend({},d,r.font),r.font.color||(r.font.color=r.color),r.font.lineHeight||(r.font.lineHeight=Math.round(1.15*r.font.size)));for(re.xaxis.noTicks&&null==re.xaxis.ticks&&(re.xaxis.ticks=re.xaxis.noTicks),re.yaxis.noTicks&&null==re.yaxis.ticks&&(re.yaxis.ticks=re.yaxis.noTicks),re.x2axis&&(re.xaxes[1]=e.extend(!0,{},re.xaxis,re.x2axis),re.xaxes[1].position="top",null==re.x2axis.min&&(re.xaxes[1].min=null),null==re.x2axis.max&&(re.xaxes[1].max=null)),re.y2axis&&(re.yaxes[1]=e.extend(!0,{},re.yaxis,re.y2axis),re.yaxes[1].position="right",null==re.y2axis.min&&(re.yaxes[1].min=null),null==re.y2axis.max&&(re.yaxes[1].max=null)),re.grid.coloredAreas&&(re.grid.markings=re.grid.coloredAreas),re.grid.coloredAreasColor&&(re.grid.markingsColor=re.grid.coloredAreasColor),re.lines&&e.extend(!0,re.series.lines,re.lines),re.points&&e.extend(!0,re.series.points,re.points),re.bars&&e.extend(!0,re.series.bars,re.bars),null!=re.shadowSize&&(re.series.shadowSize=re.shadowSize),null!=re.highlightColor&&(re.series.highlightColor=re.highlightColor),n=0;n<re.xaxes.length;++n)v(ce,n+1).options=re.xaxes[n];for(n=0;n<re.yaxes.length;++n)v(ue,n+1).options=re.yaxes[n];for(var c in me)re.hooks[c]&&re.hooks[c].length&&(me[c]=me[c].concat(re.hooks[c]));s(me.processOptions,[re])}function c(e){ne=u(e),g(),x()}function u(t){for(var i=[],n=0;n<t.length;++n){var r=e.extend(!0,{},re.series);null!=t[n].data?(r.data=t[n].data,delete t[n].data,e.extend(!0,r,t[n]),t[n].data=r.data):r.data=t[n],i.push(r)}return i}function h(e,t){var i=e[t+"axis"];return"object"==typeof i&&(i=i.n),"number"!=typeof i&&(i=1),i}function p(){return e.grep(ce.concat(ue),function(e){return e})}function f(e){var t,i,n={};for(t=0;t<ce.length;++t)i=ce[t],i&&i.used&&(n["x"+i.n]=i.c2p(e.left));for(t=0;t<ue.length;++t)i=ue[t],i&&i.used&&(n["y"+i.n]=i.c2p(e.top));return void 0!==n.x1&&(n.x=n.x1),void 0!==n.y1&&(n.y=n.y1),n}function m(e){var t,i,n,r={};for(t=0;t<ce.length;++t)if(i=ce[t],i&&i.used&&(n="x"+i.n,null==e[n]&&1==i.n&&(n="x"),null!=e[n])){r.left=i.p2c(e[n]);break}for(t=0;t<ue.length;++t)if(i=ue[t],i&&i.used&&(n="y"+i.n,null==e[n]&&1==i.n&&(n="y"),null!=e[n])){r.top=i.p2c(e[n]);break}return r}function v(t,i){return t[i-1]||(t[i-1]={n:i,direction:t==ce?"x":"y",options:e.extend(!0,{},t==ce?re.xaxis:re.yaxis)}),t[i-1]}function g(){var t,i=ne.length,n=-1;for(t=0;t<ne.length;++t){var r=ne[t].color;null!=r&&(i--,"number"==typeof r&&r>n&&(n=r))}i<=n&&(i=n+1);var a,o=[],s=re.colors,l=s.length,d=0;for(t=0;t<i;t++)a=e.color.parse(s[t%l]||"#666"),t%l==0&&t&&(d=d>=0?d<.5?-d-.2:0:-d),o[t]=a.scale("rgb",1+d);var c,u=0;for(t=0;t<ne.length;++t){if(c=ne[t],null==c.color?(c.color=o[u].toString(),++u):"number"==typeof c.color&&(c.color=o[c.color].toString()),null==c.lines.show){var p,f=!0;for(p in c)if(c[p]&&c[p].show){f=!1;break}f&&(c.lines.show=!0)}null==c.lines.zero&&(c.lines.zero=!!c.lines.fill),c.xaxis=v(ce,h(c,"x")),c.yaxis=v(ue,h(c,"y"))}}function x(){function t(e,t,i){t<e.datamin&&t!=-x&&(e.datamin=t),i>e.datamax&&i!=x&&(e.datamax=i)}var i,n,r,a,o,l,d,c,u,h,f,m,v=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,x=Number.MAX_VALUE;for(e.each(p(),function(e,t){t.datamin=v,t.datamax=g,t.used=!1}),i=0;i<ne.length;++i)o=ne[i],o.datapoints={points:[]},s(me.processRawData,[o,o.data,o.datapoints]);for(i=0;i<ne.length;++i){if(o=ne[i],f=o.data,m=o.datapoints.format,!m){if(m=[],m.push({x:!0,number:!0,required:!0}),m.push({y:!0,number:!0,required:!0}),o.bars.show||o.lines.show&&o.lines.fill){var b=!!(o.bars.show&&o.bars.zero||o.lines.show&&o.lines.zero);m.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:b}),o.bars.horizontal&&(delete m[m.length-1].y,m[m.length-1].x=!0)}o.datapoints.format=m}if(null==o.datapoints.pointsize){o.datapoints.pointsize=m.length,d=o.datapoints.pointsize,l=o.datapoints.points;var w=o.lines.show&&o.lines.steps;for(o.xaxis.used=o.yaxis.used=!0,n=r=0;n<f.length;++n,r+=d){h=f[n];var y=null==h;if(!y)for(a=0;a<d;++a)c=h[a],u=m[a],u&&(u.number&&null!=c&&(c=+c,isNaN(c)?c=null:c==1/0?c=x:c==-(1/0)&&(c=-x)),null==c&&(u.required&&(y=!0),null!=u.defaultValue&&(c=u.defaultValue))),l[r+a]=c;if(y)for(a=0;a<d;++a)c=l[r+a],null!=c&&(u=m[a],u.autoscale!==!1&&(u.x&&t(o.xaxis,c,c),u.y&&t(o.yaxis,c,c))),l[r+a]=null;else if(w&&r>0&&null!=l[r-d]&&l[r-d]!=l[r]&&l[r-d+1]!=l[r+1]){for(a=0;a<d;++a)l[r+d+a]=l[r+a];l[r+1]=l[r-d+1],r+=d}}}}for(i=0;i<ne.length;++i)o=ne[i],s(me.processDatapoints,[o,o.datapoints]);for(i=0;i<ne.length;++i){o=ne[i],l=o.datapoints.points,d=o.datapoints.pointsize,m=o.datapoints.format;var k=v,_=v,C=g,S=g;for(n=0;n<l.length;n+=d)if(null!=l[n])for(a=0;a<d;++a)c=l[n+a],u=m[a],u&&u.autoscale!==!1&&c!=x&&c!=-x&&(u.x&&(c<k&&(k=c),c>C&&(C=c)),u.y&&(c<_&&(_=c),c>S&&(S=c)));if(o.bars.show){var T;switch(o.bars.align){case"left":T=0;break;case"right":T=-o.bars.barWidth;break;default:T=-o.bars.barWidth/2}o.bars.horizontal?(_+=T,S+=T+o.bars.barWidth):(k+=T,C+=T+o.bars.barWidth)}t(o.xaxis,k,C),t(o.yaxis,_,S)}e.each(p(),function(e,t){t.datamin==v&&(t.datamin=null),t.datamax==g&&(t.datamax=null)})}function b(){i.css("padding",0).children().filter(function(){return!e(this).hasClass("flot-overlay")&&!e(this).hasClass("flot-base")}).remove(),"static"==i.css("position")&&i.css("position","relative"),ae=new t("flot-base",i),oe=new t("flot-overlay",i),le=ae.context,de=oe.context,se=e(oe.element).unbind();var n=i.data("plot");n&&(n.shutdown(),oe.clear()),i.data("plot",ve)}function w(){re.grid.hoverable&&(se.mousemove(q),se.bind("mouseleave",U)),re.grid.clickable&&se.click(V),s(me.bindEvents,[se])}function y(){xe&&clearTimeout(xe),se.unbind("mousemove",q),se.unbind("mouseleave",U),se.unbind("click",V),s(me.shutdown,[se])}function k(e){function t(e){return e}var i,n,r=e.options.transform||t,a=e.options.inverseTransform;"x"==e.direction?(i=e.scale=pe/Math.abs(r(e.max)-r(e.min)),n=Math.min(r(e.max),r(e.min))):(i=e.scale=fe/Math.abs(r(e.max)-r(e.min)),i=-i,n=Math.max(r(e.max),r(e.min))),r==t?e.p2c=function(e){return(e-n)*i}:e.p2c=function(e){return(r(e)-n)*i},a?e.c2p=function(e){return a(n+e/i)}:e.c2p=function(e){return n+e/i}}function _(e){for(var t=e.options,i=e.ticks||[],n=t.labelWidth||0,r=t.labelHeight||0,a=n||("x"==e.direction?Math.floor(ae.width/(i.length||1)):null),o=e.direction+"Axis "+e.direction+e.n+"Axis",s="flot-"+e.direction+"-axis flot-"+e.direction+e.n+"-axis "+o,l=t.font||"flot-tick-label tickLabel",d=0;d<i.length;++d){var c=i[d];if(c.label){var u=ae.getTextInfo(s,c.label,l,null,a);n=Math.max(n,u.width),r=Math.max(r,u.height)}}e.labelWidth=t.labelWidth||n,e.labelHeight=t.labelHeight||r}function C(t){var i=t.labelWidth,n=t.labelHeight,r=t.options.position,a="x"===t.direction,o=t.options.tickLength,s=re.grid.axisMargin,l=re.grid.labelMargin,d=!0,c=!0,u=!0,h=!1;e.each(a?ce:ue,function(e,i){i&&(i.show||i.reserveSpace)&&(i===t?h=!0:i.options.position===r&&(h?c=!1:d=!1),h||(u=!1))}),c&&(s=0),null==o&&(o=u?"full":5),isNaN(+o)||(l+=+o),a?(n+=l,"bottom"==r?(he.bottom+=n+s,t.box={top:ae.height-he.bottom,height:n}):(t.box={top:he.top+s,height:n},he.top+=n+s)):(i+=l,"left"==r?(t.box={left:he.left+s,width:i},he.left+=i+s):(he.right+=i+s,t.box={left:ae.width-he.right,width:i})),t.position=r,t.tickLength=o,t.box.padding=l,t.innermost=d}function S(e){"x"==e.direction?(e.box.left=he.left-e.labelWidth/2,e.box.width=ae.width-he.left-he.right+e.labelWidth):(e.box.top=he.top-e.labelHeight/2,e.box.height=ae.height-he.bottom-he.top+e.labelHeight)}function T(){var t,i=re.grid.minBorderMargin;if(null==i)for(i=0,t=0;t<ne.length;++t)i=Math.max(i,2*(ne[t].points.radius+ne[t].points.lineWidth/2));var n={left:i,right:i,top:i,bottom:i};e.each(p(),function(e,t){t.reserveSpace&&t.ticks&&t.ticks.length&&("x"===t.direction?(n.left=Math.max(n.left,t.labelWidth/2),n.right=Math.max(n.right,t.labelWidth/2)):(n.bottom=Math.max(n.bottom,t.labelHeight/2),n.top=Math.max(n.top,t.labelHeight/2)))}),he.left=Math.ceil(Math.max(n.left,he.left)),he.right=Math.ceil(Math.max(n.right,he.right)),he.top=Math.ceil(Math.max(n.top,he.top)),he.bottom=Math.ceil(Math.max(n.bottom,he.bottom))}function M(){var t,i=p(),n=re.grid.show;for(var r in he){var a=re.grid.margin||0;he[r]="number"==typeof a?a:a[r]||0}s(me.processOffset,[he]);for(var r in he)"object"==typeof re.grid.borderWidth?he[r]+=n?re.grid.borderWidth[r]:0:he[r]+=n?re.grid.borderWidth:0;if(e.each(i,function(e,t){var i=t.options;t.show=null==i.show?t.used:i.show,t.reserveSpace=null==i.reserveSpace?t.show:i.reserveSpace,A(t)}),n){var o=e.grep(i,function(e){return e.show||e.reserveSpace});for(e.each(o,function(e,t){P(t),D(t),O(t,t.ticks),_(t)}),t=o.length-1;t>=0;--t)C(o[t]);T(),e.each(o,function(e,t){S(t)})}pe=ae.width-he.left-he.right,fe=ae.height-he.bottom-he.top,e.each(i,function(e,t){k(t)}),n&&E(),j()}function A(e){var t=e.options,i=+(null!=t.min?t.min:e.datamin),n=+(null!=t.max?t.max:e.datamax),r=n-i;if(0==r){var a=0==n?1:.01;null==t.min&&(i-=a),null!=t.max&&null==t.min||(n+=a)}else{var o=t.autoscaleMargin;null!=o&&(null==t.min&&(i-=r*o,i<0&&null!=e.datamin&&e.datamin>=0&&(i=0)),null==t.max&&(n+=r*o,n>0&&null!=e.datamax&&e.datamax<=0&&(n=0)))}e.min=i,e.max=n}function P(t){var i,r=t.options;i="number"==typeof r.ticks&&r.ticks>0?r.ticks:.3*Math.sqrt("x"==t.direction?ae.width:ae.height);var a=(t.max-t.min)/i,o=-Math.floor(Math.log(a)/Math.LN10),s=r.tickDecimals;null!=s&&o>s&&(o=s);var l,d=Math.pow(10,-o),c=a/d;if(c<1.5?l=1:c<3?(l=2,c>2.25&&(null==s||o+1<=s)&&(l=2.5,++o)):l=c<7.5?5:10,l*=d,null!=r.minTickSize&&l<r.minTickSize&&(l=r.minTickSize),t.delta=a,t.tickDecimals=Math.max(0,null!=s?s:o),t.tickSize=r.tickSize||l,"time"==r.mode&&!t.tickGenerator)throw new Error("Time mode requires the flot.time plugin.");if(t.tickGenerator||(t.tickGenerator=function(e){var t,i=[],r=n(e.min,e.tickSize),a=0,o=Number.NaN;do t=o,o=r+a*e.tickSize,i.push(o),++a;while(o<e.max&&o!=t);return i},t.tickFormatter=function(e,t){var i=t.tickDecimals?Math.pow(10,t.tickDecimals):1,n=""+Math.round(e*i)/i;if(null!=t.tickDecimals){var r=n.indexOf("."),a=r==-1?0:n.length-r-1;if(a<t.tickDecimals)return(a?n:n+".")+(""+i).substr(1,t.tickDecimals-a)}return n}),e.isFunction(r.tickFormatter)&&(t.tickFormatter=function(e,t){return""+r.tickFormatter(e,t)}),null!=r.alignTicksWithAxis){var u=("x"==t.direction?ce:ue)[r.alignTicksWithAxis-1];if(u&&u.used&&u!=t){var h=t.tickGenerator(t);if(h.length>0&&(null==r.min&&(t.min=Math.min(t.min,h[0])),null==r.max&&h.length>1&&(t.max=Math.max(t.max,h[h.length-1]))),t.tickGenerator=function(e){var t,i,n=[];for(i=0;i<u.ticks.length;++i)t=(u.ticks[i].v-u.min)/(u.max-u.min),t=e.min+t*(e.max-e.min),n.push(t);return n},!t.mode&&null==r.tickDecimals){var p=Math.max(0,-Math.floor(Math.log(t.delta)/Math.LN10)+1),f=t.tickGenerator(t);f.length>1&&/\..*0$/.test((f[1]-f[0]).toFixed(p))||(t.tickDecimals=p)}}}}function D(t){var i=t.options.ticks,n=[];null==i||"number"==typeof i&&i>0?n=t.tickGenerator(t):i&&(n=e.isFunction(i)?i(t):i);var r,a;for(t.ticks=[],r=0;r<n.length;++r){var o=null,s=n[r];"object"==typeof s?(a=+s[0],s.length>1&&(o=s[1])):a=+s,null==o&&(o=t.tickFormatter(a,t)),isNaN(a)||t.ticks.push({v:a,label:o})}}function O(e,t){e.options.autoscaleMargin&&t.length>0&&(null==e.options.min&&(e.min=Math.min(e.min,t[0].v)),null==e.options.max&&t.length>1&&(e.max=Math.max(e.max,t[t.length-1].v)))}function $(){ae.clear(),s(me.drawBackground,[le]);var e=re.grid;e.show&&e.backgroundColor&&z(),e.show&&!e.aboveData&&I();for(var t=0;t<ne.length;++t)s(me.drawSeries,[le,ne[t]]),R(ne[t]);s(me.draw,[le]),e.show&&e.aboveData&&I(),ae.render(),X()}function N(e,t){for(var i,n,r,a,o=p(),s=0;s<o.length;++s)if(i=o[s],i.direction==t&&(a=t+i.n+"axis",e[a]||1!=i.n||(a=t+"axis"),e[a])){n=e[a].from,r=e[a].to;break}if(e[a]||(i="x"==t?ce[0]:ue[0],n=e[t+"1"],r=e[t+"2"]),null!=n&&null!=r&&n>r){var l=n;n=r,r=l}return{from:n,to:r,axis:i}}function z(){le.save(),le.translate(he.left,he.top),le.fillStyle=ie(re.grid.backgroundColor,fe,0,"rgba(255, 255, 255, 0)"),le.fillRect(0,0,pe,fe),le.restore()}function I(){var t,i,n,r;le.save(),le.translate(he.left,he.top);var a=re.grid.markings;if(a)for(e.isFunction(a)&&(i=ve.getAxes(),i.xmin=i.xaxis.min,i.xmax=i.xaxis.max,i.ymin=i.yaxis.min,i.ymax=i.yaxis.max,a=a(i)),t=0;t<a.length;++t){var o=a[t],s=N(o,"x"),l=N(o,"y");if(null==s.from&&(s.from=s.axis.min),null==s.to&&(s.to=s.axis.max),null==l.from&&(l.from=l.axis.min),null==l.to&&(l.to=l.axis.max),!(s.to<s.axis.min||s.from>s.axis.max||l.to<l.axis.min||l.from>l.axis.max)){s.from=Math.max(s.from,s.axis.min),s.to=Math.min(s.to,s.axis.max),l.from=Math.max(l.from,l.axis.min),l.to=Math.min(l.to,l.axis.max);var d=s.from===s.to,c=l.from===l.to;if(!d||!c)if(s.from=Math.floor(s.axis.p2c(s.from)),s.to=Math.floor(s.axis.p2c(s.to)),l.from=Math.floor(l.axis.p2c(l.from)),l.to=Math.floor(l.axis.p2c(l.to)),d||c){var u=o.lineWidth||re.grid.markingsLineWidth,h=u%2?.5:0;le.beginPath(),le.strokeStyle=o.color||re.grid.markingsColor,le.lineWidth=u,d?(le.moveTo(s.to+h,l.from),le.lineTo(s.to+h,l.to)):(le.moveTo(s.from,l.to+h),le.lineTo(s.to,l.to+h)),le.stroke()}else le.fillStyle=o.color||re.grid.markingsColor,le.fillRect(s.from,l.to,s.to-s.from,l.from-l.to)}}i=p(),n=re.grid.borderWidth;for(var f=0;f<i.length;++f){var m,v,g,x,b=i[f],w=b.box,y=b.tickLength;if(b.show&&0!=b.ticks.length){for(le.lineWidth=1,"x"==b.direction?(m=0,v="full"==y?"top"==b.position?0:fe:w.top-he.top+("top"==b.position?w.height:0)):(v=0,m="full"==y?"left"==b.position?0:pe:w.left-he.left+("left"==b.position?w.width:0)),b.innermost||(le.strokeStyle=b.options.color,le.beginPath(),g=x=0,"x"==b.direction?g=pe+1:x=fe+1,1==le.lineWidth&&("x"==b.direction?v=Math.floor(v)+.5:m=Math.floor(m)+.5),le.moveTo(m,v),le.lineTo(m+g,v+x),le.stroke()),le.strokeStyle=b.options.tickColor,le.beginPath(),t=0;t<b.ticks.length;++t){var k=b.ticks[t].v;g=x=0,isNaN(k)||k<b.min||k>b.max||"full"==y&&("object"==typeof n&&n[b.position]>0||n>0)&&(k==b.min||k==b.max)||("x"==b.direction?(m=b.p2c(k),x="full"==y?-fe:y,"top"==b.position&&(x=-x)):(v=b.p2c(k),g="full"==y?-pe:y,"left"==b.position&&(g=-g)),1==le.lineWidth&&("x"==b.direction?m=Math.floor(m)+.5:v=Math.floor(v)+.5),le.moveTo(m,v),le.lineTo(m+g,v+x))}le.stroke()}}n&&(r=re.grid.borderColor,"object"==typeof n||"object"==typeof r?("object"!=typeof n&&(n={top:n,right:n,bottom:n,left:n}),"object"!=typeof r&&(r={top:r,right:r,bottom:r,left:r}),n.top>0&&(le.strokeStyle=r.top,le.lineWidth=n.top,le.beginPath(),le.moveTo(0-n.left,0-n.top/2),le.lineTo(pe,0-n.top/2),le.stroke()),n.right>0&&(le.strokeStyle=r.right,le.lineWidth=n.right,le.beginPath(),le.moveTo(pe+n.right/2,0-n.top),le.lineTo(pe+n.right/2,fe),le.stroke()),n.bottom>0&&(le.strokeStyle=r.bottom,le.lineWidth=n.bottom,le.beginPath(),le.moveTo(pe+n.right,fe+n.bottom/2),le.lineTo(0,fe+n.bottom/2),le.stroke()),n.left>0&&(le.strokeStyle=r.left,le.lineWidth=n.left,le.beginPath(),le.moveTo(0-n.left/2,fe+n.bottom),le.lineTo(0-n.left/2,0),le.stroke())):(le.lineWidth=n,le.strokeStyle=re.grid.borderColor,le.strokeRect(-n/2,-n/2,pe+n,fe+n))),le.restore()}function E(){e.each(p(),function(e,t){var i,n,r,a,o,s=t.box,l=t.direction+"Axis "+t.direction+t.n+"Axis",d="flot-"+t.direction+"-axis flot-"+t.direction+t.n+"-axis "+l,c=t.options.font||"flot-tick-label tickLabel";if(ae.removeText(d),t.show&&0!=t.ticks.length)for(var u=0;u<t.ticks.length;++u)i=t.ticks[u],!i.label||i.v<t.min||i.v>t.max||("x"==t.direction?(a="center",n=he.left+t.p2c(i.v),"bottom"==t.position?r=s.top+s.padding:(r=s.top+s.height-s.padding,o="bottom")):(o="middle",r=he.top+t.p2c(i.v),"left"==t.position?(n=s.left+s.width-s.padding,a="right"):n=s.left+s.padding),ae.addText(d,n,r,i.label,c,null,null,a,o))})}function R(e){e.lines.show&&L(e),e.bars.show&&F(e),e.points.show&&W(e)}function L(e){function t(e,t,i,n,r){var a=e.points,o=e.pointsize,s=null,l=null;le.beginPath();for(var d=o;d<a.length;d+=o){var c=a[d-o],u=a[d-o+1],h=a[d],p=a[d+1];if(null!=c&&null!=h){if(u<=p&&u<r.min){if(p<r.min)continue;c=(r.min-u)/(p-u)*(h-c)+c,u=r.min}else if(p<=u&&p<r.min){if(u<r.min)continue;h=(r.min-u)/(p-u)*(h-c)+c,p=r.min}if(u>=p&&u>r.max){if(p>r.max)continue;c=(r.max-u)/(p-u)*(h-c)+c,u=r.max}else if(p>=u&&p>r.max){if(u>r.max)continue;h=(r.max-u)/(p-u)*(h-c)+c,p=r.max}if(c<=h&&c<n.min){if(h<n.min)continue;u=(n.min-c)/(h-c)*(p-u)+u,c=n.min}else if(h<=c&&h<n.min){if(c<n.min)continue;p=(n.min-c)/(h-c)*(p-u)+u,h=n.min}if(c>=h&&c>n.max){if(h>n.max)continue;u=(n.max-c)/(h-c)*(p-u)+u,c=n.max}else if(h>=c&&h>n.max){if(c>n.max)continue;p=(n.max-c)/(h-c)*(p-u)+u,h=n.max}c==s&&u==l||le.moveTo(n.p2c(c)+t,r.p2c(u)+i),s=h,l=p,le.lineTo(n.p2c(h)+t,r.p2c(p)+i)}}le.stroke()}function i(e,t,i){for(var n=e.points,r=e.pointsize,a=Math.min(Math.max(0,i.min),i.max),o=0,s=!1,l=1,d=0,c=0;;){if(r>0&&o>n.length+r)break;o+=r;var u=n[o-r],h=n[o-r+l],p=n[o],f=n[o+l];if(s){if(r>0&&null!=u&&null==p){c=o,r=-r,l=2;continue}if(r<0&&o==d+r){le.fill(),s=!1,r=-r,l=1,o=d=c+r;continue}}if(null!=u&&null!=p){if(u<=p&&u<t.min){if(p<t.min)continue;h=(t.min-u)/(p-u)*(f-h)+h,u=t.min}else if(p<=u&&p<t.min){if(u<t.min)continue;f=(t.min-u)/(p-u)*(f-h)+h,p=t.min}if(u>=p&&u>t.max){if(p>t.max)continue;h=(t.max-u)/(p-u)*(f-h)+h,u=t.max}else if(p>=u&&p>t.max){if(u>t.max)continue;f=(t.max-u)/(p-u)*(f-h)+h,p=t.max}if(s||(le.beginPath(),le.moveTo(t.p2c(u),i.p2c(a)),s=!0),h>=i.max&&f>=i.max)le.lineTo(t.p2c(u),i.p2c(i.max)),le.lineTo(t.p2c(p),i.p2c(i.max));else if(h<=i.min&&f<=i.min)le.lineTo(t.p2c(u),i.p2c(i.min)),le.lineTo(t.p2c(p),i.p2c(i.min));else{var m=u,v=p;h<=f&&h<i.min&&f>=i.min?(u=(i.min-h)/(f-h)*(p-u)+u,h=i.min):f<=h&&f<i.min&&h>=i.min&&(p=(i.min-h)/(f-h)*(p-u)+u,f=i.min),h>=f&&h>i.max&&f<=i.max?(u=(i.max-h)/(f-h)*(p-u)+u,h=i.max):f>=h&&f>i.max&&h<=i.max&&(p=(i.max-h)/(f-h)*(p-u)+u,f=i.max),u!=m&&le.lineTo(t.p2c(m),i.p2c(h)),le.lineTo(t.p2c(u),i.p2c(h)),le.lineTo(t.p2c(p),i.p2c(f)),p!=v&&(le.lineTo(t.p2c(p),i.p2c(f)),le.lineTo(t.p2c(v),i.p2c(f)))}}}}le.save(),le.translate(he.left,he.top),le.lineJoin="round";var n=e.lines.lineWidth,r=e.shadowSize;if(n>0&&r>0){le.lineWidth=r,le.strokeStyle="rgba(0,0,0,0.1)";var a=Math.PI/18;t(e.datapoints,Math.sin(a)*(n/2+r/2),Math.cos(a)*(n/2+r/2),e.xaxis,e.yaxis),le.lineWidth=r/2,t(e.datapoints,Math.sin(a)*(n/2+r/4),Math.cos(a)*(n/2+r/4),e.xaxis,e.yaxis)}le.lineWidth=n,le.strokeStyle=e.color;var o=H(e.lines,e.color,0,fe);o&&(le.fillStyle=o,i(e.datapoints,e.xaxis,e.yaxis)),n>0&&t(e.datapoints,0,0,e.xaxis,e.yaxis),le.restore()}function W(e){function t(e,t,i,n,r,a,o,s){for(var l=e.points,d=e.pointsize,c=0;c<l.length;c+=d){var u=l[c],h=l[c+1];null==u||u<a.min||u>a.max||h<o.min||h>o.max||(le.beginPath(),u=a.p2c(u),h=o.p2c(h)+n,"circle"==s?le.arc(u,h,t,0,r?Math.PI:2*Math.PI,!1):s(le,u,h,t,r),le.closePath(),i&&(le.fillStyle=i,le.fill()),le.stroke())}}le.save(),le.translate(he.left,he.top);var i=e.points.lineWidth,n=e.shadowSize,r=e.points.radius,a=e.points.symbol;if(0==i&&(i=1e-4),i>0&&n>0){var o=n/2;le.lineWidth=o,le.strokeStyle="rgba(0,0,0,0.1)",t(e.datapoints,r,null,o+o/2,!0,e.xaxis,e.yaxis,a),le.strokeStyle="rgba(0,0,0,0.2)",t(e.datapoints,r,null,o/2,!0,e.xaxis,e.yaxis,a)}le.lineWidth=i,le.strokeStyle=e.color,t(e.datapoints,r,H(e.points,e.color),0,!1,e.xaxis,e.yaxis,a),le.restore()}function B(e,t,i,n,r,a,o,s,l,d,c){var u,h,p,f,m,v,g,x,b;d?(x=v=g=!0,m=!1,u=i,h=e,f=t+n,p=t+r,h<u&&(b=h,h=u,u=b,m=!0,v=!1)):(m=v=g=!0,x=!1,u=e+n,h=e+r,p=i,f=t,f<p&&(b=f,f=p,p=b,x=!0,g=!1)),h<o.min||u>o.max||f<s.min||p>s.max||(u<o.min&&(u=o.min,m=!1),h>o.max&&(h=o.max,v=!1),p<s.min&&(p=s.min,x=!1),f>s.max&&(f=s.max,g=!1),u=o.p2c(u),p=s.p2c(p),h=o.p2c(h),f=s.p2c(f),a&&(l.fillStyle=a(p,f),l.fillRect(u,f,h-u,p-f)),c>0&&(m||v||g||x)&&(l.beginPath(),l.moveTo(u,p),m?l.lineTo(u,f):l.moveTo(u,f),g?l.lineTo(h,f):l.moveTo(h,f),v?l.lineTo(h,p):l.moveTo(h,p),x?l.lineTo(u,p):l.moveTo(u,p),l.stroke()))}function F(e){function t(t,i,n,r,a,o){for(var s=t.points,l=t.pointsize,d=0;d<s.length;d+=l)null!=s[d]&&B(s[d],s[d+1],s[d+2],i,n,r,a,o,le,e.bars.horizontal,e.bars.lineWidth)}le.save(),le.translate(he.left,he.top),le.lineWidth=e.bars.lineWidth,le.strokeStyle=e.color;var i;switch(e.bars.align){case"left":i=0;break;case"right":i=-e.bars.barWidth;break;default:i=-e.bars.barWidth/2}var n=e.bars.fill?function(t,i){return H(e.bars,e.color,t,i)}:null;t(e.datapoints,i,i+e.bars.barWidth,n,e.xaxis,e.yaxis),le.restore()}function H(t,i,n,r){var a=t.fill;if(!a)return null;if(t.fillColor)return ie(t.fillColor,n,r,i);var o=e.color.parse(i);return o.a="number"==typeof a?a:.4,o.normalize(),o.toString()}function j(){if(null!=re.legend.container?e(re.legend.container).html(""):i.find(".legend").remove(),re.legend.show){for(var t,n,r=[],a=[],o=!1,s=re.legend.labelFormatter,l=0;l<ne.length;++l)t=ne[l],t.label&&(n=s?s(t.label,t):t.label,n&&a.push({label:n,color:t.color}));if(re.legend.sorted)if(e.isFunction(re.legend.sorted))a.sort(re.legend.sorted);else if("reverse"==re.legend.sorted)a.reverse();else{var d="descending"!=re.legend.sorted;a.sort(function(e,t){return e.label==t.label?0:e.label<t.label!=d?1:-1})}for(var l=0;l<a.length;++l){var c=a[l];l%re.legend.noColumns==0&&(o&&r.push("</tr>"),r.push("<tr>"),o=!0),r.push('<td class="legendColorBox"><div style="border:1px solid '+re.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+c.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+c.label+"</td>")}if(o&&r.push("</tr>"),0!=r.length){var u='<table style="font-size:smaller;color:'+re.grid.color+'">'+r.join("")+"</table>";if(null!=re.legend.container)e(re.legend.container).html(u);else{var h="",p=re.legend.position,f=re.legend.margin;null==f[0]&&(f=[f,f]),"n"==p.charAt(0)?h+="top:"+(f[1]+he.top)+"px;":"s"==p.charAt(0)&&(h+="bottom:"+(f[1]+he.bottom)+"px;"),"e"==p.charAt(1)?h+="right:"+(f[0]+he.right)+"px;":"w"==p.charAt(1)&&(h+="left:"+(f[0]+he.left)+"px;");
var m=e('<div class="legend">'+u.replace('style="','style="position:absolute;'+h+";")+"</div>").appendTo(i);if(0!=re.legend.backgroundOpacity){var v=re.legend.backgroundColor;null==v&&(v=re.grid.backgroundColor,v=v&&"string"==typeof v?e.color.parse(v):e.color.extract(m,"background-color"),v.a=1,v=v.toString());var g=m.children();e('<div style="position:absolute;width:'+g.width()+"px;height:"+g.height()+"px;"+h+"background-color:"+v+';"> </div>').prependTo(m).css("opacity",re.legend.backgroundOpacity)}}}}}function Y(e,t,i){var n,r,a,o=re.grid.mouseActiveRadius,s=o*o+1,l=null;for(n=ne.length-1;n>=0;--n)if(i(ne[n])){var d=ne[n],c=d.xaxis,u=d.yaxis,h=d.datapoints.points,p=c.c2p(e),f=u.c2p(t),m=o/c.scale;if(a=d.datapoints.pointsize,c.options.inverseTransform&&(m=Number.MAX_VALUE),d.lines.show||d.points.show)for(r=0;r<h.length;r+=a){var v=h[r],g=h[r+1];if(null!=v&&!(v-p>m||v-p<-m)){var x=Math.abs(c.p2c(v)-e),b=x;b<s&&(s=b,l=[n,r/a])}}if(d.bars.show&&!l){var w,y;switch(d.bars.align){case"left":w=0;break;case"right":w=-d.bars.barWidth;break;default:w=-d.bars.barWidth/2}for(y=w+d.bars.barWidth,r=0;r<h.length;r+=a){var v=h[r],g=h[r+1],k=h[r+2];null!=v&&(ne[n].bars.horizontal?p<=Math.max(k,v)&&p>=Math.min(k,v)&&f>=g+w&&f<=g+y:p>=v+w&&p<=v+y&&f>=Math.min(k,g)&&f<=Math.max(k,g))&&(l=[n,r/a])}}}return l?(n=l[0],r=l[1],a=ne[n].datapoints.pointsize,{datapoint:ne[n].datapoints.points.slice(r*a,(r+1)*a),dataIndex:r,series:ne[n],seriesIndex:n}):null}function q(e){re.grid.hoverable&&Q("plothover",e,function(e){return 0!=e.hoverable})}function U(e){re.grid.hoverable&&Q("plothover",e,function(e){return!1})}function V(e){Q("plotclick",e,function(e){return 0!=e.clickable})}function Q(e,t,n){var r=se.offset(),a=t.pageX-r.left-he.left,o=t.pageY-r.top-he.top,s=f({left:a,top:o});s.pageX=t.pageX,s.pageY=t.pageY;var l=Y(a,o,n);if(l&&(l.pageX=parseInt(l.series.xaxis.p2c(l.datapoint[0])+r.left+he.left,10),l.pageY=parseInt(l.series.yaxis.p2c(l.datapoint[1])+r.top+he.top,10)),re.grid.autoHighlight){for(var d=0;d<ge.length;++d){var c=ge[d];c.auto!=e||l&&c.series==l.series&&c.point[0]==l.datapoint[0]&&c.point[1]==l.datapoint[1]||K(c.series,c.point)}l&&G(l.series,l.datapoint,e)}i.trigger(e,[s,l])}function X(){var e=re.interaction.redrawOverlayInterval;return e==-1?void J():void(xe||(xe=setTimeout(J,e)))}function J(){xe=null,de.save(),oe.clear(),de.translate(he.left,he.top);var e,t;for(e=0;e<ge.length;++e)t=ge[e],t.series.bars.show?te(t.series,t.point):ee(t.series,t.point);de.restore(),s(me.drawOverlay,[de])}function G(e,t,i){if("number"==typeof e&&(e=ne[e]),"number"==typeof t){var n=e.datapoints.pointsize;t=e.datapoints.points.slice(n*t,n*(t+1))}var r=Z(e,t);r==-1?(ge.push({series:e,point:t,auto:i}),X()):i||(ge[r].auto=!1)}function K(e,t){if(null==e&&null==t)return ge=[],void X();if("number"==typeof e&&(e=ne[e]),"number"==typeof t){var i=e.datapoints.pointsize;t=e.datapoints.points.slice(i*t,i*(t+1))}var n=Z(e,t);n!=-1&&(ge.splice(n,1),X())}function Z(e,t){for(var i=0;i<ge.length;++i){var n=ge[i];if(n.series==e&&n.point[0]==t[0]&&n.point[1]==t[1])return i}return-1}function ee(t,i){var n=i[0],r=i[1],a=t.xaxis,o=t.yaxis,s="string"==typeof t.highlightColor?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString();if(!(n<a.min||n>a.max||r<o.min||r>o.max)){var l=t.points.radius+t.points.lineWidth/2;de.lineWidth=l,de.strokeStyle=s;var d=1.5*l;n=a.p2c(n),r=o.p2c(r),de.beginPath(),"circle"==t.points.symbol?de.arc(n,r,d,0,2*Math.PI,!1):t.points.symbol(de,n,r,d,!1),de.closePath(),de.stroke()}}function te(t,i){var n,r="string"==typeof t.highlightColor?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString(),a=r;switch(t.bars.align){case"left":n=0;break;case"right":n=-t.bars.barWidth;break;default:n=-t.bars.barWidth/2}de.lineWidth=t.bars.lineWidth,de.strokeStyle=r,B(i[0],i[1],i[2]||0,n,n+t.bars.barWidth,function(){return a},t.xaxis,t.yaxis,de,t.bars.horizontal,t.bars.lineWidth)}function ie(t,i,n,r){if("string"==typeof t)return t;for(var a=le.createLinearGradient(0,n,0,i),o=0,s=t.colors.length;o<s;++o){var l=t.colors[o];if("string"!=typeof l){var d=e.color.parse(r);null!=l.brightness&&(d=d.scale("rgb",l.brightness)),null!=l.opacity&&(d.a*=l.opacity),l=d.toString()}a.addColorStop(o/(s-1),l)}return a}var ne=[],re={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},ae=null,oe=null,se=null,le=null,de=null,ce=[],ue=[],he={left:0,right:0,top:0,bottom:0},pe=0,fe=0,me={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},ve=this;ve.setData=c,ve.setupGrid=M,ve.draw=$,ve.getPlaceholder=function(){return i},ve.getCanvas=function(){return ae.element},ve.getPlotOffset=function(){return he},ve.width=function(){return pe},ve.height=function(){return fe},ve.offset=function(){var e=se.offset();return e.left+=he.left,e.top+=he.top,e},ve.getData=function(){return ne},ve.getAxes=function(){var t={};return e.each(ce.concat(ue),function(e,i){i&&(t[i.direction+(1!=i.n?i.n:"")+"axis"]=i)}),t},ve.getXAxes=function(){return ce},ve.getYAxes=function(){return ue},ve.c2p=f,ve.p2c=m,ve.getOptions=function(){return re},ve.highlight=G,ve.unhighlight=K,ve.triggerRedrawOverlay=X,ve.pointOffset=function(e){return{left:parseInt(ce[h(e,"x")-1].p2c(+e.x)+he.left,10),top:parseInt(ue[h(e,"y")-1].p2c(+e.y)+he.top,10)}},ve.shutdown=y,ve.destroy=function(){y(),i.removeData("plot").empty(),ne=[],re=null,ae=null,oe=null,se=null,le=null,de=null,ce=[],ue=[],me=null,ge=[],ve=null},ve.resize=function(){var e=i.width(),t=i.height();ae.resize(e,t),oe.resize(e,t)},ve.hooks=me,l(ve),d(a),b(),c(r),M(),$(),w();var ge=[],xe=null}function n(e,t){return t*Math.floor(e/t)}var r=Object.prototype.hasOwnProperty;e.fn.detach||(e.fn.detach=function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)})}),t.prototype.resize=function(e,t){if(e<=0||t<=0)throw new Error("Invalid dimensions for plot, width = "+e+", height = "+t);var i=this.element,n=this.context,r=this.pixelRatio;this.width!=e&&(i.width=e*r,i.style.width=e+"px",this.width=e),this.height!=t&&(i.height=t*r,i.style.height=t+"px",this.height=t),n.restore(),n.save(),n.scale(r,r)},t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.render=function(){var e=this._textCache;for(var t in e)if(r.call(e,t)){var i=this.getTextLayer(t),n=e[t];i.hide();for(var a in n)if(r.call(n,a)){var o=n[a];for(var s in o)if(r.call(o,s)){for(var l,d=o[s].positions,c=0;l=d[c];c++)l.active?l.rendered||(i.append(l.element),l.rendered=!0):(d.splice(c--,1),l.rendered&&l.element.detach());0==d.length&&delete o[s]}}i.show()}},t.prototype.getTextLayer=function(t){var i=this.text[t];return null==i&&(null==this.textContainer&&(this.textContainer=e("<div class='flot-text'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),i=this.text[t]=e("<div></div>").addClass(t).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),i},t.prototype.getTextInfo=function(t,i,n,r,a){var o,s,l,d;if(i=""+i,o="object"==typeof n?n.style+" "+n.variant+" "+n.weight+" "+n.size+"px/"+n.lineHeight+"px "+n.family:n,s=this._textCache[t],null==s&&(s=this._textCache[t]={}),l=s[o],null==l&&(l=s[o]={}),d=l[i],null==d){var c=e("<div></div>").html(i).css({position:"absolute","max-width":a,top:-9999}).appendTo(this.getTextLayer(t));"object"==typeof n?c.css({font:o,color:n.color}):"string"==typeof n&&c.addClass(n),d=l[i]={width:c.outerWidth(!0),height:c.outerHeight(!0),element:c,positions:[]},c.detach()}return d},t.prototype.addText=function(e,t,i,n,r,a,o,s,l){var d=this.getTextInfo(e,n,r,a,o),c=d.positions;"center"==s?t-=d.width/2:"right"==s&&(t-=d.width),"middle"==l?i-=d.height/2:"bottom"==l&&(i-=d.height);for(var u,h=0;u=c[h];h++)if(u.x==t&&u.y==i)return void(u.active=!0);u={active:!0,rendered:!1,element:c.length?d.element.clone():d.element,x:t,y:i},c.push(u),u.element.css({top:Math.round(i),left:Math.round(t),"text-align":s})},t.prototype.removeText=function(e,t,i,n,a,o){if(null==n){var s=this._textCache[e];if(null!=s)for(var l in s)if(r.call(s,l)){var d=s[l];for(var c in d)if(r.call(d,c))for(var u,h=d[c].positions,p=0;u=h[p];p++)u.active=!1}}else for(var u,h=this.getTextInfo(e,n,a,o).positions,p=0;u=h[p];p++)u.x==t&&u.y==i&&(u.active=!1)},e.plot=function(t,n,r){var a=new i(e(t),n,r,e.plot.plugins);return a},e.plot.version="0.8.3",e.plot.plugins=[],e.fn.plot=function(t,i){return this.each(function(){e.plot(this,t,i)})}}(jQuery),function(e){function t(e,t){return t*Math.floor(e/t)}function i(e,t,i,n){if("function"==typeof e.strftime)return e.strftime(t);var r=function(e,t){return e=""+e,t=""+(null==t?"0":t),1==e.length?t+e:e},a=[],o=!1,s=e.getHours(),l=s<12;null==i&&(i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),null==n&&(n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);var d;d=s>12?s-12:0==s?12:s;for(var c=0;c<t.length;++c){var u=t.charAt(c);if(o){switch(u){case"a":u=""+n[e.getDay()];break;case"b":u=""+i[e.getMonth()];break;case"d":u=r(e.getDate());break;case"e":u=r(e.getDate()," ");break;case"h":case"H":u=r(s);break;case"I":u=r(d);break;case"l":u=r(d," ");break;case"m":u=r(e.getMonth()+1);break;case"M":u=r(e.getMinutes());break;case"q":u=""+(Math.floor(e.getMonth()/3)+1);break;case"S":u=r(e.getSeconds());break;case"y":u=r(e.getFullYear()%100);break;case"Y":u=""+e.getFullYear();break;case"p":u=l?"am":"pm";break;case"P":u=l?"AM":"PM";break;case"w":u=""+e.getDay()}a.push(u),o=!1}else"%"==u?o=!0:a.push(u)}return a.join("")}function n(e){function t(e,t,i,n){e[t]=function(){return i[n].apply(i,arguments)}}var i={date:e};void 0!=e.strftime&&t(i,"strftime",e,"strftime"),t(i,"getTime",e,"getTime"),t(i,"setTime",e,"setTime");for(var n=["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds"],r=0;r<n.length;r++)t(i,"get"+n[r],e,"getUTC"+n[r]),t(i,"set"+n[r],e,"setUTC"+n[r]);return i}function r(e,t){if("browser"==t.timezone)return new Date(e);if(t.timezone&&"utc"!=t.timezone){if("undefined"!=typeof timezoneJS&&"undefined"!=typeof timezoneJS.Date){var i=new timezoneJS.Date;return i.setTimezone(t.timezone),i.setTime(e),i}return n(new Date(e))}return n(new Date(e))}function a(n){n.hooks.processOptions.push(function(n,a){e.each(n.getAxes(),function(e,n){var a=n.options;"time"==a.mode&&(n.tickGenerator=function(e){var i=[],n=r(e.min,a),o=0,l=a.tickSize&&"quarter"===a.tickSize[1]||a.minTickSize&&"quarter"===a.minTickSize[1]?c:d;null!=a.minTickSize&&(o="number"==typeof a.tickSize?a.tickSize:a.minTickSize[0]*s[a.minTickSize[1]]);for(var u=0;u<l.length-1&&!(e.delta<(l[u][0]*s[l[u][1]]+l[u+1][0]*s[l[u+1][1]])/2&&l[u][0]*s[l[u][1]]>=o);++u);var h=l[u][0],p=l[u][1];if("year"==p){if(null!=a.minTickSize&&"year"==a.minTickSize[1])h=Math.floor(a.minTickSize[0]);else{var f=Math.pow(10,Math.floor(Math.log(e.delta/s.year)/Math.LN10)),m=e.delta/s.year/f;h=m<1.5?1:m<3?2:m<7.5?5:10,h*=f}h<1&&(h=1)}e.tickSize=a.tickSize||[h,p];var v=e.tickSize[0];p=e.tickSize[1];var g=v*s[p];"second"==p?n.setSeconds(t(n.getSeconds(),v)):"minute"==p?n.setMinutes(t(n.getMinutes(),v)):"hour"==p?n.setHours(t(n.getHours(),v)):"month"==p?n.setMonth(t(n.getMonth(),v)):"quarter"==p?n.setMonth(3*t(n.getMonth()/3,v)):"year"==p&&n.setFullYear(t(n.getFullYear(),v)),n.setMilliseconds(0),g>=s.minute&&n.setSeconds(0),g>=s.hour&&n.setMinutes(0),g>=s.day&&n.setHours(0),g>=4*s.day&&n.setDate(1),g>=2*s.month&&n.setMonth(t(n.getMonth(),3)),g>=2*s.quarter&&n.setMonth(t(n.getMonth(),6)),g>=s.year&&n.setMonth(0);var x,b=0,w=Number.NaN;do if(x=w,w=n.getTime(),i.push(w),"month"==p||"quarter"==p)if(v<1){n.setDate(1);var y=n.getTime();n.setMonth(n.getMonth()+("quarter"==p?3:1));var k=n.getTime();n.setTime(w+b*s.hour+(k-y)*v),b=n.getHours(),n.setHours(0)}else n.setMonth(n.getMonth()+v*("quarter"==p?3:1));else"year"==p?n.setFullYear(n.getFullYear()+v):n.setTime(w+g);while(w<e.max&&w!=x);return i},n.tickFormatter=function(e,t){var n=r(e,t.options);if(null!=a.timeformat)return i(n,a.timeformat,a.monthNames,a.dayNames);var o,l=t.options.tickSize&&"quarter"==t.options.tickSize[1]||t.options.minTickSize&&"quarter"==t.options.minTickSize[1],d=t.tickSize[0]*s[t.tickSize[1]],c=t.max-t.min,u=a.twelveHourClock?" %p":"",h=a.twelveHourClock?"%I":"%H";o=d<s.minute?h+":%M:%S"+u:d<s.day?c<2*s.day?h+":%M"+u:"%b %d "+h+":%M"+u:d<s.month?"%b %d":l&&d<s.quarter||!l&&d<s.year?c<s.year?"%b":"%b %Y":l&&d<s.year?c<s.year?"Q%q":"Q%q %Y":"%Y";var p=i(n,o,a.monthNames,a.dayNames);return p})})})}var o={xaxis:{timezone:null,timeformat:null,twelveHourClock:!1,monthNames:null}},s={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,quarter:7776e6,year:525949.2*60*1e3},l=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"]],d=l.concat([[3,"month"],[6,"month"],[1,"year"]]),c=l.concat([[1,"quarter"],[2,"quarter"],[1,"year"]]);e.plot.plugins.push({init:a,options:o,name:"time",version:"1.0"}),e.plot.formatDate=i,e.plot.dateGenerator=r}(jQuery),function(e){function t(t){function i(e){f.active&&(d(e),t.getPlaceholder().trigger("plotselecting",[a()]))}function n(t){1==t.which&&(document.body.focus(),void 0!==document.onselectstart&&null==m.onselectstart&&(m.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==m.ondrag&&(m.ondrag=document.ondrag,document.ondrag=function(){return!1}),l(f.first,t),f.active=!0,v=function(e){r(e)},e(document).one("mouseup",v))}function r(e){return v=null,void 0!==document.onselectstart&&(document.onselectstart=m.onselectstart),void 0!==document.ondrag&&(document.ondrag=m.ondrag),f.active=!1,d(e),p()?o():(t.getPlaceholder().trigger("plotunselected",[]),t.getPlaceholder().trigger("plotselecting",[null])),!1}function a(){if(!p())return null;if(!f.show)return null;var i={},n=f.first,r=f.second;return e.each(t.getAxes(),function(e,t){if(t.used){var a=t.c2p(n[t.direction]),o=t.c2p(r[t.direction]);i[e]={from:Math.min(a,o),to:Math.max(a,o)}}}),i}function o(){var e=a();t.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&t.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function s(e,t,i){return t<e?e:t>i?i:t}function l(e,i){var n=t.getOptions(),r=t.getPlaceholder().offset(),a=t.getPlotOffset();e.x=s(0,i.pageX-r.left-a.left,t.width()),e.y=s(0,i.pageY-r.top-a.top,t.height()),"y"==n.selection.mode&&(e.x=e==f.first?0:t.width()),"x"==n.selection.mode&&(e.y=e==f.first?0:t.height())}function d(e){null!=e.pageX&&(l(f.second,e),p()?(f.show=!0,t.triggerRedrawOverlay()):c(!0))}function c(e){f.show&&(f.show=!1,t.triggerRedrawOverlay(),e||t.getPlaceholder().trigger("plotunselected",[]))}function u(e,i){var n,r,a,o,s=t.getAxes();for(var l in s)if(n=s[l],n.direction==i&&(o=i+n.n+"axis",e[o]||1!=n.n||(o=i+"axis"),e[o])){r=e[o].from,a=e[o].to;break}if(e[o]||(n="x"==i?t.getXAxes()[0]:t.getYAxes()[0],r=e[i+"1"],a=e[i+"2"]),null!=r&&null!=a&&r>a){var d=r;r=a,a=d}return{from:r,to:a,axis:n}}function h(e,i){var n,r=t.getOptions();"y"==r.selection.mode?(f.first.x=0,f.second.x=t.width()):(n=u(e,"x"),f.first.x=n.axis.p2c(n.from),f.second.x=n.axis.p2c(n.to)),"x"==r.selection.mode?(f.first.y=0,f.second.y=t.height()):(n=u(e,"y"),f.first.y=n.axis.p2c(n.from),f.second.y=n.axis.p2c(n.to)),f.show=!0,t.triggerRedrawOverlay(),!i&&p()&&o()}function p(){var e=t.getOptions().selection.minSize;return Math.abs(f.second.x-f.first.x)>=e&&Math.abs(f.second.y-f.first.y)>=e}var f={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},m={},v=null;t.clearSelection=c,t.setSelection=h,t.getSelection=a,t.hooks.bindEvents.push(function(e,t){var r=e.getOptions();null!=r.selection.mode&&(t.mousemove(i),t.mousedown(n))}),t.hooks.drawOverlay.push(function(t,i){if(f.show&&p()){var n=t.getPlotOffset(),r=t.getOptions();i.save(),i.translate(n.left,n.top);var a=e.color.parse(r.selection.color);i.strokeStyle=a.scale("a",.8).toString(),i.lineWidth=1,i.lineJoin=r.selection.shape,i.fillStyle=a.scale("a",.4).toString();var o=Math.min(f.first.x,f.second.x)+.5,s=Math.min(f.first.y,f.second.y)+.5,l=Math.abs(f.second.x-f.first.x)-1,d=Math.abs(f.second.y-f.first.y)-1;i.fillRect(o,s,l,d),i.strokeRect(o,s,l,d),i.restore()}}),t.hooks.shutdown.push(function(t,r){r.unbind("mousemove",i),r.unbind("mousedown",n),v&&e(document).unbind("mouseup",v)})}e.plot.plugins.push({init:t,options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery),function(e){function t(t){function i(t,i,n,r,a){var o,s,l,d,c,u=n.pointsize,h=e.extend({},i);h.datapoints={points:[],pointsize:u,format:n.format},h.label=null,h.color=a,h.threshold=null,h.originSeries=i,h.data=[];var p,f=n.points,m=i.lines.show,v=[],g=[];for(o=0;o<f.length;o+=u){if(s=f[o],l=f[o+1],c=d,d=l<r?v:g,m&&c!=d&&null!=s&&o>0&&null!=f[o-u]){var x=s+(r-l)*(s-f[o-u])/(l-f[o-u+1]);for(c.push(x),c.push(r),p=2;p<u;++p)c.push(f[o+p]);for(d.push(null),d.push(null),p=2;p<u;++p)d.push(f[o+p]);for(d.push(x),d.push(r),p=2;p<u;++p)d.push(f[o+p])}for(d.push(s),d.push(l),p=2;p<u;++p)d.push(f[o+p])}if(n.points=g,h.datapoints.points=v,h.datapoints.points.length>0){var b=e.inArray(i,t.getData());t.getData().splice(b+1,0,h)}}function n(t,n,r){n.threshold&&(n.threshold instanceof Array?(n.threshold.sort(function(e,t){return e.below-t.below}),e(n.threshold).each(function(e,a){i(t,n,r,a.below,a.color)})):i(t,n,r,n.threshold.below,n.threshold.color))}t.hooks.processDatapoints.push(n)}var i={series:{threshold:null}};e.plot.plugins.push({init:t,options:i,name:"threshold",version:"1.2"})}(jQuery),function(e){function t(e){function t(t){n.locked||n.x!=-1&&(n.x=-1,e.triggerRedrawOverlay())}function i(t){if(!n.locked){if(e.getSelection&&e.getSelection())return void(n.x=-1);var i=e.offset();n.x=Math.max(0,Math.min(t.pageX-i.left,e.width())),n.y=Math.max(0,Math.min(t.pageY-i.top,e.height())),e.triggerRedrawOverlay()}}var n={x:-1,y:-1,locked:!1};e.setCrosshair=function(t){if(t){var i=e.p2c(t);n.x=Math.max(0,Math.min(i.left,e.width())),n.y=Math.max(0,Math.min(i.top,e.height()))}else n.x=-1;e.triggerRedrawOverlay()},e.clearCrosshair=e.setCrosshair,e.lockCrosshair=function(t){t&&e.setCrosshair(t),n.locked=!0},e.unlockCrosshair=function(){n.locked=!1},e.hooks.bindEvents.push(function(e,n){e.getOptions().crosshair.mode&&(n.mouseout(t),n.mousemove(i))}),e.hooks.drawOverlay.push(function(e,t){var i=e.getOptions().crosshair;if(i.mode){var r=e.getPlotOffset();if(t.save(),t.translate(r.left,r.top),n.x!=-1){var a=e.getOptions().crosshair.lineWidth%2?.5:0;if(t.strokeStyle=i.color,t.lineWidth=i.lineWidth,t.lineJoin="round",t.beginPath(),i.mode.indexOf("x")!=-1){var o=Math.floor(n.x)+a;t.moveTo(o,0),t.lineTo(o,e.height())}if(i.mode.indexOf("y")!=-1){var s=Math.floor(n.y)+a;t.moveTo(0,s),t.lineTo(e.width(),s)}t.stroke()}t.restore()}}),e.hooks.shutdown.push(function(e,n){n.unbind("mouseout",t),n.unbind("mousemove",i)})}var i={crosshair:{mode:null,color:"rgba(170, 0, 0, 0.80)",lineWidth:1}};e.plot.plugins.push({init:t,options:i,name:"crosshair",version:"1.0"})}(jQuery),function(e){function t(r){var d,c=this,u=r.data||{};if(u.elem)c=r.dragTarget=u.elem,r.dragProxy=l.proxy||c,r.cursorOffsetX=u.pageX-u.left,r.cursorOffsetY=u.pageY-u.top,r.offsetX=r.pageX-r.cursorOffsetX,r.offsetY=r.pageY-r.cursorOffsetY;else if(l.dragging||u.which>0&&r.which!=u.which||e(r.target).is(u.not))return;switch(r.type){case"mousedown":return e.extend(u,e(c).offset(),{elem:c,target:r.target,pageX:r.pageX,pageY:r.pageY}),o.add(document,"mousemove mouseup",t,u),a(c,!1),l.dragging=null,!1;case!l.dragging&&"mousemove":if(n(r.pageX-u.pageX)+n(r.pageY-u.pageY)<u.distance)break;r.target=u.target,d=i(r,"dragstart",c),d!==!1&&(l.dragging=c,l.proxy=r.dragProxy=e(d||c)[0]);case"mousemove":if(l.dragging){if(d=i(r,"drag",c),s.drop&&(s.drop.allowed=d!==!1,s.drop.handler(r)),d!==!1)break;r.type="mouseup"}case"mouseup":o.remove(document,"mousemove mouseup",t),l.dragging&&(s.drop&&s.drop.handler(r),i(r,"dragend",c)),a(c,!0),l.dragging=l.proxy=u.elem=!1}return!0}function i(t,i,n){t.type=i;var r=e.event.dispatch.call(n,t);return r!==!1&&(r||t.result)}function n(e){return Math.pow(e,2)}function r(){return l.dragging===!1}function a(e,t){e&&(e.unselectable=t?"off":"on",e.onselectstart=function(){return t},e.style&&(e.style.MozUserSelect=t?"":"none"))}e.fn.drag=function(e,t,i){return t&&this.bind("dragstart",e),i&&this.bind("dragend",i),e?this.bind("drag",t?t:e):this.trigger("drag")};var o=e.event,s=o.special,l=s.drag={not:":input",distance:0,which:1,dragging:!1,setup:function(i){i=e.extend({distance:l.distance,which:l.which,not:l.not},i||{}),i.distance=n(i.distance),o.add(this,"mousedown",t,i),this.attachEvent&&this.attachEvent("ondragstart",r)},teardown:function(){o.remove(this,"mousedown",t),this===l.dragging&&(l.dragging=l.proxy=!1),a(this,!0),this.detachEvent&&this.detachEvent("ondragstart",r)}};s.dragstart=s.dragend={setup:function(){},teardown:function(){}}}(jQuery),function(e){function t(t){var i=t||window.event,n=[].slice.call(arguments,1),r=0,a=0,o=0,t=e.event.fix(i);return t.type="mousewheel",i.wheelDelta&&(r=i.wheelDelta/120),i.detail&&(r=-i.detail/3),o=r,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(o=0,a=-1*r),void 0!==i.wheelDeltaY&&(o=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(a=-1*i.wheelDeltaX/120),n.unshift(t,r,a,o),(e.event.dispatch||e.event.handle).apply(this,n)}var i=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var n=i.length;n;)e.event.fixHooks[i[--n]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=i.length;e;)this.addEventListener(i[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=i.length;e;)this.removeEventListener(i[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),function(e){function t(t){function i(e,i){var n=t.offset();n.left=e.pageX-n.left,n.top=e.pageY-n.top,i?t.zoomOut({center:n}):t.zoom({center:n})}function n(e,t){return e.preventDefault(),i(e,t<0),!1}function r(e){if(1!=e.which)return!1;var i=t.getPlaceholder().css("cursor");i&&(d=i),t.getPlaceholder().css("cursor",t.getOptions().pan.cursor),c=e.pageX,u=e.pageY}function a(e){var i=t.getOptions().pan.frameRate;!h&&i&&(h=setTimeout(function(){t.pan({left:c-e.pageX,top:u-e.pageY}),c=e.pageX,u=e.pageY,h=null},1/i*1e3))}function o(e){h&&(clearTimeout(h),h=null),t.getPlaceholder().css("cursor",d),t.pan({left:c-e.pageX,top:u-e.pageY})}function s(e,t){var s=e.getOptions();s.zoom.interactive&&(t[s.zoom.trigger](i),t.mousewheel(n)),s.pan.interactive&&(t.bind("dragstart",{distance:10},r),t.bind("drag",a),t.bind("dragend",o))}function l(e,t){t.unbind(e.getOptions().zoom.trigger,i),t.unbind("mousewheel",n),t.unbind("dragstart",r),t.unbind("drag",a),t.unbind("dragend",o),h&&clearTimeout(h)}var d="default",c=0,u=0,h=null;t.zoomOut=function(e){e||(e={}),e.amount||(e.amount=t.getOptions().zoom.amount),e.amount=1/e.amount,t.zoom(e)},t.zoom=function(i){i||(i={});var n=i.center,r=i.amount||t.getOptions().zoom.amount,a=t.width(),o=t.height();n||(n={left:a/2,top:o/2});var s=n.left/a,l=n.top/o,d={x:{min:n.left-s*a/r,max:n.left+(1-s)*a/r},y:{min:n.top-l*o/r,max:n.top+(1-l)*o/r}};e.each(t.getAxes(),function(e,t){var i=t.options,n=d[t.direction].min,a=d[t.direction].max,o=i.zoomRange,s=i.panRange;if(o!==!1){if(n=t.c2p(n),a=t.c2p(a),n>a){var l=n;n=a,a=l}s&&(null!=s[0]&&n<s[0]&&(n=s[0]),null!=s[1]&&a>s[1]&&(a=s[1]));var c=a-n;o&&(null!=o[0]&&c<o[0]&&r>1||null!=o[1]&&c>o[1]&&r<1)||(i.min=n,i.max=a)}}),t.setupGrid(),t.draw(),i.preventEvent||t.getPlaceholder().trigger("plotzoom",[t,i])},t.pan=function(i){var n={x:+i.left,y:+i.top};isNaN(n.x)&&(n.x=0),isNaN(n.y)&&(n.y=0),e.each(t.getAxes(),function(e,t){var i,r,a=t.options,o=n[t.direction];i=t.c2p(t.p2c(t.min)+o),r=t.c2p(t.p2c(t.max)+o);var s=a.panRange;s!==!1&&(s&&(null!=s[0]&&s[0]>i&&(o=s[0]-i,i+=o,r+=o),null!=s[1]&&s[1]<r&&(o=s[1]-r,i+=o,r+=o)),a.min=i,a.max=r)}),t.setupGrid(),t.draw(),i.preventEvent||t.getPlaceholder().trigger("plotpan",[t,i])},t.hooks.bindEvents.push(s),t.hooks.shutdown.push(l)}var i={xaxis:{zoomRange:null,panRange:null},zoom:{interactive:!1,trigger:"dblclick",amount:1.5},pan:{interactive:!1,cursor:"move",frameRate:20}};e.plot.plugins.push({init:t,options:i,name:"navigate",version:"1.3"})}(jQuery),!function(e,t,i){function n(e,t){return typeof e===t}function r(){var e,t,i,r,a,o,s;for(var l in b)if(b.hasOwnProperty(l)){if(e=[],t=b[l],t.name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(i=0;i<t.options.aliases.length;i++)e.push(t.options.aliases[i].toLowerCase());for(r=n(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)o=e[a],s=o.split("."),1===s.length?y[s[0]]=r:(!y[s[0]]||y[s[0]]instanceof Boolean||(y[s[0]]=new Boolean(y[s[0]])),y[s[0]][s[1]]=r),x.push((r?"":"no-")+s.join("-"))}}function a(e){var t=k.className,i=y._config.classPrefix||"";if(_&&(t=t.baseVal),y._config.enableJSClass){var n=new RegExp("(^|\\s)"+i+"no-js(\\s|$)");t=t.replace(n,"$1"+i+"js$2")}y._config.enableClasses&&(t+=" "+i+e.join(" "+i),_?k.className.baseVal=t:k.className=t)}function o(e,t){return!!~(""+e).indexOf(t)}function s(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,i){return t+i.toUpperCase()}).replace(/^-/,"")}function l(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):_?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function d(e,t){return function(){return e.apply(t,arguments)}}function c(e,t,i){var r;for(var a in e)if(e[a]in t)return i===!1?e[a]:(r=t[e[a]],n(r,"function")?d(r,i||t):r);return!1}function u(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function h(){var e=t.body;return e||(e=l(_?"svg":"body"),e.fake=!0),e}function p(e,i,n,r){var a,o,s,d,c="modernizr",u=l("div"),p=h();if(parseInt(n,10))for(;n--;)s=l("div"),s.id=r?r[n]:c+(n+1),u.appendChild(s);return a=l("style"),a.type="text/css",a.id="s"+c,(p.fake?p:u).appendChild(a),p.appendChild(u),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),u.id=c,p.fake&&(p.style.background="",p.style.overflow="hidden",d=k.style.overflow,k.style.overflow="hidden",k.appendChild(p)),o=i(u,e),p.fake?(p.parentNode.removeChild(p),k.style.overflow=d,k.offsetHeight):u.parentNode.removeChild(u),!!o}function f(t,n){var r=t.length;if("CSS"in e&&"supports"in e.CSS){for(;r--;)if(e.CSS.supports(u(t[r]),n))return!0;return!1}if("CSSSupportsRule"in e){for(var a=[];r--;)a.push("("+u(t[r])+":"+n+")");return a=a.join(" or "),p("@supports ("+a+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return i}function m(e,t,r,a){function d(){u&&(delete A.style,delete A.modElem)}if(a=!n(a,"undefined")&&a,!n(r,"undefined")){var c=f(e,r);if(!n(c,"undefined"))return c}for(var u,h,p,m,v,g=["modernizr","tspan","samp"];!A.style&&g.length;)u=!0,A.modElem=l(g.shift()),A.style=A.modElem.style;for(p=e.length,h=0;p>h;h++)if(m=e[h],v=A.style[m],o(m,"-")&&(m=s(m)),A.style[m]!==i){if(a||n(r,"undefined"))return d(),"pfx"!=t||m;try{A.style[m]=r}catch(x){}if(A.style[m]!=v)return d(),"pfx"!=t||m}return d(),!1}function v(e,t,i,r,a){var o=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+S.join(o+" ")+o).split(" ");return n(t,"string")||n(t,"undefined")?m(s,t,r,a):(s=(e+" "+T.join(o+" ")+o).split(" "),c(s,t,i))}function g(e,t,n){return v(e,i,i,t,n)}var x=[],b=[],w={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var i=this;setTimeout(function(){t(i[e])},0)},addTest:function(e,t,i){b.push({name:e,fn:t,options:i})},addAsyncTest:function(e){b.push({name:null,fn:e})}},y=function(){};y.prototype=w,y=new y;var k=t.documentElement,_="svg"===k.nodeName.toLowerCase(),C="Moz O ms Webkit",S=w._config.usePrefixes?C.split(" "):[];w._cssomPrefixes=S;var T=w._config.usePrefixes?C.toLowerCase().split(" "):[];w._domPrefixes=T;var M={elem:l("modernizr")};y._q.push(function(){delete M.elem});var A={style:M.elem.style};y._q.unshift(function(){delete A.style}),w.testAllProps=v,w.testAllProps=g,y.addTest("csstransitions",g("transition","all",!0)),r(),a(x),delete w.addTest,delete w.addAsyncTest;for(var P=0;P<y._q.length;P++)y._q[P]();e.Modernizr=y}(window,document),!function(e,t,i){function n(e,t){return typeof e===t}function r(){var e,t,i,r,a,o,d;for(var u in l)if(l.hasOwnProperty(u)){if(e=[],t=l[u],t.name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(i=0;i<t.options.aliases.length;i++)e.push(t.options.aliases[i].toLowerCase());for(r=n(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)o=e[a],d=o.split("."),1===d.length?c[d[0]]=r:(!c[d[0]]||c[d[0]]instanceof Boolean||(c[d[0]]=new Boolean(c[d[0]])),c[d[0]][d[1]]=r),s.push((r?"":"no-")+d.join("-"))}}function a(e){var t=u.className,i=c._config.classPrefix||"";if(h&&(t=t.baseVal),c._config.enableJSClass){var n=new RegExp("(^|\\s)"+i+"no-js(\\s|$)");t=t.replace(n,"$1"+i+"js$2")}c._config.enableClasses&&(t+=" "+i+e.join(" "+i),h?u.className.baseVal=t:u.className=t)}function o(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):h?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}var s=[],l=[],d={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var i=this;setTimeout(function(){t(i[e])},0)},addTest:function(e,t,i){l.push({name:e,fn:t,options:i})},addAsyncTest:function(e){l.push({name:null,fn:e})}},c=function(){};c.prototype=d,c=new c;var u=t.documentElement,h="svg"===u.nodeName.toLowerCase(),p=d._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];d._prefixes=p,c.addTest("opacity",function(){var e=o("a").style;return e.cssText=p.join("opacity:.55;"),/^0.55$/.test(e.opacity)}),r(),a(s),delete d.addTest,delete d.addAsyncTest;for(var f=0;f<c._q.length;f++)c._q[f]();e.Modernizr=c}(window,document),Date.now||(Date.now=function(){return+new Date}),Object.keys||(Object.keys=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i});var INFECTIONS=["Endocarditis","Meningitis","Infections","Bacteremia","Cellulitis","UTI","Pneumonia","No Infection"],ALERT_CODES={100:"TREWScore has passed the Septic Shock Risk Threshold",101:"TREWScore has been elevated for ",200:"All criteria for <b>Severe Sepsis</b> have been met",201:"All criteria for <b>Septic Shock</b> have been met",
202:"<b>3hr</b> have passed since <b>Severe Sepsis</b> onset",203:"<b>6hr</b> have passed since <b>Severe Sepsis</b> onset",204:"<b>6hr</b> have passed since <b>Septic Shock</b> onset",300:"2/3 Severe Sepsis Criteria met: Enter Suspicion of Infection",301:"Severe Sepsis 3hr bundle intervention(s) need to be ordered",302:"Severe Sepsis 6hr bundle intervention(s) need to be ordered",303:"Septic Shock 6hr bundle intervention(s) need to be ordered",304:"Severe Sepsis 3hr bundle intervention(s) need to be completed in the next hour",305:"Severe Sepsis 6hr bundle intervention(s) need to be completed in the next hour",306:"Septic Shock 6hr bundle intervention(s) need to be completed in the next hour"},EDIT={sirs:["temperature","heart rate","respiratory rate","wbc"],org:["blood pressure","mean arterial pressure","decrease in SBP","respiratory failure","creatinine","bilirubin","platelet count","INR","lactate"],tension:["SBP","mean arterial pressure","decrease in SBP"],fusion:["lactate"]},CONSTANTS={"sus-edit":"severe_sepsis",sirs:"severe_sepsis",org:"severe_sepsis",tension:"septic_shock",fusion:"septic_shock"},severe_sepsis={display_name:"Severe Sepsis Criteria",suspicion_of_infection:{display_name:"Suspicion of Infection"},sirs:{key:"sirs",display_name:"SIRS Criteria",criteria:[{key:"sirs_temp",criteria_display_name:"Temperature is < 36.0 or > 38.3",dropdown:"Temperature is normal",overrideModal:[{id:"override_temp",header:"Override Temperature",name:"Body Temperature",units:"&#176;C",step:.1,range:"true",minAbsolute:20,maxAbsolute:50,values:[36,38.3]}],precision:3},{key:"heart_rate",criteria_display_name:"Heart Rate (Pulse) > 90/min",dropdown:"Heart Rate is normal",overrideModal:[{id:"override_heart_rate",header:"Override Heart Rate",name:"Heart Rate",units:"/min",step:1,range:"min",minAbsolute:20,maxAbsolute:240,value:90}],precision:4},{key:"respiratory_rate",criteria_display_name:"Respiratory Rate > 20/min",dropdown:"Respiratory rate is normal",overrideModal:[{id:"override_respiratory_rate",header:"Override Respiratory Rate",name:"Respiratory Rate",units:"/min",step:1,range:"min",minAbsolute:0,maxAbsolute:80,value:20}],precision:3},{key:"wbc",criteria_display_name:"WBC < 4K/uL or > 12K/uL or >10% bands",dropdown:"Wbc and/or Bands is normal",overrideModal:[{id:"override_wbc",header:"Override White Blood Count",name:"White Blood Count",units:"K/uL",step:.1,range:"true",minAbsolute:2,maxAbsolute:15,values:[4,12]},{id:"override_bands",header:"Override Bands",name:"Bands",units:"%",step:.1,range:"min",minAbsolute:0,maxAbsolute:15,value:10}],precision:3}]},organ_dysfunction:{key:"org",display_name:"Organ Dysfunction",criteria:[{key:"blood_pressure",criteria_display_name:"Systolic Blood Pressure < 90",dropdown:"Blood pressure is normal",overrideModal:[{id:"override_bp",header:"Override Blood Pressure",name:"Systolic Blood Pressure",units:"mmHg",step:1,range:"max",minAbsolute:0,maxAbsolute:180,value:90}],precision:4},{key:"mean_arterial_pressure",criteria_display_name:"Mean arterial pressure < 65",dropdown:"Mean arterial pressure is normal",overrideModal:[{id:"override_mean_arterial_pressure",header:"Override Mean Arterial Pressure",name:"Mean Arterial Pressure",units:"mmHg",step:1,range:"max",minAbsolute:0,maxAbsolute:180,value:65}],precision:3},{key:"decrease_in_sbp",criteria_display_name:"Decrease in SBP by > 40 mmHg from the last recorded SBP considered normal for given patient",dropdown:"Decrease in SBP is normal",overrideModal:[{id:"override_decrease_in_sbp",header:"Override Decrease in Systolic Blood Pressure",name:"Decrease in Systolic Blood Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:100,value:40}],precision:3},{key:"respiratory_failure",criteria_display_name:"Acute respiratory failure evidenced by invasive or non-invasive ventiliation",dropdown:"Respiratory rate is normal",overrideModal:[{id:"override_respiratory_rate",header:"Override Respiratory Rate",name:"Respiratory Failure",units:"",step:1,range:"min",minAbsolute:0,maxAbsolute:200,value:100}],precision:4},{key:"creatinine",criteria_display_name:"Creatinine > 2.0 or Urine Output < 0.5 mL/kg/hour for 2 hours",dropdown:"Creatinine and/or Urine Output is normal",overrideModal:[{id:"override_creatinine",header:"Override Creatinine",name:"Creatinine",units:"mg/dL",step:.1,range:"min",minAbsolute:0,maxAbsolute:4,value:2},{id:"override_urine_output",header:"Override Urine Output",name:"Urine Output",units:"mL/kg/hour",step:.1,range:"max",minAbsolute:0,maxAbsolute:3,value:.5}],precision:3},{key:"bilirubin",criteria_display_name:"Bilirubin > 2 mg/dL (34.2 mmol/L)",dropdown:"Bilirubin is normal",overrideModal:[{id:"override_bilirubin",header:"Override Bilirubin",name:"Bilirubin",units:"mg/dL",step:.01,range:"min",minAbsolute:0,maxAbsolute:4,value:2}],precision:3},{key:"platelet",criteria_display_name:"Platelet count < 100,000",dropdown:"Platelet Count is normal",overrideModal:[{id:"override_platelet_count",header:"Override Platelet Count",name:"Platelet Count",units:"",step:100,range:"max",minAbsolute:0,maxAbsolute:2e5,value:1e5}],precision:6},{key:"inr",criteria_display_name:"INR > 1.5 or PTT > 60 sec",dropdown:"INR is normal",overrideModal:[{id:"override_inr",header:"Override INR",name:"INR",units:"",step:1e3,range:"min",minAbsolute:0,maxAbsolute:2e5,value:1e5},{id:"override_ptt",header:"Override PTT",name:"PTT",units:"sec",step:1,range:"min",minAbsolute:0,maxAbsolute:120,value:60}],precision:5},{key:"lactate",criteria_display_name:"Lactate > 2mmol/L: (18.0 mg/dL)",dropdown:"Lactate is normal",overrideModal:[{id:"override_lactate_measurement",header:"Override Lactate Measurement",name:"Lactate Measurement",units:"mmol/L",step:.01,range:"min",minAbsolute:0,maxAbsolute:4,value:2}],precision:3}]}},septic_shock={display_name:"Septic Shock Criteria",tension:{key:"tension",display_name:"Persistent Hypotension",criteria:[{key:"hypotension_sbp",criteria_display_name:"Systolic blood pressure (SBP) < 90",dropdown:"Systolic Blood Pressure is normal",overrideModal:[{id:"override_sbp",header:"Override Systolic Blood Pressure",name:"Systolic Blood Pressure",units:"mmHg",step:1,range:"max",minAbsolute:0,maxAbsolute:180,value:90}],precision:4},{key:"hypotension_map",criteria_display_name:"Mean arterial pressue < 65",dropdown:"Mean Arterial Pressure is normal",overrideModal:[{id:"override_mean_arterial_pressure",header:"Override Mean Arterial Pressure",name:"Mean Arterial Pressure",units:"mmHg",step:1,range:"max",minAbsolute:0,maxAbsolute:130,value:65}],precision:3},{key:"hypotension_dsbp",criteria_display_name:"Decrease in SBP by > 40 mmHg from the last recorded SBP considered normal for given patient",dropdown:"Decrease in sbp is normal",overrideModal:[{id:"override_decrease_in_sbp",header:"Override Decrease in Systolic Blood Pressure",name:"Decrease in Systolic Blood Pressure",units:"mmHg",step:1,range:"min",minAbsolute:0,maxAbsolute:80,value:40}],precision:4}]},fusion:{key:"fusion",display_name:"Tissue Hypoperfusion",criteria:[{key:"initial_lactate",criteria_display_name:"Initial Lactate level is >= 4 mmol/L",dropdown:"Initial Lactate Measurement is normal",overrideModal:[{id:"override_initial_lactate_measurement",header:"Override Initial Lactate Measurement",name:"Initial Lactate Measurement",units:"mmol/L",step:.01,range:"min",minAbsolute:0,maxAbsolute:8,value:4}],precision:2}]}};workflows={sev3:{display_name:"Severe Sepsis 3hr Workflow",instruction:"Begins after onset of severe sepsis",not_yet:"No severe sepsis, no action required."},sev6:{display_name:"Severe Sepsis 6hr Workflow",instruction:"Begins after initial lactate measurement",not_yet:"No severe sepsis, no action required."},sep6:{display_name:"Septic Shock 6hr Workflow",instruction:"Begins after onset of septic shock",not_yet:"No septic shock, no action required."},init_lactate:{display_name:"Initial Lactate",as_dose:!1},blood_culture:{display_name:"Blood Culture",as_dose:!1},antibiotics:{display_name:"Antibiotics",as_dose:!0},fluid:{display_name:"Fluid",as_dose:!0},repeat_lactate:{display_name:"Repeat Lactate",as_dose:!1},vasopressors:{display_name:"Vasopressors",as_dose:!0}};var doseLimits={antibiotics:0,fluid:0,vasopressors:0},STATIC={severe_sepsis:severe_sepsis,septic_shock:septic_shock},FID_TO_HUMAN_READABLE={vent:"Mechanical Ventilation",pao2:"PaO2",paco2:"PaCO2",fio2:"FiO2",amylase:"Amylase",mapm:"MAP",temperature:"Temperature",sodium:"Sodium",penicillin_dose:"Penicillin",meropenem_dose:"Meropenem",rass:"RASS",resp_rate:"Respiratory Rate",amoxicillin_dose:"Amoxicillin",nbp:"Blood Pressure",erythromycin_dose:"Erythromycin",bands:"Bands",cefazolin_dose:"Cefazolin",clindamycin_dose:"Clindamycin",bun:"BUN",nbp_sys:"Non-invasive Systolic BP",tobramycin_dose:"Tobramycin",rapamycin_dose:"Rapamycin",ceftazidime_dose:"Ceftazidime",bun_to_cr:"BUN to Creatinine Ratio",epinephrine_dose:"Epinephrine",crystalloid_fluid:"Total Crystalloid Fluid",wbc:"WBC",weight:"Weight",admit_weight:"Admission Weight",hemoglobin:"Hemoglobin",spo2:"SpO2",platelets:"Platelets",arterial_ph:"Arterial pH",inr:"INR",rifampin_dose:"Rifampin",dopamine_dose:"Dopamine",nbp_dias:"Non-invasive Diastolic BP",ampicillin_dose:"Ampicillin",creatinine:"Creatinine",gentamicin_dose:"Gentamicin",vancomycin_dose:"Vancomycin",co2:"CO2",bilirubin:"Bilirubin",ast_liver_enzymes:"AST Liver Enzymes",dobutamine_dose:"Dobutamine",gcs:"GCS",levophed_infusion_dose:"Levophed",oxacillin_dose:"Oxacillin_dose",fluids_intake:"Total Fluid Intake",piperacillin_tazbac_dose:"Piperacillin/tazobactam",lactate:"Lactate",lipase:"Lipase",heart_rate:"Heart Rate",urine_output:"Urine Output"};window.onload=function(){endpoints.getPatientData(),dropdown.init(),overrideModal.init(),notifications.init(),toolbar.init(),dataRefresher.init(),notificationRefresher.init(),$("#fake-console").text(window.location),$("#fake-console").hide(),$("#show-console").click(function(){$("#fake-console").toggle()})},window.onerror=function(e,t,i){controller.sendLog({acc:"error",data:"ERR:"+e+" URL:"+t+" L:"+i})};var trews=new function(){this.data={},this.isTest=!1,this.setData=function(e){this.data=e},this.setNotifications=function(e){this.data?this.data.notifications=e:this.data={notifications:e}},this.getCriteria=function(e){switch(e){case"sirs":return this.data.severe_sepsis.sirs.criteria;case"org":return this.data.severe_sepsis.organ_dysfunction.criteria;case"tension":return this.data.septic_shock.hypotension.criteria;case"fusion":return this.data.septic_shock.hypoperfusion.criteria}},this.getSpecificCriteria=function(e,t){for(var i=this.getCriteria(e),n=0;n<i.length;n++)if(i[n].name==t)return i[n];return null},this.getMetCriteria=function(e){var t=[],i=isString(e)?this.getCriteria(e):e;for(var n in i)1==i[n].is_met&&t.push(n);return t},this.getOverriddenCriteria=function(e){var t=[],i=e instanceof String?this.getCriteria(e):e;for(var n in i)null!=i[n].override_user&&t.push(n);return t},this.orderIsDone=function(e){var t={antibiotics_order:"antibiotics",blood_culture_order:"blood_culture",initial_lactate_order:"init_lactate",crystalloid_fluid_order:"fluid",repeat_lactate_order:"repeat_lactate",vasopressors_order:"vasopressors"},i=t[e],n=workflows[i].as_dose;return n?Number(this.data[e].status?this.data[e].status:0)>doseLimits[i]:"Completed"==this.data[e].status||"Not Indicated"==this.data[e].status},this.getIncompleteSevereSepsis3hr=function(){return(this.orderIsDone("antibiotics_order")?0:1)+(this.orderIsDone("initial_lactate_order")?0:1)+(this.orderIsDone("blood_culture_order")?0:1)+(this.orderIsDone("crystalloid_fluid_order")?0:1)},this.getIncompleteSevereSepsis6hr=function(){return this.orderIsDone("repeat_lactate_order")?0:1},this.getIncompleteSepticShock=function(){return this.orderIsDone("vasopressors_order")?0:1}},dataRefresher=new function(){this.refreshPeriod=3e4,this.refreshTimer=null,this.init=function(){this.poll(this)},this.poll=function(e){endpoints.getPatientData(),e.refreshTimer=window.setTimeout(function(){e.poll(e)},e.refreshPeriod)},this.terminate=function(){this.refreshTimer&&(window.clearTimeout(this.refreshTimer),this.refreshTimer=null)}},notificationRefresher=new function(){this.refreshPeriod=1e4,this.refreshTimer=null,this.init=function(){this.poll(this)},this.poll=function(e){endpoints.getPatientData("pollNotifications"),e.refreshTimer=window.setTimeout(function(){e.poll(e)},e.refreshPeriod)},this.terminate=function(){this.refreshTimer&&(window.clearTimeout(this.refreshTimer),this.refreshTimer=null)}},endpoints=new function(){this.url=window.location.hostname.indexOf("localhost")>-1?"http://localhost:8000/api":window.location.protocol+"//"+window.location.hostname+"/api",this.numTries=1,this.getPatientData=function(e,t){return $("body").addClass("waiting"),postBody={q:getQueryVariable("PATID")===!1?null:getQueryVariable("PATID"),u:getQueryVariable("EPICUSERID")===!1?null:cleanUserId(getQueryVariable("EPICUSERID")),depid:getQueryVariable("ENCDEPID")===!1?null:getQueryVariable("ENCDEPID"),actionType:e?e:null,action:t?t:null},"true"==getQueryVariable("test")||trews.isTest?void("true"==getQueryVariable("console")&&this.test()):null==postBody.q?void $("#loading p").html("No Patient Identifier entered. Please restart application or contact trews-jhu@opsdx.io<br />"+window.location):void $.ajax({type:"POST",url:this.url,data:JSON.stringify(postBody),dataType:"json"}).done(function(e){$("body").removeClass("waiting"),$("#loading").addClass("done"),e.hasOwnProperty("trewsData")?(trews.setData(e.trewsData),controller.refresh()):e.hasOwnProperty("notifications")&&(trews.setNotifications(e.notifications),controller.refreshNotifications())}).fail(function(e){return $("body").removeClass("waiting"),400==e.status?void $("#loading p").html(e.responseJSON.message+".<br/>  Connection Failed<span id='test-data'>.</span> Please rest<span id='see-blank'>a</span>rt application or contact trews-jhu@opsdx.io"):(endpoints.numTries+=1,void(endpoints.numTries>3?($("#loading p").html("Connection Failed<span id='test-data'>.</span> Please rest<span id='see-blank'>a</span>rt application or contact trews-jhu@opsdx.io"),$("#test-data").click(function(){endpoints.test()}),$("#see-blank").click(function(){$("#loading").addClass("done")})):($("#loading p").text("Connection Failed. Retrying...("+endpoints.numTries+")"),endpoints.getPatientData())))})},this.test=function(){trews.isTest=!0,$.ajax({type:"GET",url:"js/data_example.json",contentType:"json",xhrFields:{withCredentials:!1},success:function(e){$("#loading").addClass("done"),trews.setData(e),controller.refresh()}})}},controller=new function(){this.clean=function(){$(".criteria").html("")},this.refresh=function(){this.clean();var e=trews.data;severeSepsisComponent.render(e.severe_sepsis),septicShockComponent.render(e.septic_shock,e.severe_sepsis.is_met),workflowsComponent.render(e.antibiotics_order,e.blood_culture_order,e.crystalloid_fluid_order,e.initial_lactate_order,e.repeat_lactate_order,e.vasopressors_order,e.severe_sepsis.onset_time,e.septic_shock.onset_time),graphComponent.refresh(e.chart_data),notifications.render(e.notifications),toolbar.render(e.severe_sepsis)},this.refreshNotifications=function(){var e=trews.data;notifications.render(e.notifications)},this.displayJSError=function(){dataRefresher.terminate(),notificationRefresher.terminate(),$("#loading").removeClass("done"),$("#loading p").html("Javascript Error<span id='test-data'>.</span> Please rest<span id='see-blank'>a</span>rt application or contact trews-jhu@opsdx.io"),$("#test-data").click(function(){endpoints.test()}),$("#see-blank").click(function(){$("#loading").addClass("done")})},this.sendLog=function(e){$.ajax({type:"POST",url:"log",data:JSON.stringify(e),dataType:"json"}).done(function(e){controller.displayJSError()}).fail(function(e){controller.displayJSError()})},this.sendFeedback=function(e){$.ajax({type:"POST",url:"feedback",data:JSON.stringify(e),dataType:"json"}).done(function(e){toolbar.feedbackSuccess()}).fail(function(e){toolbar.feedbackError()})}},slotComponent=function(e,t,i){this.criteria={},this.elem=e,this.link=t,this.constants=i,this.hasOverridenCriteria=function(){var e=[];for(var t in this.criteria)null!=this.criteria[t].override_user&&e.push(t);return e},this.r=function(e){this.criteria=e.criteria,this.elem.find("h3").text(this.constants.display_name),e.is_met?this.elem.addClass("complete"):this.elem.removeClass("complete"),this.elem.find(".criteria-overridden").html("");for(var t in this.criteria){var n=new criteriaComponent(this.criteria[t],i.criteria[t],i.key,this.link.hasClass("hidden"));n.isOverridden?this.elem.find(".criteria-overridden").append(n.r()):this.elem.find(".criteria").append(n.r())}this.elem.find(".num-text").text(e.num_met+" criteria met. "),0==this.hasOverridenCriteria().length?(this.elem.find(".num-overridden").addClass("hidden"),this.elem.find(".criteria-overridden").addClass("hidden")):this.elem.find(".num-overridden").text(this.hasOverridenCriteria().length+" customized criteria"),this.link.unbind(),this.link.click({elem:this.elem},function(e){$(this).hasClass("hidden")?(e.data.elem.find(".status.hidden").removeClass("hidden").addClass("unhidden"),$(this).text("minimize").removeClass("hidden"),!Modernizr.csstransitions):(e.data.elem.find(".status.unhidden").removeClass("unhidden").addClass("hidden"),$(this).text("see all").addClass("hidden"),this.criteriaHidden=!0,!Modernizr.csstransitions)})}},severeSepsisComponent=new function(){this.sus={},this.ctn=$("[data-trews='severeSepsis']"),this.susCtn=$("[data-trews='sus']");for(var e in INFECTIONS){var t=$("<option></option>").text(INFECTIONS[e]);$(".selection select").append(t)}this.sirSlot=new slotComponent($("[data-trews='sir']"),$("#expand-sir"),severe_sepsis.sirs),this.orgSlot=new slotComponent($("[data-trews='org']"),$("#expand-org"),severe_sepsis.organ_dysfunction),this.suspicion=function(e){if(this.susCtn.find("h3").text(e.display_name),this.susCtn.removeClass("complete"),null==this.sus.value)this.susCtn.find(".status").hide();else{"No Infection"!=this.sus.value&&this.susCtn.addClass("complete"),this.susCtn.find(".status").show(),this.susCtn.find(".selection").hide(),this.susCtn.find(".status h4").text(this.sus.value);var t=null;this.sus.update_user&&(t="by "+this.sus.update_user),this.sus.update_time&&(t=(t?t+" ":"")+'at <span title="'+strToTime(new Date(1e3*this.sus.update_time))+'">'+timeLapsed(new Date(1e3*this.sus.update_time))+"</span>"),t&&this.susCtn.find(".status h5").html(t)}},this.render=function(e){this.ctn.find("h2").text(severe_sepsis.display_name),e.is_met?this.ctn.addClass("complete"):this.ctn.removeClass("complete"),this.sus=e.suspicion_of_infection,this.suspicion(severe_sepsis.suspicion_of_infection),this.sirSlot.r(e.sirs),this.orgSlot.r(e.organ_dysfunction)}},septicShockComponent=new function(){this.ctn=$("[data-trews='septicShock']"),this.fnote=$("#fluid-note"),this.fnoteBtn=$("#fluid-note-btn"),this.tenSlot=new slotComponent($("[data-trews='tension']"),$("#expand-ten"),septic_shock.tension),this.fusSlot=new slotComponent($("[data-trews='fusion']"),$("#expand-fus"),septic_shock.fusion),this.render=function(e,t){this.ctn.find("h2").text(septic_shock.display_name),e.is_met?this.ctn.addClass("complete"):this.ctn.removeClass("complete"),this.tenSlot.r(e.hypotension),this.fusSlot.r(e.hypoperfusion),this.fnoteBtn.unbind(),e.crystalloid_fluid.is_met?this.fnote.addClass("complete"):this.fnote.removeClass("complete");var i=null;if(i=e.crystalloid_fluid.is_met?"Reset":"Not Indicated"){this.fnoteBtn.text(i);var n={actionName:"crystalloid_fluid"};"Not Indicated"==i?n.value=[{text:"Not Indicated"}]:n.clear=!0,this.fnoteBtn.click(function(){endpoints.getPatientData("override",n)})}else this.fnoteBtn.hide();t?(this.ctn.removeClass("inactive"),this.fnoteBtn.removeClass("inactive"),this.tenSlot.elem.find(".edit-btn").removeClass("inactive"),this.fusSlot.elem.find(".edit-btn").removeClass("inactive")):(this.ctn.addClass("inactive"),this.fnoteBtn.addClass("inactive"),this.tenSlot.elem.find(".edit-btn").addClass("inactive"),this.fusSlot.elem.find(".edit-btn").addClass("inactive"))}},workflowsComponent=new function(){this.sev3Ctn=$("[data-trews='sev3']"),this.sev6Ctn=$("[data-trews='sev6']"),this.sep6Ctn=$("[data-trews='sep6']"),this.orderBtns=$(".place-order"),this.notInBtns=$(".notIn"),this.clean=function(){$("[data-trews='init_lactate'],\t\t\t[data-trews='blood_culture'],\t\t\t[data-trews='antibiotics'],\t\t\t[data-trews='fluid'],\t\t\t[data-trews='re_lactate'],\t\t\t[data-trews='vasopressors']").html("")},this.makeButtons=function(){this.orderBtns.unbind(),this.orderBtns.click(function(){endpoints.getPatientData("place_order",{actionName:$(this).attr("data-trews")})}),this.notInBtns.unbind(),this.notInBtns.click(function(){endpoints.getPatientData("order_not_indicated",{actionName:$(this).attr("data-trews")})})},this.workflowStatus=function(e,t,i,n){if(null==t)return workflows[e].not_yet;var r=workflows[e].instruction;if(n){var a=new Date(1e3*i);return r="Workflow window completed <span title='"+strToTime(a)+"'>"+timeLapsed(a)+"</span>"}if("sev3"==e)var o=108e5;else if(e="sev6")var o=216e5;else var o=216e5;var s=1e3*t+o,l=new Date(s);return r=s<Date.now()?"Workflow window expired <span title='"+strToTime(l)+"'>"+timeLapsed(l)+"</span>":"<span title='"+strToTime(l)+"'>"+timeRemaining(l)+"</span>"},this.render=function(e,t,i,n,r,a,o,s){this.sev3Ctn.find("h2").text(workflows.sev3.display_name),this.sev6Ctn.find("h2").text(workflows.sev6.display_name),this.sep6Ctn.find("h2").text(workflows.sep6.display_name),null==o?(this.sev3Ctn.addClass("inactive"),this.sev6Ctn.addClass("inactive")):(this.sev3Ctn.removeClass("inactive"),this.sev6Ctn.removeClass("inactive")),null==s?this.sep6Ctn.addClass("inactive"):this.sep6Ctn.removeClass("inactive");var l=Math.max(n.time,t.time,e.time,i.time),d="Completed"==n.status&&"Completed"==t.status&&Number(e.status?e.status:"0")>doseLimits.antibiotics&&Number(i.status?i.status:"0")>doseLimits.fluid,c=Math.max(l,r.time),u=d&&"Completed"==r.status,h=Math.max(c,a.time),p=u&&Number(a.status?a.status:"0")>doseLimits.vasopressors;this.sev3Ctn.find(".card-subtitle").html(this.workflowStatus("sev3",o,l,d)),this.sev6Ctn.find(".card-subtitle").html(this.workflowStatus("sev6",o,c,u)),this.sep6Ctn.find(".card-subtitle").html(this.workflowStatus("sep6",s,h,p));new taskComponent(n,$("[data-trews='init_lactate']"),workflows.init_lactate,null),new taskComponent(t,$("[data-trews='blood_culture']"),workflows.blood_culture,null),new taskComponent(e,$("[data-trews='antibiotics']"),workflows.antibiotics,doseLimits.antibiotics),new taskComponent(i,$("[data-trews='fluid']"),workflows.fluid,doseLimits.fluid),new taskComponent(r,$("[data-trews='re_lactate']"),workflows.repeat_lactate,null),new taskComponent(a,$("[data-trews='vasopressors']"),workflows.vasopressors,doseLimits.vasopressors);this.makeButtons()}},graphComponent=new function(){this.is30=!0,this.xmin=0,this.xmax=0,this.ymin=0,this.ymax=0,$("<div id='tooltip'></div>").appendTo("body"),this.refresh=function(e){this.is30=!0,this.render(e,trews.data.severe_sepsis.onset_time,trews.data.septic_shock.onset_time)},this.render=function(e,t,i){if(void 0!=e){if(this.is30){for(var n=e.chart_values.timestamp.length,r=0;r<n;r+=1)e.chart_values.timestamp[r]*=1e3;this.is30=!1}if(0!=e.chart_values.timestamp.length){this.xmin=e.chart_values.timestamp[0];var a=e.chart_values.timestamp[e.chart_values.timestamp.length-1];this.xmax=(a-this.xmin)/6+a}else null!=e.patient_arrival?(this.xmin=1e3*e.patient_arrival.timestamp,this.xmax=(Date.now()-this.xmin)/6+Date.now()):(this.xmin=1e3*Date.now()-216e5,this.xmax=1e3*Date.now()+216e5);a=e.chart_values.trewscore[e.chart_values.trewscore.length-1],this.ymin=Math.min.apply(null,e.chart_values.trewscore),this.ymin=this.ymin-.03*this.ymin,this.ymin=this.ymin>e.trewscore_threshold?e.trewscore_threshold-.1:this.ymin,this.ymax=1.03*Math.max.apply(null,e.chart_values.trewscore),this.ymax=this.ymax<e.trewscore_threshold?e.trewscore_threshold+.1:this.ymax,graph(e,t,i,this.xmin,this.xmax,this.ymin,this.ymax)}},window.onresize=function(){graphComponent.render(trews.data.chart_data,trews.data.severe_sepsis.onset_time,trews.data.septic_shock.onset_time,graphComponent.xmin,graphComponent.xmax)}},criteriaComponent=function(e,t,i,n){this.isOverridden=!1,this.status="";var r=e.value,a=void 0==t.precision?5:t.precision;!r||!isNumber(r)&&isNaN(Number(r))||(r=Number(r).toPrecision(a));var o="";if("sirs_temp"==e.name&&(r=((Number(r)-32)/1.8).toPrecision(3)),e.is_met&&e.measurement_time){this.classComplete=" met";var s=timeLapsed(new Date(1e3*e.measurement_time)),l=strToTime(new Date(1e3*e.measurement_time));this.status+="Criteria met <span title='"+l+"'>"+s+"</span> with a value of <span class='value'>"+r+"</span>"}else if(null!=e.override_user){if(this.classComplete=" unmet",this.isOverridden=!0,e.measurement_time){var d=timeLapsed(new Date(1e3*e.measurement_time)),c=strToTime(new Date(1e3*e.measurement_time));this.status+="Criteria met <span title='"+c+"'>"+d+"</span> with a value of <span class='value'>"+r+"</span>",this.status+=e.override_time?"<br />":""}if(e.override_time){var u=timeLapsed(new Date(1e3*e.override_time)),h=strToTime(new Date(1e3*e.override_time));this.status+="Customized by "+e.override_user+" <span title='"+h+"'>"+u+"</span>"}}else o=n?" hidden":" unhidden",this.classComplete=" unmet",this.status="";for(var p="",f=0;f<t.overrideModal.length;f++){var m=null;null!=e.override_user?void 0!=trews.getSpecificCriteria(i,t.key).override_value[f]&&(m="min"==trews.getSpecificCriteria(i,t.key).override_value[f].range||"max"==trews.getSpecificCriteria(i,t.key).override_value[f].range?trews.getSpecificCriteria(i,t.key).override_value[f].lower?trews.getSpecificCriteria(i,t.key).override_value[f].lower:trews.getSpecificCriteria(i,t.key).override_value[f].upper:[trews.getSpecificCriteria(i,t.key).override_value[f].lower,trews.getSpecificCriteria(i,t.key).override_value[f].upper]):m=t.overrideModal[f].value?t.overrideModal[f].value:t.overrideModal[f].values;var v=t.overrideModal[f].name,g=t.overrideModal[f].units;if("true"==t.overrideModal[f].range)p+=v+" < "+m[0]+g+" or > "+m[1]+g;else{var x="min"==t.overrideModal[f].range?">":"<";p+=v+" "+x+" "+m+g}p+=" or "}p=p.slice(0,-4),this.html="<div class='status"+this.classComplete+o+"'>\t\t\t\t\t<h4>"+p+"</h4>\t\t\t\t\t<h5>"+this.status+"</h5>\t\t\t\t</div>",this.r=function(){return this.html}},taskComponent=function(e,t,i,n){t.find("h3").text(i.display_name),t.removeClass("in-progress"),t.removeClass("complete"),i.as_dose?Number(e.status)>n&&t.addClass("complete"):"Ordered"==e.status?t.addClass("in-progress"):"Completed"==e.status&&t.addClass("complete")},dropdown=new function(){this.d=$("#dropdown"),this.ctn=$("<div id='dropdown-content'></div>"),this.init=function(){this.d.append(this.ctn)},this.reset=function(){$(".edit-btn").removeClass("shown"),this.ctn.html("")},this.getCtnElem=function(e){return $("[data-trews='"+e+"']")},this.getAction=function(e){return{actionName:this.d.attr("data-trews"),value:e}},this.getLaunchAction=function(e){var t=this.d.attr("data-trews");return"org"==t&&(t="organ_dysfunction"),{card:CONSTANTS[this.d.attr("data-trews")],slot:t,criteria:e}},this.sus=function(){for(var e in INFECTIONS){var t=$('<h5 class="dropdown-link"></h5>').text(INFECTIONS[e]);this.ctn.append(t)}$(".dropdown-link").click(function(){var e=dropdown.getAction($(this).text());endpoints.getPatientData("suspicion_of_infection",e)})},this.editFields=function(e){var t=trews.getCriteria(e),i=[];for(var n in t){i.push(n);var r=$('<h5 class="dropdown-link" data-trews="'+n+'"></h5>'),a=t[n].override_user?EDIT[e][n]+" is customized":"customize "+EDIT[e][n],o=t[n].override_user?"overridden":"";r.text(a),r.addClass(o),this.ctn.append(r)}$(".dropdown-link").click(function(e){var t=dropdown.getLaunchAction($(this).attr("data-trews"));overrideModal.launch(t)})},this.fill=function(e){this.d.attr("data-trews",e),"sus-edit"===e?this.sus():this.editFields(e)},this.draw=function(e,t){this.d.css({top:t+7,left:e-this.d.width()/2}).fadeIn(30)},$(".edit-btn").click(function(e){e.stopPropagation(),dropdown.reset(),$(this).addClass("shown"),dropdown.fill($(this).attr("data-trews")),dropdown.draw($(this).offset().left+$(this).width()/2,$(this).offset().top+$(this).height())}),$("body").click(function(){$(".edit-btn").removeClass("shown"),dropdown.d.fadeOut(300)})},overrideModal=new function(){this.om=$("#override-modal"),this.ctn=$('<div id="om-content"></div>'),this.card="",this.slot="",this.criteria="",this.reset=!1,this.init=function(){this.om.append(this.ctn)},this.modalView=function(e,t){var i="<h3>"+e.header+"</h3>";return i+="<p>Define a new acceptable range.  The criteria will be met once the patient's "+e.name+" falls out of the new range.</p>",i+="<div><a class='override-reset' data-trews='"+t+"'>reset</a><span class='slider-numbers' data-trews='"+e.id+"'></span></div>",i+="<div class='slider-range' data-trews='"+e.id+"'></div>"},this.makeSliders=function(e,t){var i=trews.data[this.card][this.slot].criteria[this.criteria].override_value;if("true"===e.range)$(".slider-range[data-trews='"+e.id+"']").slider({range:e.range,min:e.minAbsolute,max:e.maxAbsolute,step:e.step,values:[null==i?e.values[0]:i[t].lower?i[t].lower:e.values[0],null==i?e.values[1]:i[t].upper?i[t].upper:e.values[1]],slide:function(t,i){$(".slider-numbers[data-trews='"+e.id+"']").text(i.values[0]+" - "+i.values[1])}}),$(".slider-numbers[data-trews='"+e.id+"']").text($(".slider-range[data-trews='"+e.id+"']").slider("values",0)+" - "+$(".slider-range[data-trews='"+e.id+"']").slider("values",1));else{var n=e.value;"min"===e.range?(slideFunction=function(t,i){$(".slider-numbers[data-trews='"+e.id+"']").text(e.minAbsolute+" - "+i.value)},n=null==i?n:i[t].lower?i[t].lower:n):(slideFunction=function(t,i){$(".slider-numbers[data-trews='"+e.id+"']").text(i.value+" - "+e.maxAbsolute)},n=null==i?n:i[t].upper?i[t].upper:n),$(".slider-range[data-trews='"+e.id+"']").slider({range:e.range,min:e.minAbsolute,max:e.maxAbsolute,step:e.step,value:n,slide:slideFunction}),"min"===e.range?$(".slider-numbers[data-trews='"+e.id+"']").text(e.minAbsolute+" - "+$(".slider-range[data-trews='"+e.id+"']").slider("value")):$(".slider-numbers[data-trews='"+e.id+"']").text($(".slider-range[data-trews='"+e.id+"']").slider("value")+" - "+e.maxAbsolute)}},this.makeActions=function(){var e=$(".override-save"),t=$(".override-cancel"),i=$(".override-reset");e.unbind(),e.click(function(){for(var e=$(".slider-range"),t={actionName:STATIC[overrideModal.card][overrideModal.slot].criteria[overrideModal.criteria].key,value:[],clear:!1},i=0;i<e.length;i++){var n=e[i].getAttribute("data-trews"),r=STATIC[overrideModal.card][overrideModal.slot].criteria[overrideModal.criteria].overrideModal[i],a={range:r.range};0==$(".slider-range[data-trews='"+n+"']").slider("values").length?(a.lower="max"==r.range?$(".slider-range[data-trews='"+n+"']").slider("value"):null,a.upper="min"==r.range?$(".slider-range[data-trews='"+n+"']").slider("value"):null):(a.lower=$(".slider-range[data-trews='"+n+"']").slider("values",0),a.upper=$(".slider-range[data-trews='"+n+"']").slider("values",1)),t.clear=!!overrideModal.reset,t.value.push(a)}endpoints.getPatientData("override",t),overrideModal.om.fadeOut(30)}),t.unbind(),t.click(function(){overrideModal.om.fadeOut(30)}),i.unbind(),i.click(function(){overrideModal.reset=!0;var e=STATIC[overrideModal.card][overrideModal.slot].criteria[overrideModal.criteria].overrideModal[$(this).attr("data-trews")];"true"==e.range?($(".slider-range[data-trews='"+e.id+"']").slider("values",e.values),$(".slider-numbers[data-trews='"+e.id+"']").text(e.values[0]+" - "+e.values[1])):($(".slider-range[data-trews='"+e.id+"']").slider("value",e.value),"min"==e.range?$(".slider-numbers[data-trews='"+e.id+"']").text(e.minAbsolute+" - "+e.value):$(".slider-numbers[data-trews='"+e.id+"']").text(e.value+" - "+e.maxAbsolute))})},
this.launch=function(e){this.card=e.card,this.slot=e.slot,this.criteria=e.criteria,this.reset=!1,this.ctn.html(""),Modernizr.opacity||this.om.addClass("no-opacity");for(var t=STATIC[e.card][e.slot].criteria[e.criteria].overrideModal,i=0;i<t.length;i++)this.ctn.append(this.modalView(t[i],i)),this.makeSliders(t[i],i);this.ctn.append("<div id='om-actions'><a class='override-cancel'>Cancel</a><a class='override-save'>Save</a>"),this.makeActions(),this.om.fadeIn(30)},this.om.unbind(),this.om.click(function(){overrideModal.om.fadeOut(30)}),this.ctn.unbind(),this.ctn.click(function(e){e.stopPropagation()})},notifications=new function(){this.n=$("#notifications"),this.nav=$("#header-notifications"),this.init=function(){this.nav.unbind(),this.nav.click(function(e){e.stopPropagation(),notifications.n.toggle()}),$("body").click(function(){notifications.n.fadeOut(30)}),this.n.unbind(),this.n.click(function(e){e.stopPropagation()})},this.getAlertMsg=function(e){var t=ALERT_CODES[e.alert_code];if("301"==e.alert_code||"304"==e.alert_code){var i=trews.getIncompleteSevereSepsis3hr();if(!(i>0))return null;t=String(i)+" "+t}else if("302"==e.alert_code||"305"==e.alert_code){var i=trews.getIncompleteSevereSepsis6hr();if(!(i>0))return null;t=String(i)+" "+t}else if("303"==e.alert_code||"306"==e.alert_code){var i=trews.getIncompleteSepticShock();if(!(i>0))return null;t=String(i)+" "+t}return t},this.render=function(e){if(this.n.html(""),void 0==e)return this.n.append('<p class="none">Can\'t retrieve notifications at this time.  <br />Notifications may be under construction.</p>'),this.nav.find("b").hide(),void this.nav.find(".text").text("Notifications");if(0==e.length)return this.n.append('<p class="none">No Notifications</p>'),this.nav.find("b").hide(),void this.nav.find(".text").text("Notifications");for(var t=0,i=Date.now(),n=0;n<e.length;n++){var r=new Date(1e3*e[n].timestamp);if(!(r>i)){var a=this.getAlertMsg(e[n]);if(void 0!=a){var o=$('<div class="notification"></div>');o.append("<h3>"+a+"</h3>");var s=$('<div class="subtext cf"></div>');s.append("<p>"+timeLapsed(new Date(1e3*e[n].timestamp))+"</p>");var l=$("<a data-trews='"+e[n].id+"'></a>");l.unbind(),e[n].read?(o.addClass("read"),l.text("Mark as unread"),l.click(function(){var e={id:$(this).attr("data-trews"),read:!1};endpoints.getPatientData("notification",e)})):(t++,l.text("Mark as read"),l.click(function(){var e={id:$(this).attr("data-trews"),read:!0};endpoints.getPatientData("notification",e)})),s.append(l),o.append(s),this.n.prepend(o)}}}0==t?this.nav.find("b").hide():(this.nav.find("b").show(),this.nav.find(".num").text(t)),e.length>1?this.nav.find(".text").text("Notifications"):this.nav.find(".text").text("Notification")}},toolbar=new function(){this.resetNav=$("#header-reset-patient"),this.feedback=$("#feedback"),this.init=function(){this.resetNav.unbind(),this.resetNav.click(function(e){var t=void 0==trews.data.event_id?null:{value:trews.data.event_id};endpoints.getPatientData("reset_patient",t)}),$("#header-feedback").click(function(){toolbar.feedback.show()}),$("#feedback").click(function(){toolbar.feedback.hide()}),$("#feedback-cancel").click(function(){toolbar.feedback.find("b").remove(),toolbar.feedback.find("textarea").val(""),toolbar.feedback.hide()}),$("#feedback .modal-content").click(function(e){e.stopPropagation()}),$("#feedback-submit").click(function(){postBody={q:getQueryVariable("PATID")===!1?null:getQueryVariable("PATID"),u:getQueryVariable("EPICUSERID")===!1?null:cleanUserId(getQueryVariable("EPICUSERID")),depid:getQueryVariable("ENCDEPID")===!1?null:getQueryVariable("ENCDEPID"),feedback:toolbar.feedback.find("textarea").val()},controller.sendFeedback(postBody)})},this.feedbackSuccess=function(){this.feedback.find("p").append('<b class="success">Feedback Submitted!</b>')},this.feedbackError=function(){this.feedback.find("p").append('<b class="error">There was an error, please try again or email trews-jhu@opsdx.io</b>')},this.render=function(e){e.is_met?this.resetNav.show():this.resetNav.hide()}};