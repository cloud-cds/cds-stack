select * from
(SELECT COMP.COMPONENT_ID
  ,COMP.BASE_NAME
  ,COMP.NAME
  ,COMP.EXTERNAL_NAME
  ,RES.RESULT_TIME
  ,RES.REFERENCE_UNIT
  ,RES.ORD_VALUE ResultValue
  ,RES.COMPONENT_COMMENT
  ,res.ORDER_PROC_ID OrderProcId
  , row_number() over (Partition By COMP.COMPONENT_ID
  order by RES.RESULT_TIME desc) as rn
FROM dbo.ORDER_RESULTS res
INNER JOIN dbo.CLARITY_COMPONENT COMP ON res.COMPONENT_ID = COMP.COMPONENT_ID
WHERE res.RESULT_STATUS_C IN (
    3
    ,4,5
    )
  AND res.lab_status_c >= 3
and
  res.COMPONENT_ID in
  (
'4',
'5',
'6',
'7',
'8',
'10',
'11',
'12',
'48',
'78',
'200',
'201',
'204',
'205',
'206',
'207',
'211',
'213',
'214',
'215',
'223',
'225',
'231',
'238',
'241',
'259',
'260',
'280',
'304',
'305',
'306',
'315',
'318',
'326',
'345',
'349',
'350',
'351',
'352',
'355',
'360',
'361',
'453',
'466',
'476',
'499',
'505',
'603',
'611',
'612',
'790',
'791',
'1718204',
'1724327',
'1724329',
'1724335',
'1724343',
'1726269',
'1726280',
'1810006',
'1810008',
'1810015',
'1810019',
'1810025',
'1810051',
'1810052',
'1810057',
'1810133',
'1810134',
'1010135',
'1010137',
'1081038',
'1010139',
'1810140',
'1810141',
'1810143',
'1810144',
'1081045',
'1010146',
'1010147',
'1810148',
'1810172',
'1810173',
'1810176',
'1810177',
'1810178',
'1810179',
'1810180',
'1810181',
'1810182',
'1810183',
'1810184',
'1810185',
'1810186',
'1810187',
'1010188',
'1810189',
'1810190',
'1810191',
'1810192',
'1810193',
'1810194',
'1810195',
'1810196',
'1810197',
'1810198',
'1810199'
)
AND RES.RESULT_TIME >= DATEADD(day,-365, GETDATE())
) rs where rn <= 100